[{"id":"43ef2c43.d1ee64","type":"tab","label":"ESP8266_Office","disabled":true,"info":""},{"id":"f723035c.fccf4","type":"tab","label":"ESP8266_Machine","disabled":true,"info":""},{"id":"e114be5c.8411","type":"tab","label":"ESP8266_Alerting System","disabled":true,"info":""},{"id":"19f6fb43.a03525","type":"tab","label":"Bosch","disabled":true,"info":""},{"id":"4a5fac2a.8dbb34","type":"tab","label":"Registe Device IoT Things","disabled":false,"info":""},{"id":"cbc934b7.020958","type":"tab","label":"GW Monitoring","disabled":true,"info":""},{"id":"ee291f49.98ee5","type":"tab","label":"Rollouts API","disabled":false,"info":""},{"id":"8b01cf3e.f743f","type":"tab","label":"Device Information","disabled":false,"info":""},{"id":"d1dbdd74.e1a3","type":"tab","label":"Distributions","disabled":false,"info":""},{"id":"600a4a09.bfc9f4","type":"tab","label":"Software Modules","disabled":false,"info":""},{"id":"2cc1377f.832f08","type":"tab","label":"Testes","disabled":true,"info":""},{"id":"6e94721.7c42c8c","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"3cf4944.e1a916c","type":"ui_tab","z":"","name":"Office","icon":"dashboard","order":1,"disabled":false,"hidden":false},{"id":"75789324.a4fa3c","type":"ui_group","z":"","name":"Temperature","tab":"3cf4944.e1a916c","order":1,"disp":true,"width":"7","collapse":false},{"id":"d2206740.ecb948","type":"ui_group","z":"","name":"Humidity","tab":"3cf4944.e1a916c","order":2,"disp":true,"width":"7","collapse":false},{"id":"23197280.b5a25e","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"3cc22e4d.c1bbd2","type":"ui_group","z":"","name":"Supervisao","tab":"","disp":true,"width":"12","collapse":false},{"id":"5270009c.04369","type":"ui_group","z":"","name":"Controlo","tab":"","order":2,"disp":true,"width":"12","collapse":false},{"id":"cad51349.03409","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"","tz":""},{"id":"5eaf9756.4fd2e8","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"bd_bme280_node","tz":""},{"id":"15fe8a27.b77416","type":"mqtt-broker","z":"","name":"","broker":"localhost","port":"1883","clientid":"NodeRedSQLClient","usetls":false,"compatmode":true,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"95acea04.beadb8","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"NodeRedSQLClient","usetls":false,"compatmode":true,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"47d36e48.a6aa2","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"rjdatabase","tz":"GMT +5:30"},{"id":"574bb956.ccf678","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"8d63600b.fd5c","type":"ui_group","z":"","name":"Control","tab":"3cf4944.e1a916c","order":5,"disp":true,"width":"3","collapse":false},{"id":"5188a6a7.e51558","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"ce684ce8.f923b","type":"ui_group","z":"","name":"Supervisao","tab":"","disp":true,"width":"12","collapse":false},{"id":"92de461a.eae8d8","type":"ui_group","z":"","name":"Controlo","tab":"","order":2,"disp":true,"width":"12","collapse":false},{"id":"107c2a9a.839ff5","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"aula3_reservatorio","tz":""},{"id":"7ef8de57.19fe9","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"c838f320.e23c2","type":"ui_group","z":"","name":"Supervisao","tab":"","disp":true,"width":"12","collapse":false},{"id":"8c412075.766b8","type":"ui_group","z":"","name":"Controlo","tab":"","order":2,"disp":true,"width":"12","collapse":false},{"id":"c1d02b0b.91e458","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"aula3_reservatorio","tz":""},{"id":"1279d65f.d6ccfa","type":"ui_group","z":"","name":"Supervision","tab":"3cf4944.e1a916c","order":4,"disp":true,"width":"3","collapse":false},{"id":"cfcc194f.d13618","type":"mqtt-broker","z":"","name":"Node-RED","broker":"localhost","port":"1883","clientid":"Node-RED","usetls":false,"compatmode":true,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"f96aa390.98731","type":"ui_group","z":"","name":"Home","tab":"","disp":true,"width":"6","collapse":false},{"id":"c4a7c2c1.f12cb","type":"ui_group","z":"","name":"Debug","tab":"","disp":true,"width":"6","collapse":false},{"id":"c23ff26b.1b06a","type":"mqtt-broker","z":"","name":"mosquitto","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"42f8b631.fb4c58","type":"ui_group","z":"","name":"Supervisao","tab":"","disp":true,"width":"12","collapse":false},{"id":"d56d91c.166387","type":"ui_group","z":"","name":"Controlo","tab":"","order":2,"disp":true,"width":"12","collapse":false},{"id":"b349d3fa.1bec3","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"aula3_reservatorio","tz":""},{"id":"62012b2e.c19f84","type":"ui_group","z":"","name":"Thermostat demo","tab":"","order":2,"disp":true,"width":"6"},{"id":"c8198403.335028","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"nodered","tz":""},{"id":"ca8fd54a.cfbe18","type":"mqtt-broker","z":"","name":"","broker":"192.168.1.71","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"b52ca185.5a675","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"reservatorio","tz":"UTC +0"},{"id":"1047fce0.b927d3","type":"ui_group","z":"","name":"Nível Atual (%)","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"fcebf4b3.050ab8","type":"ui_group","z":"","name":"Entradas Digitais","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"46a78d54.d13f14","type":"ui_group","z":"","name":"Saídas Digitais:","tab":"","order":5,"disp":true,"width":"6","collapse":false},{"id":"162d2959.abede7","type":"ui_group","z":"","name":"Y0","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"cc244b9.84cf9b8","type":"ui_group","z":"","name":"Manual ON","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"3f16884c.b4bb28","type":"ui_group","z":"","name":"Gráficos Entradas","tab":"","order":1,"disp":true,"width":"9","collapse":false},{"id":"f074a187.50748","type":"ui_group","z":"","name":"Graficos Saidas","tab":"","order":2,"disp":true,"width":"7","collapse":false},{"id":"8e6c2b59.083fc8","type":"mqtt-broker","z":"","name":"","broker":"192.168.1.71","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"cdd1bb96.fb7e78","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"reservatorio","tz":"UTC +0"},{"id":"e5d7b34c.ee2d2","type":"ui_group","z":"","name":"Nível Atual (%)","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"5a4e38e5.35f9c8","type":"ui_group","z":"","name":"Entradas Digitais","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"7a99a98a.866248","type":"ui_group","z":"","name":"Saídas Digitais:","tab":"","order":5,"disp":true,"width":"6","collapse":false},{"id":"b523eb2c.33b078","type":"ui_group","z":"","name":"Y0","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"783db91.6c79a48","type":"ui_group","z":"","name":"Manual ON","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"cf8a3cfa.851fe","type":"ui_group","z":"","name":"Gráficos Entradas","tab":"","order":1,"disp":true,"width":"9","collapse":false},{"id":"e14d3852.a828d8","type":"ui_group","z":"","name":"Graficos Saidas","tab":"","order":2,"disp":true,"width":"7","collapse":false},{"id":"356e24e.ed526dc","type":"mqtt-broker","z":"","name":"","broker":"192.168.1.71","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"3742857.1840e7a","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"reservatorio","tz":"UTC +0"},{"id":"d82043b0.2cf33","type":"ui_group","z":"","name":"Nível Atual (%)","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"59743be.80f43c4","type":"ui_group","z":"","name":"Entradas Digitais","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"59017f0a.13223","type":"ui_group","z":"","name":"Saídas Digitais:","tab":"","order":5,"disp":true,"width":"6","collapse":false},{"id":"e0765379.e00cd","type":"ui_group","z":"","name":"Y0","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"b1695610.8ae468","type":"ui_group","z":"","name":"Manual ON","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"2aa012f8.53de5e","type":"ui_group","z":"","name":"Gráficos Entradas","tab":"","order":1,"disp":true,"width":"9","collapse":false},{"id":"f2e250d2.63d16","type":"ui_group","z":"","name":"Graficos Saidas","tab":"","order":2,"disp":true,"width":"7","collapse":false},{"id":"a013b4d9.613428","type":"ui_group","z":"","name":"Luminosity","tab":"3cf4944.e1a916c","order":3,"disp":true,"width":"7","collapse":false},{"id":"6e04c60e.d2b2e8","type":"ui_tab","z":"","name":"Machine","icon":"dashboard","order":2,"disabled":false,"hidden":false},{"id":"e612c532.2532c8","type":"ui_group","z":"","name":"Temperature","tab":"6e04c60e.d2b2e8","order":1,"disp":true,"width":"8","collapse":false},{"id":"90c2b05e.6fbd4","type":"ui_group","z":"","name":"Humidity","tab":"6e04c60e.d2b2e8","order":2,"disp":true,"width":"8","collapse":false},{"id":"bf551b28.537dd8","type":"mqtt-broker","z":"","name":"","broker":"192.168.1.71","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"407d6236.d7d2cc","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"reservatorio","tz":"UTC +0"},{"id":"60038d3e.f713b4","type":"ui_group","z":"","name":"Nível Atual (%)","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"5d08e6fb.8f2ab8","type":"ui_group","z":"","name":"Entradas Digitais","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"93c6e69.64fa018","type":"ui_group","z":"","name":"Saídas Digitais:","tab":"","order":5,"disp":true,"width":"6","collapse":false},{"id":"d18fcf0b.a54b3","type":"ui_group","z":"","name":"Y0","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"231ac1f8.2eff2e","type":"ui_group","z":"","name":"Manual ON","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"45eba16f.b7c2","type":"ui_group","z":"","name":"Gráficos Entradas","tab":"","order":1,"disp":true,"width":"9","collapse":false},{"id":"930181ec.4ea2b","type":"ui_group","z":"","name":"Graficos Saidas","tab":"","order":2,"disp":true,"width":"7","collapse":false},{"id":"aa87d38d.22eb7","type":"mqtt-broker","z":"","name":"","broker":"192.168.1.71","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"80598e6.f50f17","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"reservatorio","tz":"UTC +0"},{"id":"827e9042.76964","type":"ui_group","z":"","name":"Nível Atual (%)","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"6d1831cf.59e0b","type":"ui_group","z":"","name":"Entradas Digitais","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"c42efc7.3c30d","type":"ui_group","z":"","name":"Saídas Digitais:","tab":"","order":5,"disp":true,"width":"6","collapse":false},{"id":"d8361f73.01ad8","type":"ui_group","z":"","name":"Y0","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"7fadff58.331dd","type":"ui_group","z":"","name":"Manual ON","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"5fd065f1.37db9c","type":"ui_group","z":"","name":"Gráficos Entradas","tab":"","order":1,"disp":true,"width":"9","collapse":false},{"id":"eaf165e.968a898","type":"ui_group","z":"","name":"Graficos Saidas","tab":"","order":2,"disp":true,"width":"7","collapse":false},{"id":"eaf9fc33.797c1","type":"mqtt-broker","z":"","name":"","broker":"192.168.1.71","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"ce534b37.65f628","type":"MySQLdatabase","z":"","host":"127.0.0.1","port":"3306","db":"reservatorio","tz":"UTC +0"},{"id":"ae1d8b15.c03f58","type":"ui_group","z":"","name":"Nível Atual (%)","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"74c7c029.9d984","type":"ui_group","z":"","name":"Entradas Digitais","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"4d9e932f.3bcc2c","type":"ui_group","z":"","name":"Saídas Digitais:","tab":"","order":5,"disp":true,"width":"6","collapse":false},{"id":"6e4276ae.c82fa8","type":"ui_group","z":"","name":"Y0","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"a8f9a24b.dff9e","type":"ui_group","z":"","name":"Gráficos Entradas","tab":"","order":1,"disp":true,"width":"9","collapse":false},{"id":"1d67b6ae.a64d59","type":"ui_group","z":"","name":"Graficos Saidas","tab":"","order":2,"disp":true,"width":"7","collapse":false},{"id":"bbbb4c63.27e04","type":"telegram bot","z":"","botname":"AlertingSystem_bot","usernames":"","chatids":"973258847","baseapiurl":"","updatemode":"polling","pollinterval":"300","usesocks":false,"sockshost":"","socksport":"6667","socksusername":"anonymous","sockspassword":"","bothost":"","localbotport":"8443","publicbotport":"8443","privatekey":"","certificate":"","useselfsignedcertificate":false,"sslterminated":false,"verboselogging":false},{"id":"ed424eca.1598c","type":"telegram bot","z":"","botname":"Node_Red","usernames":"","chatids":"","baseapiurl":"","updatemode":"polling","pollinterval":"300","usesocks":false,"sockshost":"","socksport":"6667","socksusername":"anonymous","sockspassword":"","bothost":"","localbotport":"8443","publicbotport":"8443","privatekey":"","certificate":"","useselfsignedcertificate":false,"sslterminated":false,"verboselogging":false},{"id":"717bd20e.d7e5fc","type":"mqtt-broker","z":"","name":"localhost","broker":"localhost","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"e5e8bce5.196b2","type":"mqtt-broker","z":"","name":"RaspyBosch","broker":"192.168.88.250","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"a60970fa.efd9f","type":"MSSQL-CN","z":"","name":"Dev","server":"","encyption":false,"database":"bd_node_red"},{"id":"73003135.0892c","type":"mqtt-broker","z":"","broker":"localhost","port":"1883","clientid":"NodeRedSQLClient","usetls":false,"compatmode":true,"keepalive":"15","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"ac2e701.274f69","type":"ui_group","z":"","name":"Temperature","tab":"dc33c444.97bc48","order":1,"disp":true,"width":"6","collapse":false},{"id":"56aee08b.df3bc","type":"ui_group","z":"","name":"Information","tab":"dc33c444.97bc48","order":4,"disp":true,"width":"6","collapse":true},{"id":"a8a4a3e9.e86fe","type":"MSSQL-CN","z":"","name":"joaobastos.database.windows.net","server":"joaobastos.database.windows.net","encyption":true,"database":"bd_node_red"},{"id":"dc33c444.97bc48","type":"ui_tab","z":"","name":"BOSCH IoT Suite","icon":"dashboard","order":3,"disabled":false,"hidden":false},{"id":"5222ec86.bd4cf4","type":"ui_group","z":"","name":"Counter Reads","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"bcd42977.cf2e28","type":"ui_group","z":"","name":"Information","tab":"","order":2,"disp":true,"width":"6","collapse":true},{"id":"f90e282f.f826e8","type":"MSSQL-CN","z":"","name":"EMSfIIoT","server":"emsfiiot.database.windows.net","encyption":true,"database":"EMSfIIoT"},{"id":"89ba1982.42e818","type":"ui_group","z":"","name":"Humidity","tab":"dc33c444.97bc48","order":2,"disp":true,"width":"6","collapse":false},{"id":"dcb45bcb.979e18","type":"ui_group","z":"","name":"Supervision","tab":"6e04c60e.d2b2e8","order":3,"disp":true,"width":"6","collapse":false},{"id":"5ce74ef8.0759d","type":"ui_group","z":"","name":"Luminosity","tab":"dc33c444.97bc48","order":3,"disp":true,"width":"6","collapse":false},{"id":"71c7fa47.0a1074","type":"ui_group","z":"","name":"Temperature","tab":"e7742c31.de339","order":2,"disp":true,"width":"6","collapse":false},{"id":"ce0bb80c.ee4f68","type":"ui_group","z":"","name":"Humidity","tab":"e7742c31.de339","order":3,"disp":true,"width":"6","collapse":false},{"id":"ce24cce4.037e2","type":"ui_group","z":"","name":"Luminosity","tab":"e7742c31.de339","order":4,"disp":true,"width":6,"collapse":false},{"id":"b42c2368.52832","type":"ui_group","z":"","name":"Information","tab":"e7742c31.de339","order":6,"disp":true,"width":6,"collapse":false},{"id":"2499b8bd.fe3a78","type":"ui_group","z":"","name":"Accelerations","tab":"e7742c31.de339","order":5,"disp":true,"width":"6","collapse":false},{"id":"db0f3897.9ac6e8","type":"MSSQL-CN","z":"","name":"Azure","server":"joaobastos.database.windows.net","encyption":true,"database":"bd_node_red"},{"id":"e7742c31.de339","type":"ui_tab","z":"","name":"Monitoring","icon":"dashboard","order":5,"disabled":false,"hidden":false},{"id":"66c28879.c72b38","type":"ui_group","name":"Group 6","tab":"3cf4944.e1a916c","order":6,"disp":true,"width":6},{"id":"95a9a668.968bc8","type":"ui_tab","z":"","name":"Device Information","icon":"dashboard","order":7,"disabled":false,"hidden":false},{"id":"b4da31d4.3161d","type":"ui_group","z":"","name":"Device","tab":"95a9a668.968bc8","order":3,"disp":true,"width":6,"collapse":false},{"id":"95321d6e.baf4a","type":"ui_group","z":"","name":"hidden_group","tab":"","disp":false,"width":"6","collapse":false},{"id":"a08310c5.70be7","type":"ui_group","z":"","name":"Last Distribution Installed","tab":"95a9a668.968bc8","order":4,"disp":true,"width":6,"collapse":false},{"id":"6e71c2c1.9254ac","type":"ui_group","z":"","name":"Last Software Module Installed","tab":"95a9a668.968bc8","order":5,"disp":true,"width":6,"collapse":false},{"id":"a94317e6.81bd98","type":"ui_group","z":"","name":"Details information","tab":"","disp":true,"width":"6","collapse":false},{"id":"77338.232b4cc8c","type":"MySQLdatabase","z":"","host":"10.41.11.142","port":"3306","db":"dtwin","tz":""},{"id":"5a42d021.5b8b1","type":"ui_group","z":"","name":"Details information","tab":"","disp":true,"width":"6","collapse":false},{"id":"1e9eac4a.49fc84","type":"MySQLdatabase","z":"","host":"10.41.11.142","port":"3306","db":"dtwin","tz":""},{"id":"eb20ad3.09dfb5","type":"ui_group","z":"","name":"Filters","tab":"","order":2,"disp":true,"width":"24","collapse":false},{"id":"6a650b0b.a734c4","type":"ui_group","z":"","name":"Default","tab":"","disp":true,"width":"6","collapse":false},{"id":"2d1d7ac4.5eea66","type":"ui_group","z":"","name":"Temperatuur Node","tab":"","order":1,"disp":true,"width":"12"},{"id":"11d32340.e1e79d","type":"ui_group","z":"","name":"hidden_group","tab":"","disp":false,"width":"6","collapse":false},{"id":"89ca011.a83d7","type":"ui_group","z":"","name":"Date and Clock","tab":"e7742c31.de339","order":7,"disp":true,"width":"6","collapse":false},{"id":"810bf292.7a453","type":"ui_group","z":"","name":"File upload","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"cc48ad4c.9aa8b","type":"ui_group","z":"","name":"Counter Reads","tab":"","order":1,"disp":true,"width":"6","collapse":false},{"id":"2b2c5ac1.a3f3b6","type":"ui_group","z":"","name":"Information","tab":"","order":2,"disp":true,"width":"6","collapse":true},{"id":"89922ade.63cba8","type":"MSSQL-CN","z":"","name":"EMSfIIoT","server":"emsfiiot.database.windows.net","encyption":true,"database":"EMSfIIoT"},{"id":"d050310c.c69be","type":"ui_group","z":"","name":"Counter Reads","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"192f5f68.d2d7b1","type":"ui_group","z":"","name":"Information","tab":"","order":3,"disp":true,"width":"6","collapse":true},{"id":"c1556010.93802","type":"MSSQL-CN","z":"","name":"EMSfIIoT","server":"pedrorendeiro.database.windows.net","encyption":true,"database":"EMSfIIoT"},{"id":"99b40884.0303e8","type":"ui_group","z":"","name":"Chart","tab":"","order":1,"disp":true,"width":"18","collapse":false},{"id":"6fbf3357.68649c","type":"ui_group","z":"","name":"Device","tab":"e7742c31.de339","order":1,"disp":true,"width":"6","collapse":false},{"id":"c9e03b1f.d000e8","type":"ui_spacer","name":"spacer","group":"6fbf3357.68649c","order":5,"width":1,"height":1},{"id":"542b0e2b.16621","type":"ui_spacer","name":"spacer","group":"6fbf3357.68649c","order":7,"width":1,"height":1},{"id":"5ab599d.b24b768","type":"ui_tab","z":"","name":"Device Register","icon":"dashboard","order":4,"disabled":false,"hidden":false},{"id":"f6042d8f.498eb","type":"ui_group","z":"","name":"Register Device","tab":"5ab599d.b24b768","order":1,"disp":true,"width":"6","collapse":false},{"id":"2c5404b2.954f4c","type":"ui_spacer","name":"spacer","group":"f6042d8f.498eb","order":5,"width":1,"height":1},{"id":"43083dac.11dc44","type":"ui_spacer","name":"spacer","group":"f6042d8f.498eb","order":7,"width":1,"height":1},{"id":"130466a6.7052a9","type":"ui_group","z":"","name":"Choose Device","tab":"95a9a668.968bc8","order":2,"disp":true,"width":5,"collapse":false},{"id":"2d9ce5ea.d349fa","type":"ui_spacer","name":"spacer","group":"99c8b07.9b5ed5","order":3,"width":1,"height":1},{"id":"1a459a57.ad8496","type":"ui_spacer","name":"spacer","group":"99c8b07.9b5ed5","order":5,"width":1,"height":1},{"id":"502194d0.a1bf9c","type":"ui_spacer","name":"spacer","group":"99c8b07.9b5ed5","order":8,"width":1,"height":1},{"id":"ffc3636b.4ece4","type":"ui_spacer","name":"spacer","group":"99c8b07.9b5ed5","order":10,"width":1,"height":1},{"id":"c9126ece.188ad","type":"ui_spacer","name":"spacer","group":"99c8b07.9b5ed5","order":12,"width":1,"height":1},{"id":"11efe24f.6bf97e","type":"ui_spacer","name":"spacer","group":"99c8b07.9b5ed5","order":14,"width":1,"height":1},{"id":"a89e58e1.1ed1d8","type":"ui_spacer","name":"spacer","group":"99c8b07.9b5ed5","order":17,"width":1,"height":1},{"id":"f16e6e90.4da2e","type":"ui_spacer","name":"spacer","group":"99c8b07.9b5ed5","order":19,"width":1,"height":1},{"id":"eaf7a436.0265c8","type":"ui_tab","z":"","name":"Rollouts API","icon":"dashboard","order":6,"disabled":false,"hidden":false},{"id":"cb66b4f5.45fef8","type":"ui_group","z":"","name":"Provisioning a Device","tab":"eaf7a436.0265c8","order":1,"disp":true,"width":6,"collapse":false},{"id":"aebbbce8.fea28","type":"ui_group","z":"","name":"Create a SW Module and Upload Artifact","tab":"eaf7a436.0265c8","order":2,"disp":true,"width":7,"collapse":false},{"id":"f36b8716.4af3b8","type":"ui_group","z":"","name":"Create a Distribution Set and Assign the SW Module","tab":"eaf7a436.0265c8","order":3,"disp":true,"width":7,"collapse":false},{"id":"a075749.8b83888","type":"ui_group","z":"","name":"Assign a Distribution Set to a device","tab":"eaf7a436.0265c8","order":4,"disp":true,"width":5,"collapse":false},{"id":"6b42c28f.1cdc9c","type":"ui_tab","z":"","name":"Distributions","icon":"dashboard","order":8,"disabled":false,"hidden":false},{"id":"2a9c7ac8.8f2c66","type":"ui_group","z":"","name":"Choose Distribution","tab":"6b42c28f.1cdc9c","order":1,"disp":true,"width":7,"collapse":false},{"id":"8c3ddb65.4fc0c8","type":"ui_group","z":"","name":"Distribution Set","tab":"6b42c28f.1cdc9c","order":2,"disp":true,"width":8,"collapse":false},{"id":"9fa54d8.b1e62b","type":"ui_group","z":"","name":"Text Panel","tab":"","disp":true,"width":"5"},{"id":"b40cbeba.e76af","type":"ui_group","z":"","name":"Gauge","tab":"","disp":true,"width":"5"},{"id":"aa4c6727.1bc928","type":"ui_group","z":"","name":"Assigned Software Modules","tab":"6b42c28f.1cdc9c","order":3,"disp":true,"width":8,"collapse":false},{"id":"77039746.91d208","type":"ui_group","z":"","name":"Menu","tab":"","disp":true,"width":"6","collapse":false},{"id":"49a45644.a0feb8","type":"ui_group","z":"","name":"Group 2","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"5b1d3ecc.1aa3d","type":"ui_group","z":"","name":"Group 1","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"c305c7a3.b646f8","type":"ui_group","z":"","name":"Group 3","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"1749ded3.e47401","type":"ui_tab","z":"","name":"Software Modules","icon":"dashboard","order":9,"disabled":false,"hidden":false},{"id":"40051f70.40003","type":"ui_group","z":"","name":"Choose SW Module","tab":"1749ded3.e47401","order":1,"disp":true,"width":"6","collapse":false},{"id":"3775a946.33fdb6","type":"ui_group","z":"","name":"Menu","tab":"","disp":true,"width":"6","collapse":false},{"id":"5df8e8ae.835d68","type":"ui_group","z":"","name":"Group 2","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"d9b69566.9e0d18","type":"ui_group","z":"","name":"Group 1","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"1ab9113e.d3a4af","type":"ui_group","z":"","name":"Group 3","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"963f6d95.a0f6","type":"ui_group","z":"","name":"Menu","tab":"","disp":true,"width":"6","collapse":false},{"id":"c9c7d1f4.d9a3","type":"ui_group","z":"","name":"Group 2","tab":"","order":3,"disp":true,"width":"6","collapse":false},{"id":"8a8e2dab.62edd","type":"ui_group","z":"","name":"Group 1","tab":"","order":2,"disp":true,"width":"6","collapse":false},{"id":"c10fe504.cb61c8","type":"ui_group","z":"","name":"Group 3","tab":"","order":4,"disp":true,"width":"6","collapse":false},{"id":"45d7facf.87f524","type":"ui_group","z":"","name":"Software Module","tab":"1749ded3.e47401","order":2,"disp":true,"width":9,"collapse":false},{"id":"34dfd948.533d96","type":"ui_group","z":"","name":"Artifacts","tab":"1749ded3.e47401","order":3,"disp":true,"width":9,"collapse":false},{"id":"c74049e6.4634b8","type":"ui_spacer","name":"spacer","group":"2a9c7ac8.8f2c66","order":2,"width":2,"height":1},{"id":"36f0fd40.7f4ca2","type":"ui_spacer","name":"spacer","group":"2a9c7ac8.8f2c66","order":4,"width":2,"height":1},{"id":"800af4e3.f466d8","type":"ui_spacer","name":"spacer","group":"2a9c7ac8.8f2c66","order":5,"width":7,"height":1},{"id":"9849ca5d.cee7e8","type":"ui_spacer","name":"spacer","group":"2a9c7ac8.8f2c66","order":6,"width":1,"height":1},{"id":"cb9945a7.e954e8","type":"ui_spacer","name":"spacer","group":"2a9c7ac8.8f2c66","order":8,"width":1,"height":1},{"id":"f41a694f.a18468","type":"ui_spacer","name":"spacer","group":"aa4c6727.1bc928","order":2,"width":2,"height":1},{"id":"8e068363.7d5a6","type":"ui_spacer","name":"spacer","group":"aa4c6727.1bc928","order":4,"width":2,"height":1},{"id":"b1717ea8.bdca5","type":"ui_spacer","name":"spacer","group":"40051f70.40003","order":2,"width":1,"height":1},{"id":"24011c3f.1e75a4","type":"ui_spacer","name":"spacer","group":"40051f70.40003","order":4,"width":1,"height":1},{"id":"e701a4e4.fc17d8","type":"ui_spacer","name":"spacer","group":"40051f70.40003","order":5,"width":6,"height":1},{"id":"8c96829f.a0217","type":"ui_spacer","name":"spacer","group":"40051f70.40003","order":6,"width":1,"height":1},{"id":"78517028.1475f","type":"ui_spacer","name":"spacer","group":"40051f70.40003","order":8,"width":1,"height":1},{"id":"c2b7b20d.8aa3f","type":"ui_spacer","name":"spacer","group":"cb66b4f5.45fef8","order":3,"width":1,"height":1},{"id":"8c76e776.0198a8","type":"ui_spacer","name":"spacer","group":"cb66b4f5.45fef8","order":5,"width":1,"height":1},{"id":"46ac4a11.93c404","type":"ui_spacer","name":"spacer","group":"aebbbce8.fea28","order":4,"width":2,"height":1},{"id":"a47fb8dd.a661c8","type":"ui_spacer","name":"spacer","group":"aebbbce8.fea28","order":6,"width":2,"height":1},{"id":"77c15f2a.adf7e","type":"ui_spacer","name":"spacer","group":"aebbbce8.fea28","order":15,"width":2,"height":1},{"id":"b12f04c5.71e6d8","type":"ui_spacer","name":"spacer","group":"aebbbce8.fea28","order":17,"width":2,"height":1},{"id":"717a636f.b73d4c","type":"ui_spacer","name":"spacer","group":"f36b8716.4af3b8","order":1,"width":7,"height":1},{"id":"37d33def.d4a1a2","type":"ui_spacer","name":"spacer","group":"f36b8716.4af3b8","order":5,"width":1,"height":1},{"id":"8d634d98.06fd4","type":"ui_spacer","name":"spacer","group":"f36b8716.4af3b8","order":7,"width":1,"height":1},{"id":"867a8e7a.0ecc6","type":"ui_spacer","name":"spacer","group":"f36b8716.4af3b8","order":16,"width":1,"height":1},{"id":"38f69468.a5adac","type":"ui_spacer","name":"spacer","group":"f36b8716.4af3b8","order":18,"width":1,"height":1},{"id":"3636f312.3f358c","type":"ui_spacer","name":"spacer","group":"a075749.8b83888","order":1,"width":5,"height":1},{"id":"6152dcdf.c426a4","type":"ui_spacer","name":"spacer","group":"a075749.8b83888","order":4,"width":1,"height":1},{"id":"69ce4c7d.eac1e4","type":"ui_spacer","name":"spacer","group":"a075749.8b83888","order":6,"width":1,"height":1},{"id":"4bf5cac4.c54db4","type":"ui_spacer","name":"spacer","group":"130466a6.7052a9","order":2,"width":1,"height":1},{"id":"d53a6f82.0dc5c","type":"ui_spacer","name":"spacer","group":"130466a6.7052a9","order":4,"width":1,"height":1},{"id":"688ac3ed.21c92c","type":"ui_spacer","name":"spacer","group":"a08310c5.70be7","order":8,"width":6,"height":1},{"id":"c294a8fe.861ff8","type":"ui_spacer","name":"spacer","group":"a08310c5.70be7","order":9,"width":1,"height":1},{"id":"490153c6.f5da7c","type":"ui_spacer","name":"spacer","group":"a08310c5.70be7","order":11,"width":1,"height":1},{"id":"7b59b19.389655","type":"ui_spacer","name":"spacer","group":"6e71c2c1.9254ac","order":8,"width":6,"height":1},{"id":"88b3f58c.858018","type":"ui_spacer","name":"spacer","group":"6e71c2c1.9254ac","order":9,"width":1,"height":1},{"id":"1b1f6529.1778cb","type":"ui_spacer","name":"spacer","group":"6e71c2c1.9254ac","order":11,"width":1,"height":1},{"id":"605859c1.842508","type":"mqtt in","z":"43ef2c43.d1ee64","name":"","topic":"temp","qos":"2","datatype":"auto","broker":"23197280.b5a25e","x":110,"y":40,"wires":[["5b7b3614.5bf0a8"]]},{"id":"a8f42f16.dda27","type":"mqtt in","z":"43ef2c43.d1ee64","name":"","topic":"humid","qos":"2","datatype":"auto","broker":"7ef8de57.19fe9","x":110,"y":140,"wires":[["be7e2501.64e628"]]},{"id":"d78d483e.6b27d8","type":"ui_gauge","z":"43ef2c43.d1ee64","name":"Humidade","group":"d2206740.ecb948","order":1,"width":"6","height":"4","gtype":"gage","title":"Current","label":"%","format":"{{value}}","min":"40","max":"100","colors":["#008000","#e6e600","#ca3838"],"seg1":"","seg2":"","x":670,"y":140,"wires":[]},{"id":"e53f5314.c0945","type":"ui_gauge","z":"43ef2c43.d1ee64","name":"Temperatura","group":"75789324.a4fa3c","order":1,"width":"6","height":"4","gtype":"gage","title":"Current","label":"ºC","format":"{{value}}","min":"15","max":"30","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":670,"y":40,"wires":[]},{"id":"86fde8e2.590d88","type":"function","z":"43ef2c43.d1ee64","name":"MySQL Function","func":"var temp = global.get('temp');\nvar humd = global.get('humid');\nvar lumin = global.get('lumin');\n\n\nmsg.topic = \"INSERT INTO office_table(Temperature, Humidity, Luminosity) VALUES ('\"\nmsg.topic = msg.topic + temp + \"','\";\nmsg.topic = msg.topic + humd + \"','\";\nmsg.topic = msg.topic + lumin + \"')\";\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":420,"wires":[["9681f0b1.e09f2"]]},{"id":"75f6162c.f34218","type":"ui_switch","z":"43ef2c43.d1ee64","name":"Led","label":"Led","tooltip":"","group":"8d63600b.fd5c","order":0,"width":0,"height":0,"passthru":true,"decouple":"false","topic":"","style":"","onvalue":"1","onvalueType":"num","onicon":"","oncolor":"","offvalue":"0","offvalueType":"num","officon":"","offcolor":"","x":910,"y":320,"wires":[["4cc08980.495bc8"]]},{"id":"4cc08980.495bc8","type":"mqtt out","z":"43ef2c43.d1ee64","name":"Led","topic":"led","qos":"2","retain":"true","broker":"23197280.b5a25e","x":1130,"y":320,"wires":[]},{"id":"2b6e3625.85fdba","type":"inject","z":"43ef2c43.d1ee64","name":"SendEvery30s","topic":"Temporizador","payload":"","payloadType":"date","repeat":"30","crontab":"","once":true,"onceDelay":"2","x":140,"y":420,"wires":[["86fde8e2.590d88"]]},{"id":"87f8d3d1.4cd4a","type":"mqtt in","z":"43ef2c43.d1ee64","name":"","topic":"temp","qos":"2","datatype":"auto","broker":"23197280.b5a25e","x":110,"y":340,"wires":[["c8a94d8a.a74e"]]},{"id":"288d4ecd.eb14c2","type":"function","z":"43ef2c43.d1ee64","name":"TempOut","func":"var i;\nvar x = [];\nvar y = [];\nvar pl_old = msg.payload;\nvar pl_new = [];\n\nfor (i = 0; i<pl_old.length; i++) {\n    // get data info x and y, and convert to unix time format:\n    x[i] = new Date(pl_old[i].Date).getTime();\n    y[i] = pl_old[i].Temperature;\n    \n    // generate key-value pair:\n    pl_new[i] = {\"x\":x[i], \"y\":y[i]};\n}\n\n// Redefine msg.payload and return:\nmsg.payload = [{\"series\":[\"Temperature\"], \"labels\":[\"Temperature\"], \"data\":[pl_new]}];\n\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":40,"wires":[["a09e500f.35f5d"]]},{"id":"a09e500f.35f5d","type":"ui_chart","z":"43ef2c43.d1ee64","name":"Temperatura (Histórico)","group":"75789324.a4fa3c","order":2,"width":"7","height":"5","label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"15","ymax":"30","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1170,"y":40,"wires":[[]]},{"id":"a8867a10.d21c28","type":"function","z":"43ef2c43.d1ee64","name":"OutDataBase","func":"msg.topic = \"SELECT * FROM office_table\";\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":480,"wires":[["3bedf009.51355"]]},{"id":"cd0ec496.eb2c88","type":"inject","z":"43ef2c43.d1ee64","name":"SendEvery30s","topic":"Temporizador","payload":"","payloadType":"date","repeat":"30","crontab":"","once":true,"onceDelay":"2","x":140,"y":480,"wires":[["a8867a10.d21c28"]]},{"id":"461be626.b09de8","type":"link out","z":"43ef2c43.d1ee64","name":"OutDataBase","links":["73e00d5e.48b524","12ea88f1.895357","8f1f7568.c85ff8"],"x":735,"y":480,"wires":[]},{"id":"73e00d5e.48b524","type":"link in","z":"43ef2c43.d1ee64","name":"","links":["461be626.b09de8"],"x":815,"y":40,"wires":[["288d4ecd.eb14c2"]]},{"id":"20ddb322.8ee68c","type":"function","z":"43ef2c43.d1ee64","name":"HumidOut","func":"var i;\nvar x = [];\nvar y = [];\nvar pl_old = msg.payload;\nvar pl_new = [];\n\nfor (i = 0; i<pl_old.length; i++) {\n    // get data info x and y, and convert to unix time format:\n    x[i] = new Date(pl_old[i].Date).getTime();\n    y[i] = pl_old[i].Humidity;\n    \n    // generate key-value pair:\n    pl_new[i] = {\"x\":x[i], \"y\":y[i]};\n}\n\n// Redefine msg.payload and return:\nmsg.payload = [{\"series\":[\"Humidity\"], \"labels\":[\"Humidity\"], \"data\":[pl_new]}];\n\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":120,"wires":[["e359df6b.bd3ae"]]},{"id":"e359df6b.bd3ae","type":"ui_chart","z":"43ef2c43.d1ee64","name":"Humidade (Histórico)","group":"d2206740.ecb948","order":2,"width":"7","height":"5","label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"40","ymax":"100","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1160,"y":120,"wires":[[]]},{"id":"12ea88f1.895357","type":"link in","z":"43ef2c43.d1ee64","name":"","links":["461be626.b09de8"],"x":815,"y":120,"wires":[["20ddb322.8ee68c"]]},{"id":"7cc096e4.7dc398","type":"function","z":"43ef2c43.d1ee64","name":"Temperatura","func":"global.set(msg.topic, msg.payload);\n\ntemp = msg.payload;\ntemp = temp.toFixed(2);\nmsg.payload = temp;\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":40,"wires":[["e53f5314.c0945"]]},{"id":"31fbbfed.8f68","type":"function","z":"43ef2c43.d1ee64","name":"Humidade","func":"global.set(msg.topic, msg.payload);\n\nhumid = msg.payload;\nhumid = humid.toFixed(2);\nmsg.payload = humid;\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":140,"wires":[["d78d483e.6b27d8"]]},{"id":"92279eb3.b2125","type":"function","z":"43ef2c43.d1ee64","name":"Aquecedor","func":"var temp = msg.payload;\nvar warm=0;\n\nif(temp<=24){\n    msg.payload=1;\n    warm=1;\n  }else if(temp>26){\n    msg.payload=0;\n    warm=0;\n  }else if(temp>=24 && warm==1){\n    msg.payload=1;\n    warm=1;\n  }else if(temp>=24 && warm===0){\n    msg.payload=0;\n    warm=0;\n  }\n\nreturn msg;\n\n","outputs":1,"noerr":0,"x":450,"y":340,"wires":[["96264746.839a88"]]},{"id":"96264746.839a88","type":"ui_led","z":"43ef2c43.d1ee64","group":"1279d65f.d6ccfa","order":1,"width":0,"height":0,"label":"Aquecedor","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"gray","value":"0","valueType":"num"},{"color":"red","value":"1","valueType":"num"}],"allowColorForValueInMessage":false,"name":"Aquecedor","x":670,"y":340,"wires":[]},{"id":"6bd0d686.785c18","type":"mqtt in","z":"43ef2c43.d1ee64","name":"","topic":"lumin","qos":"2","datatype":"auto","broker":"23197280.b5a25e","x":110,"y":240,"wires":[["e4741a27.a36348"]]},{"id":"30b71cbb.0e9244","type":"ui_gauge","z":"43ef2c43.d1ee64","name":"Luminosidade","group":"a013b4d9.613428","order":1,"width":"6","height":"4","gtype":"gage","title":"Current","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":680,"y":240,"wires":[]},{"id":"3713d6d9.b14eda","type":"function","z":"43ef2c43.d1ee64","name":"Luminosidade","func":"global.set(msg.topic, msg.payload);\n\nlumin = msg.payload;\nlumin = lumin.toFixed(2);\nmsg.payload = lumin;\n\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":240,"wires":[["30b71cbb.0e9244"]]},{"id":"770ae613.2810c8","type":"mqtt in","z":"f723035c.fccf4","name":"Temperatura","topic":"temp","qos":"2","datatype":"auto","broker":"23197280.b5a25e","x":110,"y":80,"wires":[["eb8c2e7a.bb22e"]]},{"id":"c0183dd8.2b48f","type":"mqtt in","z":"f723035c.fccf4","name":"Humidade","topic":"humid","qos":"2","datatype":"auto","broker":"23197280.b5a25e","x":100,"y":160,"wires":[["703a7ed1.a93e"]]},{"id":"7369e589.8361fc","type":"ui_gauge","z":"f723035c.fccf4","name":"Humidade","group":"90c2b05e.6fbd4","order":1,"width":"6","height":"4","gtype":"gage","title":"Current","label":"%","format":"{{value}}","min":"40","max":"100","colors":["#008000","#e6e600","#ca3838"],"seg1":"","seg2":"","x":650,"y":160,"wires":[]},{"id":"c064d6e6.6a4958","type":"ui_gauge","z":"f723035c.fccf4","name":"Temperatura","group":"e612c532.2532c8","order":1,"width":"6","height":"4","gtype":"gage","title":"Current","label":"ºC","format":"{{value}}","min":"15","max":"30","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":650,"y":80,"wires":[]},{"id":"cba4f4f1.879758","type":"function","z":"f723035c.fccf4","name":"Temperatura","func":"global.set(msg.topic, msg.payload);\n\ntemp = msg.payload;\ntemp = temp.toFixed(2);\nmsg.payload = temp;\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":80,"wires":[["c064d6e6.6a4958"]]},{"id":"71b5aa6d.64c304","type":"function","z":"f723035c.fccf4","name":"Humidade","func":"global.set(msg.topic, msg.payload);\n\nhumid = msg.payload;\nhumid = humid.toFixed(2);\nmsg.payload = humid;\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":160,"wires":[["7369e589.8361fc"]]},{"id":"49c64e38.819b8","type":"e-mail","z":"e114be5c.8411","server":"smtp.gmail.com","port":"465","secure":true,"tls":true,"name":"joaopedro.bastos96@gmail.com","dname":"","x":790,"y":120,"wires":[]},{"id":"b3ccd44d.2fe768","type":"mqtt in","z":"e114be5c.8411","name":"Estado","topic":"estado","qos":"2","datatype":"auto","broker":"23197280.b5a25e","x":110,"y":120,"wires":[["2161981.e9f8468"]]},{"id":"2161981.e9f8468","type":"json","z":"e114be5c.8411","name":"","property":"payload","action":"","pretty":false,"x":330,"y":120,"wires":[["81b8c0b.315974","15cf29e8.ed0f56"]]},{"id":"81b8c0b.315974","type":"function","z":"e114be5c.8411","name":"Manutenção","func":"var previous_estado = context.previous_estado\n\nvar estado = msg.payload;\n\ncontext.previous_estado = estado;\n\n\n// Check if the new state is different from the previous\nif (previous_estado != estado){\n\tif (estado===0){\n\t    msg.topic = \"Falha!\";\n\t\tmsg.payload = \"O dispositivo precisa de manutenção!\";\n\t\treturn msg;\n\t}\n\telse if (estado==1){\n\t    msg.topic = \"Tudo Ok!\";\n\t\tmsg.payload = \"O dispositivo está a funcionar corretamente!\";\n\t\treturn msg;\n\t}\n}","outputs":1,"noerr":0,"x":510,"y":120,"wires":[["49c64e38.819b8"]]},{"id":"15cf29e8.ed0f56","type":"function","z":"e114be5c.8411","name":"Manutenção","func":"/*msg.payload = {}\nmsg.payload.chatId = 973258847;\nmsg.payload.type = 'message';\nmsg.payload.content = 'hello from node-red!';*/\n\nvar previous_estado = context.previous_estado\n\nvar estado = msg.payload;\n\ncontext.previous_estado = estado;\n\n// Check if the new state is different from the previous\nif (previous_estado != estado){\n\tif (estado===0){\n\t    //msg.topic = \"Falha!\";\n\t    msg.payload = {}\n        msg.payload.chatId = 973258847;\n        msg.payload.type = 'message';\n\t\tmsg.payload.content = 'O dispositivo precisa de manutenção!';\n\t\treturn msg;\n\t}\n\telse if (estado==1){\n\t    //msg.topic = \"Tudo Ok!\";\n\t    msg.payload = {}\n        msg.payload.chatId = 973258847;\n        msg.payload.type = 'message';\n\t\tmsg.payload.content = 'O dispositivo está a funcionar corretamente!';\n\t\treturn msg;\n\t}\n}","outputs":1,"noerr":0,"x":510,"y":260,"wires":[["355582a.46eee7e"]]},{"id":"355582a.46eee7e","type":"telegram sender","z":"e114be5c.8411","name":"","bot":"ed424eca.1598c","x":750,"y":260,"wires":[[]]},{"id":"eb8c2e7a.bb22e","type":"json","z":"f723035c.fccf4","name":"","property":"payload","action":"","pretty":false,"x":270,"y":80,"wires":[["cba4f4f1.879758"]]},{"id":"703a7ed1.a93e","type":"json","z":"f723035c.fccf4","name":"","property":"payload","action":"","pretty":false,"x":270,"y":160,"wires":[["71b5aa6d.64c304"]]},{"id":"be7e2501.64e628","type":"json","z":"43ef2c43.d1ee64","name":"","property":"payload","action":"","pretty":false,"x":270,"y":140,"wires":[["31fbbfed.8f68"]]},{"id":"5b7b3614.5bf0a8","type":"json","z":"43ef2c43.d1ee64","name":"","property":"payload","action":"","pretty":false,"x":270,"y":40,"wires":[["7cc096e4.7dc398"]]},{"id":"c8a94d8a.a74e","type":"json","z":"43ef2c43.d1ee64","name":"","property":"payload","action":"","pretty":false,"x":270,"y":340,"wires":[["92279eb3.b2125"]]},{"id":"e4741a27.a36348","type":"json","z":"43ef2c43.d1ee64","name":"","property":"payload","action":"","pretty":false,"x":270,"y":240,"wires":[["3713d6d9.b14eda"]]},{"id":"9681f0b1.e09f2","type":"mysql","z":"43ef2c43.d1ee64","mydb":"5eaf9756.4fd2e8","name":"MySQL","x":580,"y":420,"wires":[[]]},{"id":"3bedf009.51355","type":"mysql","z":"43ef2c43.d1ee64","mydb":"5eaf9756.4fd2e8","name":"MySQL","x":580,"y":480,"wires":[["461be626.b09de8"]]},{"id":"d40b6341.6471c","type":"http request","z":"19f6fb43.a03525","name":"GET Thing","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":510,"y":300,"wires":[["7bee4693.0a9728","eefbae64.10546","b35fe1f5.0ac28","5bd4c12c.d0ddf","3f6438b5.f057f8"]]},{"id":"65f342dc.31d09c","type":"inject","z":"19f6fb43.a03525","name":"","topic":"","payload":"","payloadType":"date","repeat":"10","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":300,"wires":[["f8c739cb.a933a8"]]},{"id":"6db711b9.311a7","type":"inject","z":"19f6fb43.a03525","name":"","topic":"","payload":"","payloadType":"date","repeat":"3480","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":100,"wires":[["6f7a6acf.0d00b4"]]},{"id":"6f7a6acf.0d00b4","type":"oauth2","z":"19f6fb43.a03525","name":"OAuth2","container":"payload","access_token_url":"https://access.bosch-iot-suite.com/token","grant_type":"client_credentials","username":"PedroRendeiro","password":"","client_id":"5b6e037a-6183-43eb-a667-01a609ce5e03","client_secret":"E78A29B649CBA76835850817C15344B1","scope":"service:iot-hub-prod:t6246773985cc4d95816d9bc53ceb61c5_hub/full-access service:iot-things-eu-1:62467739-85cc-4d95-816d-9bc53ceb61c5_things/full-access","x":300,"y":100,"wires":[["fdc13d21.529c7"]]},{"id":"726da0e1.cf483","type":"change","z":"19f6fb43.a03525","name":"Set Bearer","rules":[{"t":"set","p":"bearer","pt":"flow","to":"payload.oauth2Response.body.access_token","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":650,"y":40,"wires":[["de2049cf.9c8418"]]},{"id":"f8c739cb.a933a8","type":"function","z":"19f6fb43.a03525","name":"Get Bearer","func":"msg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.ESP8266.SFP%3Aesp8266_completo'\n\nmsg.headers = {\n    Authorization: \"Bearer \"+ flow.get('bearer')\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":310,"y":300,"wires":[["d40b6341.6471c"]]},{"id":"cda9cc8e.3877c","type":"ui_gauge","z":"19f6fb43.a03525","name":"","group":"ac2e701.274f69","order":1,"width":0,"height":0,"gtype":"gage","title":"Last Read","label":"ºC","format":"{{value}}","min":0,"max":"30","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":950,"y":160,"wires":[]},{"id":"f434cb82.c013b8","type":"ui_text","z":"19f6fb43.a03525","group":"56aee08b.df3bc","order":1,"width":0,"height":0,"name":"","label":"Last Token Time","format":"{{msg.payload}}","layout":"row-spread","x":1080,"y":100,"wires":[]},{"id":"de2049cf.9c8418","type":"moment","z":"19f6fb43.a03525","name":"","topic":"","input":"","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD-MMM HH:mm","locale":"pt_PT","output":"","outputType":"msg","outTz":"Europe/Lisbon","x":860,"y":40,"wires":[["f434cb82.c013b8"]]},{"id":"36ee743a.bed81c","type":"MSSQL","z":"19f6fb43.a03525","mssqlCN":"a8a4a3e9.e86fe","name":"SQL_test","query":"","outField":"payload","x":480,"y":440,"wires":[["a518e92.8a84318"]]},{"id":"fdc13d21.529c7","type":"switch","z":"19f6fb43.a03525","name":"","property":"payload.oauth2Response.body.access_token","propertyType":"msg","rules":[{"t":"nempty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":470,"y":100,"wires":[["726da0e1.cf483"],["bf5af832.7a33d8"]]},{"id":"bf5af832.7a33d8","type":"change","z":"19f6fb43.a03525","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Error","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":740,"y":120,"wires":[["f434cb82.c013b8"]]},{"id":"a518e92.8a84318","type":"switch","z":"19f6fb43.a03525","name":"","property":"payload","propertyType":"msg","rules":[{"t":"istype","v":"undefined","vt":"undefined"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":690,"y":440,"wires":[["cad257bf.408348"],["e5aa5c77.0787e"]]},{"id":"1f067954.fba467","type":"ui_text","z":"19f6fb43.a03525","group":"56aee08b.df3bc","order":1,"width":0,"height":0,"name":"","label":"Last DB INSERT","format":"{{msg.payload}}","layout":"row-spread","x":1350,"y":440,"wires":[]},{"id":"cad257bf.408348","type":"change","z":"19f6fb43.a03525","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"","tot":"date"}],"action":"","property":"","from":"","to":"","reg":false,"x":880,"y":400,"wires":[["140efd84.a16462"]]},{"id":"140efd84.a16462","type":"moment","z":"19f6fb43.a03525","name":"","topic":"","input":"","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD-MMM HH:mm","locale":"pt_PT","output":"","outputType":"msg","outTz":"Europe/Lisbon","x":1100,"y":400,"wires":[["1f067954.fba467"]]},{"id":"e5aa5c77.0787e","type":"change","z":"19f6fb43.a03525","name":"","rules":[{"t":"set","p":"payload","pt":"msg","to":"Error","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1000,"y":480,"wires":[["1f067954.fba467"]]},{"id":"3aae3596.db2ada","type":"ui_chart","z":"19f6fb43.a03525","name":"","group":"ac2e701.274f69","order":2,"width":"0","height":"0","label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"0","ymax":"30","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":940,"y":200,"wires":[[]]},{"id":"165c3984.fd3486","type":"inject","z":"19f6fb43.a03525","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":770,"y":720,"wires":[["be6b208d.db2b5"]]},{"id":"be6b208d.db2b5","type":"change","z":"19f6fb43.a03525","name":"","rules":[{"t":"set","p":"lastRead","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":720,"wires":[[]]},{"id":"eefbae64.10546","type":"function","z":"19f6fb43.a03525","name":"Temperature","func":"temp = msg.payload.features.temperature.properties.status.value;\n\n//msg.payload=parseFloat(value).toFixed(2);\ntemp = temp.toFixed(2);\nmsg.payload = temp;\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":200,"wires":[["3aae3596.db2ada","cda9cc8e.3877c"]]},{"id":"b35fe1f5.0ac28","type":"function","z":"19f6fb43.a03525","name":"Humidity","func":"humid=msg.payload.features.humidity.properties.status.sensorValue;\n//msg.payload=parseFloat(value).toFixed(2);\nhumid = humid.toFixed(2);\nmsg.payload = humid;\nreturn msg;","outputs":1,"noerr":0,"x":720,"y":320,"wires":[["3e59558b.ac904a","997c10a.18d02f"]]},{"id":"3e59558b.ac904a","type":"ui_chart","z":"19f6fb43.a03525","name":"","group":"89ba1982.42e818","order":2,"width":"0","height":"0","label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":940,"y":360,"wires":[[]]},{"id":"997c10a.18d02f","type":"ui_gauge","z":"19f6fb43.a03525","name":"","group":"89ba1982.42e818","order":1,"width":0,"height":0,"gtype":"gage","title":"Last Read","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":950,"y":320,"wires":[]},{"id":"7bee4693.0a9728","type":"debug","z":"19f6fb43.a03525","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":600,"y":380,"wires":[]},{"id":"39c5d0d.e824b3","type":"function","z":"43ef2c43.d1ee64","name":"LuminOut","func":"var i;\nvar x = [];\nvar y = [];\nvar pl_old = msg.payload;\nvar pl_new = [];\n\nfor (i = 0; i<pl_old.length; i++) {\n    // get data info x and y, and convert to unix time format:\n    x[i] = new Date(pl_old[i].Date).getTime();\n    y[i] = pl_old[i].Luminosity;\n    \n    // generate key-value pair:\n    pl_new[i] = {\"x\":x[i], \"y\":y[i]};\n}\n\n// Redefine msg.payload and return:\nmsg.payload = [{\"series\":[\"Luminosity\"], \"labels\":[\"Luminosity\"], \"data\":[pl_new]}];\n\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":200,"wires":[["38a88a4b.ef4ca6"]]},{"id":"38a88a4b.ef4ca6","type":"ui_chart","z":"43ef2c43.d1ee64","name":"Luminosidade (Histórico)","group":"a013b4d9.613428","order":2,"width":"7","height":"5","label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":1170,"y":200,"wires":[[]]},{"id":"8f1f7568.c85ff8","type":"link in","z":"43ef2c43.d1ee64","name":"","links":["461be626.b09de8"],"x":815,"y":200,"wires":[["39c5d0d.e824b3"]]},{"id":"88684e3c.dd316","type":"mqtt in","z":"f723035c.fccf4","name":"","topic":"estado","qos":"2","datatype":"auto","broker":"23197280.b5a25e","x":90,"y":240,"wires":[["cb28cafc.efa6b8"]]},{"id":"8764a3f4.9695e","type":"function","z":"f723035c.fccf4","name":"Estado Máquina","func":"global.set(msg.topic, msg.payload);\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":240,"wires":[["3211547b.096acc"]]},{"id":"3211547b.096acc","type":"ui_led","z":"f723035c.fccf4","group":"dcb45bcb.979e18","order":1,"width":0,"height":0,"label":"Machine","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"red","value":"0","valueType":"num"},{"color":"green","value":"1","valueType":"num"}],"allowColorForValueInMessage":false,"name":"Máquina","x":640,"y":240,"wires":[]},{"id":"cb28cafc.efa6b8","type":"json","z":"f723035c.fccf4","name":"","property":"payload","action":"","pretty":false,"x":270,"y":240,"wires":[["8764a3f4.9695e"]]},{"id":"5bd4c12c.d0ddf","type":"function","z":"19f6fb43.a03525","name":"Luminosidade","func":"lumin = msg.payload.features.illuminance.properties.status.value.currentMeasured;\n\nlumin = lumin.toFixed(2);\n\nmsg.payload = lumin;\nreturn msg;","outputs":1,"noerr":0,"x":740,"y":260,"wires":[["5ac164f4.7e00ac","a5ed3d14.188f4"]]},{"id":"5ac164f4.7e00ac","type":"ui_gauge","z":"19f6fb43.a03525","name":"","group":"5ce74ef8.0759d","order":1,"width":0,"height":0,"gtype":"gage","title":"Last Read","label":"%","format":"{{value}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":950,"y":240,"wires":[]},{"id":"a5ed3d14.188f4","type":"ui_chart","z":"19f6fb43.a03525","name":"","group":"5ce74ef8.0759d","order":2,"width":"0","height":"0","label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":940,"y":280,"wires":[[]]},{"id":"8e79e9bf.5fe278","type":"debug","z":"19f6fb43.a03525","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":490,"y":520,"wires":[]},{"id":"3f6438b5.f057f8","type":"function","z":"19f6fb43.a03525","name":"SQL Query","func":"var temp = msg.payload.features.temperature.properties.status.value;\nvar humid = msg.payload.features.humidity.properties.status.sensorValue;\nvar lumin = msg.payload.features.illuminance.properties.status.value.currentMeasured;\nestado = msg.payload.features.localcontrolstate.properties.status.currentState;\n//var estado = 0;\n\npld = 'INSERT INTO [bd_node_red].[dbo].[office_table] (Temperature, Humidity, Luminosity, State, Timestamp)' \npld = pld + 'VALUES (' + temp + ',' + humid + ',' + lumin + ',' + estado + ', GETDATE());';\n\nmsg.payload = pld;\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":440,"wires":[["36ee743a.bed81c","8e79e9bf.5fe278"]]},{"id":"af65d78c.a50ab8","type":"function","z":"f723035c.fccf4","name":"TempOut","func":"var i;\nvar x = [];\nvar y = [];\nvar pl_old = msg.payload;\nvar pl_new = [];\n\nfor (i = 0; i<pl_old.length; i++) {\n    // get data info x and y, and convert to unix time format:\n    x[i] = new Date(pl_old[i].Date).getTime();\n    y[i] = pl_old[i].Temperature;\n    \n    // generate key-value pair:\n    pl_new[i] = {\"x\":x[i], \"y\":y[i]};\n}\n\n// Redefine msg.payload and return:\nmsg.payload = [{\"series\":[\"Temperature\"], \"labels\":[\"Temperature\"], \"data\":[pl_new]}];\n\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":420,"wires":[["3cd25ead.d5c1e2"]]},{"id":"3cd25ead.d5c1e2","type":"ui_chart","z":"f723035c.fccf4","name":"Temperatura (Histórico)","group":"e612c532.2532c8","order":2,"width":"0","height":"0","label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"15","ymax":"30","removeOlder":"1","removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":530,"y":420,"wires":[[]]},{"id":"8631042b.8758a8","type":"function","z":"f723035c.fccf4","name":"OutDataBase","func":"msg.topic = \"SELECT * FROM machine_table\";\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":360,"wires":[["cde5eab6.6e24b8"]]},{"id":"ace29c2c.56555","type":"inject","z":"f723035c.fccf4","name":"SendEvery30s","topic":"Temporizador","payload":"","payloadType":"date","repeat":"30","crontab":"","once":true,"onceDelay":"2","x":140,"y":360,"wires":[["8631042b.8758a8"]]},{"id":"39855de8.80e362","type":"link out","z":"f723035c.fccf4","name":"OutDataBase","links":["f4dfdb57.cb9398","a4f2e936.edcca8"],"x":695,"y":360,"wires":[]},{"id":"f4dfdb57.cb9398","type":"link in","z":"f723035c.fccf4","name":"","links":["39855de8.80e362"],"x":115,"y":420,"wires":[["af65d78c.a50ab8"]]},{"id":"80631e9a.f39a5","type":"function","z":"f723035c.fccf4","name":"HumdOut","func":"var i;\nvar x = [];\nvar y = [];\nvar pl_old = msg.payload;\nvar pl_new = [];\n\nfor (i = 0; i<pl_old.length; i++) {\n    // get data info x and y, and convert to unix time format:\n    x[i] = new Date(pl_old[i].Date).getTime();\n    y[i] = pl_old[i].Humidity;\n    \n    // generate key-value pair:\n    pl_new[i] = {\"x\":x[i], \"y\":y[i]};\n}\n\n// Redefine msg.payload and return:\nmsg.payload = [{\"series\":[\"Humidity\"], \"labels\":[\"Humidity\"], \"data\":[pl_new]}];\n\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":500,"wires":[["bfd8b797.08b788"]]},{"id":"bfd8b797.08b788","type":"ui_chart","z":"f723035c.fccf4","name":"Humidade (Histórico)","group":"90c2b05e.6fbd4","order":2,"width":"0","height":"0","label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"40","ymax":"100","removeOlder":1,"removeOlderPoints":"","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":520,"y":500,"wires":[[]]},{"id":"a4f2e936.edcca8","type":"link in","z":"f723035c.fccf4","name":"","links":["39855de8.80e362"],"x":115,"y":500,"wires":[["80631e9a.f39a5"]]},{"id":"cde5eab6.6e24b8","type":"mysql","z":"f723035c.fccf4","mydb":"5eaf9756.4fd2e8","name":"MySQL","x":580,"y":360,"wires":[["39855de8.80e362"]]},{"id":"f21fe16b.1df27","type":"function","z":"f723035c.fccf4","name":"MySQL Function","func":"var temp = global.get('temp');\nvar humd = global.get('humid');\nvar status = global.get('estado');\n\nmsg.topic = \"INSERT INTO machine_table(Temperature, Humidity, Status) VALUES ('\"\nmsg.topic = msg.topic + temp + \"','\";\nmsg.topic = msg.topic + humd + \"',\";\nmsg.topic = msg.topic + status + \")\";\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":300,"wires":[["3f12c832.77af58"]]},{"id":"1402981.a599768","type":"inject","z":"f723035c.fccf4","name":"SendEvery30s","topic":"Temporizador","payload":"","payloadType":"date","repeat":"30","crontab":"","once":true,"onceDelay":"2","x":140,"y":300,"wires":[["f21fe16b.1df27"]]},{"id":"3f12c832.77af58","type":"mysql","z":"f723035c.fccf4","mydb":"5eaf9756.4fd2e8","name":"MySQL","x":580,"y":300,"wires":[[]]},{"id":"6669ba8e.a19cb4","type":"ui_chart","z":"cbc934b7.020958","name":"","group":"71c7fa47.0a1074","order":3,"width":0,"height":0,"label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"0","ymax":"30","removeOlder":"1","removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":2100,"y":660,"wires":[[]]},{"id":"4481ea56.18b194","type":"ui_chart","z":"cbc934b7.020958","name":"","group":"ce0bb80c.ee4f68","order":3,"width":0,"height":0,"label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":2100,"y":720,"wires":[[]]},{"id":"efe5499a.2a2af8","type":"ui_gauge","z":"cbc934b7.020958","name":"","group":"ce0bb80c.ee4f68","order":1,"width":0,"height":0,"gtype":"gage","title":"Last Read","label":"%","format":"{{msg.payload}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2090,"y":380,"wires":[]},{"id":"3b001f21.8ed2a","type":"ui_gauge","z":"cbc934b7.020958","name":"","group":"ce24cce4.037e2","order":1,"width":0,"height":0,"gtype":"gage","title":"Last Read","label":"%","format":"{{msg.payload}}","min":0,"max":"100","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2090,"y":440,"wires":[]},{"id":"353a2fc4.88ebd","type":"ui_chart","z":"cbc934b7.020958","name":"","group":"ce24cce4.037e2","order":3,"width":0,"height":0,"label":"Historic","chartType":"line","legend":"false","xformat":"HH:mm:ss","interpolate":"step","nodata":"","dot":false,"ymin":"0","ymax":"100","removeOlder":1,"removeOlderPoints":"1000","removeOlderUnit":"3600","cutout":0,"useOneColor":false,"colors":["#1f77b4","#aec7e8","#ff7f0e","#2ca02c","#98df8a","#d62728","#ff9896","#9467bd","#c5b0d5"],"useOldStyle":false,"outputs":1,"x":2100,"y":780,"wires":[[]]},{"id":"5e5ff4a1.6d26ac","type":"ui_text","z":"cbc934b7.020958","group":"71c7fa47.0a1074","order":2,"width":0,"height":0,"name":"","label":"Last Read Date","format":"{{payload}}","layout":"col-center","x":2220,"y":520,"wires":[]},{"id":"75df1e6.4ebe2e","type":"json","z":"cbc934b7.020958","name":"","property":"payload","action":"str","pretty":false,"x":2250,"y":1300,"wires":[["fa7cbead.1654a"]]},{"id":"fa7cbead.1654a","type":"file","z":"cbc934b7.020958","name":"","filename":"/home/pi/Desktop/datasource_timestamp.json","appendNewline":true,"createDir":true,"overwriteFile":"false","encoding":"none","x":2520,"y":1300,"wires":[[]]},{"id":"7f0bf904.d685c8","type":"function","z":"cbc934b7.020958","name":"Json File","func":"temp = msg.payload.features.temperature.properties.status.value.currentMeasured;\ntemp = temp.toFixed(2);\n\nhumid = msg.payload.features.humidity.properties.status.value.currentMeasured;\nhumid = humid.toFixed(2);\n\nlumin = msg.payload.features.illuminance.properties.status.value.currentMeasured;\nlumin = lumin.toFixed(2);\n\ndate = flow.get(\"data\");\nmsg.payload = {\"Date\": date, \"Temperature(ºC)\": temp, \"Humidity(%)\": humid, \"Luminosity(%)\": lumin};\n\nreturn msg;","outputs":1,"noerr":0,"x":2100,"y":1300,"wires":[["75df1e6.4ebe2e"]]},{"id":"48c144ce.c6d82c","type":"function","z":"cbc934b7.020958","name":"Aceleração X","func":"acel_x = msg.payload.features.acceleration.properties.status.value.x\nmsg.payload = acel_x;\nreturn msg;","outputs":1,"noerr":0,"x":2320,"y":1640,"wires":[["ccdf2f02.1c6f8","bfaeefb5.529d7"]]},{"id":"d7e1947.d140c68","type":"function","z":"cbc934b7.020958","name":"Aceleração Y","func":"acel_y = msg.payload.features.acceleration.properties.status.value.y\nmsg.payload = acel_y;\nreturn msg;","outputs":1,"noerr":0,"x":2310,"y":1740,"wires":[["6101fb65.290cd4","3c362d9e.0a81f2"]]},{"id":"de3a8cdc.d75a3","type":"function","z":"cbc934b7.020958","name":"Aceleração Z","func":"acel_z = msg.payload.features.acceleration.properties.status.value.z\nmsg.payload = acel_z;\nreturn msg;","outputs":1,"noerr":0,"x":2310,"y":1840,"wires":[["2d2a5524.f5cfda","dfb806b8.615298"]]},{"id":"6101fb65.290cd4","type":"ui_text","z":"cbc934b7.020958","d":true,"group":"2499b8bd.fe3a78","order":3,"width":5,"height":1,"name":"","label":"Acceleration Y","format":"{{value}}","layout":"row-spread","x":2540,"y":1720,"wires":[]},{"id":"2d2a5524.f5cfda","type":"ui_text","z":"cbc934b7.020958","d":true,"group":"2499b8bd.fe3a78","order":5,"width":5,"height":1,"name":"","label":"Acceleration Z","format":"{{value}}","layout":"row-spread","x":2540,"y":1820,"wires":[]},{"id":"ccdf2f02.1c6f8","type":"ui_text","z":"cbc934b7.020958","d":true,"group":"2499b8bd.fe3a78","order":1,"width":5,"height":1,"name":"","label":"Acceleration X","format":"{{value}}","layout":"row-spread","x":2540,"y":1620,"wires":[]},{"id":"cbf50e54.34146","type":"ui_led","z":"cbc934b7.020958","d":true,"group":"2499b8bd.fe3a78","order":2,"width":1,"height":1,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"red","value":"false","valueType":"bool"},{"color":"green","value":"true","valueType":"bool"}],"allowColorForValueInMessage":false,"name":"LED X","x":2810,"y":1660,"wires":[]},{"id":"281c1c5f.446134","type":"ui_led","z":"cbc934b7.020958","d":true,"group":"2499b8bd.fe3a78","order":4,"width":1,"height":1,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"red","value":"false","valueType":"bool"},{"color":"green","value":"true","valueType":"bool"}],"allowColorForValueInMessage":false,"name":"LED Y","x":2810,"y":1760,"wires":[]},{"id":"4d3be75e.57cd68","type":"ui_led","z":"cbc934b7.020958","d":true,"group":"2499b8bd.fe3a78","order":6,"width":1,"height":1,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"red","value":"false","valueType":"bool"},{"color":"green","value":"true","valueType":"bool"}],"allowColorForValueInMessage":false,"name":"LED Z","x":2810,"y":1860,"wires":[]},{"id":"bfaeefb5.529d7","type":"function","z":"cbc934b7.020958","name":"Aceleração X","func":"x = msg.payload;\n\nif (x < -10){\n    msg.payload = false;\n    return msg;\n}else if (x > 10){\n    msg.payload = false;\n    return msg;\n}else if (x >= -10 || x <= 10){\n    msg.payload = true;\n    return msg;\n}","outputs":1,"noerr":0,"x":2540,"y":1660,"wires":[["cbf50e54.34146"]]},{"id":"3c362d9e.0a81f2","type":"function","z":"cbc934b7.020958","name":"Aceleração Y","func":"x = msg.payload;\n\nif (x < -10){\n    msg.payload = false;\n    return msg;\n}else if (x > 10){\n    msg.payload = false;\n    return msg;\n}else if (x >= -10 || x <= 10){\n    msg.payload = true;\n    return msg;\n}","outputs":1,"noerr":0,"x":2530,"y":1760,"wires":[["281c1c5f.446134"]]},{"id":"dfb806b8.615298","type":"function","z":"cbc934b7.020958","name":"Aceleração Z","func":"x = msg.payload;\n\nif (x >= 60 && x <= 68){\n    msg.payload = true;\n    return msg;\n}\nelse if (x >= -68 && x <= -60){\n    msg.payload = true;\n    return msg;\n}\nelse{\n    msg.payload = false;\n    return msg;\n}","outputs":1,"noerr":0,"x":2530,"y":1860,"wires":[["4d3be75e.57cd68"]]},{"id":"62562971.81f458","type":"inject","z":"cbc934b7.020958","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"00 00 * * *","once":false,"onceDelay":0.1,"x":2090,"y":1380,"wires":[[]]},{"id":"494c969f.a95ba8","type":"file in","z":"cbc934b7.020958","name":"","filename":"/home/pi/Desktop/datasource_timestamp.json","format":"lines","chunk":false,"sendError":false,"encoding":"none","x":2360,"y":1380,"wires":[["e8901587.2cefc8"]]},{"id":"e8901587.2cefc8","type":"join","z":"cbc934b7.020958","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":2610,"y":1380,"wires":[["408049c3.78b3c8","6efc4816.578bf8"]]},{"id":"408049c3.78b3c8","type":"function","z":"cbc934b7.020958","name":"","func":"msg.payload = msg.payload.split('\\n').join(',');\nmsg.payload = msg.payload.substring(0, msg.payload.length - 1);\nmsg.payload = \"[\" + msg.payload + \"]\";\n\nreturn msg;","outputs":1,"noerr":0,"x":2210,"y":1480,"wires":[["577a33ff.7cfd0c"]]},{"id":"577a33ff.7cfd0c","type":"json","z":"cbc934b7.020958","name":"","property":"payload","action":"","pretty":false,"x":2350,"y":1480,"wires":[["8511a326.52944"]]},{"id":"8511a326.52944","type":"function","z":"cbc934b7.020958","name":"","func":"currentDate = new Date();\n\nfor (var key in msg.payload) {\n    logDate = new Date(msg.payload[key].Date);\n    diffTime = Math.abs(currentDate - logDate);\n    diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\n    if (diffDays < 10) {\n        //msg.payload.splice(key, 1);\n        node.send({ payload: msg.payload[key] });\n    }\n}","outputs":1,"noerr":0,"x":2490,"y":1480,"wires":[["5980d718.7cdcd8"]]},{"id":"5980d718.7cdcd8","type":"json","z":"cbc934b7.020958","name":"","property":"payload","action":"str","pretty":false,"x":2650,"y":1480,"wires":[["129da79d.06de38"]]},{"id":"129da79d.06de38","type":"file","z":"cbc934b7.020958","name":"","filename":"/home/pi/Desktop/datasource_timestamp.json","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":2940,"y":1480,"wires":[[]]},{"id":"6efc4816.578bf8","type":"fs-ops-delete","z":"cbc934b7.020958","name":"","path":"/home/pi/Desktop","pathType":"str","filename":"datasource_timestamp.json","filenameType":"str","x":2830,"y":1380,"wires":[[]]},{"id":"fc4cabef.d6bed8","type":"MSSQL","z":"cbc934b7.020958","d":true,"mssqlCN":"db0f3897.9ac6e8","name":"","query":"","outField":"payload","x":2275,"y":1080,"wires":[["b06ef2e9.c9d57"]],"l":false},{"id":"389f1955.26c876","type":"function","z":"cbc934b7.020958","d":true,"name":"Insert","func":"msg.payload = 'INSERT INTO [dbo].[communication] (Status) VALUES (\\'Received\\');';\n\nreturn msg;","outputs":1,"noerr":0,"x":2150,"y":1040,"wires":[["fc4cabef.d6bed8"]]},{"id":"b06ef2e9.c9d57","type":"function","z":"cbc934b7.020958","d":true,"name":"Select","func":"msg.payload = \"SELECT TOP 1 DateTime FROM [dbo].[communication] ORDER BY ID DESC;\";\n\nreturn msg;","outputs":1,"noerr":0,"x":2410,"y":1080,"wires":[[]]},{"id":"3430422c.c3c41e","type":"moment","z":"cbc934b7.020958","name":"","topic":"","input":"payload[0].DateTime","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD-MM-YYYY HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1880,"y":520,"wires":[["5e5ff4a1.6d26ac","a50f1db6.22dc6","aabc8600.efeec8"]]},{"id":"c3d57acc.bc8aa8","type":"function","z":"cbc934b7.020958","d":true,"name":"Insert","func":"msg.payload = 'INSERT INTO [dbo].[communication] (Status) VALUES (\\'Sent\\');';\n\nreturn msg;","outputs":1,"noerr":0,"x":2150,"y":1100,"wires":[["fc4cabef.d6bed8"]]},{"id":"4e6c115f.6f532","type":"function","z":"cbc934b7.020958","name":"Temperature","func":"temp = msg.payload[0].Temperature\n\nmsg.payload = temp;\n\nreturn msg;","outputs":1,"noerr":0,"x":1850,"y":320,"wires":[["2e572310.55fdbc"]]},{"id":"77f7fac8.2e43c4","type":"function","z":"cbc934b7.020958","name":"Insert","func":"device_id = msg.payload.thingId;\ndevice_id = device_id.substr(18);\n\ntemp = msg.payload.features.temperature.properties.status.value;\n\nhumid= msg.payload.features.humidity.properties.status.sensorValue;\n\nlumin = msg.payload.features.illuminance.properties.status.value.currentMeasured;\n\nmsg.payload = \"INSERT INTO [dbo].[monitoring] (Device_ID, Temperature, Humidity, Luminosity) VALUES (\\'\"+ device_id + \"\\',\" + temp + \",\" + humid + \",\" + lumin +\");\";\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":960,"wires":[["731e782.f7d7d88"]]},{"id":"2e572310.55fdbc","type":"ui_gauge","z":"cbc934b7.020958","name":"","group":"71c7fa47.0a1074","order":1,"width":0,"height":0,"gtype":"gage","title":"Last Read","label":"ºC","format":"{{msg.payload}}","min":0,"max":"30","colors":["#00b500","#e6e600","#ca3838"],"seg1":"","seg2":"","x":2090,"y":320,"wires":[]},{"id":"7bcaa5a0.d6e32c","type":"function","z":"cbc934b7.020958","name":"Humidity","func":"humid = msg.payload[0].Humidity;\n\nmsg.payload = humid;\n\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":380,"wires":[["efe5499a.2a2af8"]]},{"id":"837ddbae.3d71c8","type":"function","z":"cbc934b7.020958","name":"Luminosity","func":"lumin = msg.payload[0].Luminosity;\n\nmsg.payload = lumin;\n\nreturn msg;","outputs":1,"noerr":0,"x":1850,"y":440,"wires":[["3b001f21.8ed2a"]]},{"id":"7bf7e516.5276dc","type":"http request","z":"8b01cf3e.f743f","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"https://api.eu1.bosch-iot-rollouts.com/rest/v1/targets","tls":"","persist":false,"proxy":"","authType":"basic","x":330,"y":100,"wires":[["a1cc5a64.9e1838","9f2c9787.af2eb8"]]},{"id":"b4d61252.0cbd","type":"ui_text","z":"8b01cf3e.f743f","group":"b4da31d4.3161d","order":1,"width":0,"height":0,"name":"","label":"Name","format":"{{msg.payload}}","layout":"row-spread","x":1150,"y":280,"wires":[]},{"id":"37934eb8.e86312","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1200,"y":520,"wires":[["d14786a5.425748"]]},{"id":"b45d46b9.557f38","type":"ui_text","z":"8b01cf3e.f743f","group":"b4da31d4.3161d","order":6,"width":0,"height":0,"name":"","label":"Created By","format":"{{msg.payload}}","layout":"col-center","x":1170,"y":480,"wires":[]},{"id":"d14786a5.425748","type":"ui_text","z":"8b01cf3e.f743f","group":"b4da31d4.3161d","order":7,"width":0,"height":0,"name":"","label":"Created At","format":"{{msg.payload}}","layout":"col-center","x":1410,"y":520,"wires":[]},{"id":"90092bd.8f586d8","type":"inject","z":"8b01cf3e.f743f","name":"Power ON","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":true,"onceDelay":0.1,"x":330,"y":2200,"wires":[["3e87833a.7201fc","4b7b962c.329ab8"]]},{"id":"4e0ed7ba.165ce8","type":"ui_text","z":"8b01cf3e.f743f","group":"89ca011.a83d7","order":1,"width":0,"height":0,"name":"","label":"Last Power ON","format":"{{payload}}","layout":"col-center","x":1460,"y":2200,"wires":[]},{"id":"ec514156.d1fe4","type":"MSSQL","z":"8b01cf3e.f743f","d":true,"mssqlCN":"db0f3897.9ac6e8","name":"","query":"","outField":"payload","x":675,"y":2240,"wires":[["99537a97.724fb8"]],"l":false},{"id":"3e87833a.7201fc","type":"function","z":"8b01cf3e.f743f","d":true,"name":"Insert","func":"msg.payload = 'INSERT INTO [dbo].[status] (Status) VALUES (\\'Power ON\\');';\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":2240,"wires":[["ec514156.d1fe4"]]},{"id":"99537a97.724fb8","type":"function","z":"8b01cf3e.f743f","d":true,"name":"Select","func":"msg.payload = \"SELECT TOP 1 DateTime FROM [dbo].[status] WHERE Status = 'Power ON' ORDER BY ID DESC;\";\n\nreturn msg;","outputs":1,"noerr":0,"x":830,"y":2240,"wires":[["c797c8c0.bf2d78"]]},{"id":"c797c8c0.bf2d78","type":"MSSQL","z":"8b01cf3e.f743f","d":true,"mssqlCN":"db0f3897.9ac6e8","name":"","query":"","outField":"payload","x":1035,"y":2240,"wires":[["4b7b962c.329ab8"]],"l":false},{"id":"4b7b962c.329ab8","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"","inputType":"date","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD-MM-YYYY HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1220,"y":2200,"wires":[["4e0ed7ba.165ce8"]]},{"id":"c5f0e306.e3c","type":"ui_text","z":"8b01cf3e.f743f","group":"a08310c5.70be7","order":1,"width":0,"height":0,"name":"","label":"Name","format":"{{msg.payload.name}}","layout":"row-spread","x":2070,"y":520,"wires":[]},{"id":"d9d4c5b4.2c5ab8","type":"ui_text","z":"8b01cf3e.f743f","group":"a08310c5.70be7","order":2,"width":0,"height":0,"name":"","label":"Version","format":"{{msg.payload.version}}","layout":"row-spread","x":2080,"y":600,"wires":[]},{"id":"9c75ba92.0253e8","type":"ui_text","z":"8b01cf3e.f743f","group":"a08310c5.70be7","order":6,"width":0,"height":0,"name":"","label":"Created by","format":"{{msg.payload.createdBy}}","layout":"col-center","x":2090,"y":920,"wires":[]},{"id":"38cc39a1.4dd906","type":"ui_text","z":"8b01cf3e.f743f","group":"6e71c2c1.9254ac","order":1,"width":0,"height":0,"name":"","label":"Name","format":"{{msg.payload.modules[0].name}}","layout":"row-spread","x":2070,"y":1300,"wires":[]},{"id":"15b16615.0ff01a","type":"ui_text","z":"8b01cf3e.f743f","group":"6e71c2c1.9254ac","order":2,"width":0,"height":0,"name":"","label":"Version","format":"{{msg.payload.modules[0].version}}","layout":"row-spread","x":2080,"y":1380,"wires":[]},{"id":"c98a2d1a.45b6e","type":"ui_text","z":"8b01cf3e.f743f","group":"6e71c2c1.9254ac","order":6,"width":0,"height":0,"name":"","label":"Created by","format":"{{msg.payload.modules[0].createdBy}}","layout":"col-center","x":2090,"y":1700,"wires":[]},{"id":"dcfed986.249828","type":"ui_text","z":"8b01cf3e.f743f","group":"6e71c2c1.9254ac","order":5,"width":0,"height":0,"name":"","label":"Last Modified At","format":"{{value}}","layout":"col-center","x":2100,"y":1620,"wires":[]},{"id":"59895ca5.8d5884","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1820,"y":1620,"wires":[["dcfed986.249828"]]},{"id":"c3dee690.bfb318","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1200,"y":360,"wires":[["d23d028b.5c6c"]]},{"id":"d23d028b.5c6c","type":"ui_text","z":"8b01cf3e.f743f","group":"b4da31d4.3161d","order":3,"width":0,"height":0,"name":"","label":"Last Controller Request At","format":"{{msg.payload}}","layout":"col-center","x":1460,"y":360,"wires":[]},{"id":"ddeb01e.337bd","type":"http request","z":"8b01cf3e.f743f","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1070,"y":780,"wires":[["14050882.529447"]]},{"id":"68f9856d.e51c0c","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1200,"y":440,"wires":[["43d3f415.794acc"]]},{"id":"43d3f415.794acc","type":"ui_text","z":"8b01cf3e.f743f","group":"b4da31d4.3161d","order":5,"width":0,"height":0,"name":"","label":"Last Modified At","format":"{{msg.payload}}","layout":"col-center","x":1420,"y":440,"wires":[]},{"id":"c37f9e26.f2483","type":"ui_text","z":"8b01cf3e.f743f","group":"b4da31d4.3161d","order":4,"width":0,"height":0,"name":"","label":"Last Modified By","format":"{{msg.payload}}","layout":"col-center","x":1180,"y":400,"wires":[]},{"id":"ece5b768.cd40d8","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1620,"y":620,"wires":[["5c9f6742.d04498"]]},{"id":"5c9f6742.d04498","type":"ui_text","z":"8b01cf3e.f743f","group":"a08310c5.70be7","order":3,"width":0,"height":0,"name":"","label":"Installed At","format":"{{msg.payload}}","layout":"col-center","x":2090,"y":680,"wires":[]},{"id":"14050882.529447","type":"function","z":"8b01cf3e.f743f","name":"","func":"msg.url = msg.payload._links.assignedDS.href\n\nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1210,"y":780,"wires":[["21a73876.618528"]]},{"id":"21a73876.618528","type":"http request","z":"8b01cf3e.f743f","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1350,"y":780,"wires":[["c5f0e306.e3c","d9d4c5b4.2c5ab8","9c75ba92.0253e8","38cc39a1.4dd906","15b16615.0ff01a","c98a2d1a.45b6e","2e2f5fb.5e924a","41b1c65e.0b9458","49196a10.7c5894"]]},{"id":"e2b5dbe0.f489d8","type":"function","z":"2cc1377f.832f08","name":"","func":"msg.url = 'https://device.eu1.bosch-iot-rollouts.com/D60F7F26-9AFC-4FFB-8FA5-00A6FC6D774A/controller/v1/esp8266_01'; \n\nmsg.headers = {\n    'Accept': 'application/hal+json',\n    'Authorization': 'TargetToken 16873cd42738d484f3436de00906f5e2'\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":250,"y":60,"wires":[["1d628ef9.d69581"]]},{"id":"1d628ef9.d69581","type":"http request","z":"2cc1377f.832f08","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":390,"y":60,"wires":[["e543b530.04d308"]]},{"id":"ae569ef3.f0559","type":"inject","z":"2cc1377f.832f08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":110,"y":60,"wires":[["e2b5dbe0.f489d8"]]},{"id":"e543b530.04d308","type":"function","z":"2cc1377f.832f08","name":"","func":"msg.url = msg.payload._links.deploymentBase.href\n\nmsg.headers = {\n    'Accept': 'application/hal+json',\n    'Authorization': 'TargetToken 16873cd42738d484f3436de00906f5e2'\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":530,"y":120,"wires":[["42d5c1fc.e9215"]]},{"id":"42d5c1fc.e9215","type":"http request","z":"2cc1377f.832f08","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":690,"y":120,"wires":[["31a77a1e.cc34f6"]]},{"id":"ae7422e7.62906","type":"function","z":"8b01cf3e.f743f","name":"Name","func":"device = flow.get('device');\n\nname = msg.payload.content[device].name;\nmsg.payload = name;\nreturn msg;","outputs":1,"noerr":0,"x":950,"y":280,"wires":[["b4d61252.0cbd"]]},{"id":"77a64370.69eeac","type":"function","z":"8b01cf3e.f743f","name":"Created By","func":"device = flow.get('device');\n\ncreate = msg.payload.content[device].createdBy;\nmsg.payload = create;\nreturn msg;\n","outputs":1,"noerr":0,"x":970,"y":480,"wires":[["b45d46b9.557f38"]]},{"id":"d56bec64.670d8","type":"function","z":"8b01cf3e.f743f","name":"Created At","func":"device = flow.get('device');\n\ndate = msg.payload.content[device].createdAt;\nmsg.payload = date;\nreturn msg;\n","outputs":1,"noerr":0,"x":970,"y":520,"wires":[["37934eb8.e86312"]]},{"id":"139a5b6b.8cc535","type":"function","z":"8b01cf3e.f743f","name":"Last Controller","func":"device = flow.get('device');\n\ndate = msg.payload.content[device].lastControllerRequestAt;\nmsg.payload = date;\nreturn msg;\n","outputs":1,"noerr":0,"x":980,"y":360,"wires":[["c3dee690.bfb318"]]},{"id":"27d2aae1.d37fb6","type":"function","z":"8b01cf3e.f743f","name":"Last Modified By","func":"device = flow.get('device');\n\nmodify = msg.payload.content[device].lastModifiedBy;\nmsg.payload = modify;\nreturn msg;\n","outputs":1,"noerr":0,"x":980,"y":400,"wires":[["c37f9e26.f2483"]]},{"id":"9c08aad9.7cf5e8","type":"function","z":"8b01cf3e.f743f","name":"Last Modified At","func":"device = flow.get('device');\n\ndate = msg.payload.content[device].lastModifiedAt;\nmsg.payload = date;\nreturn msg;\n","outputs":1,"noerr":0,"x":980,"y":440,"wires":[["68f9856d.e51c0c"]]},{"id":"6f96dc5f.de7424","type":"function","z":"8b01cf3e.f743f","name":"Installed At","func":"device = flow.get('device');\n\ndate = msg.payload.content[device].installedAt;\nmsg.payload = date;\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":660,"wires":[["e1e9e73b.db81c8","4218db4e.e966b4"]]},{"id":"b69cf5e8.de4b38","type":"function","z":"8b01cf3e.f743f","name":"","func":"device = flow.get('device');\n\nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n\nmsg.url = msg.payload.content[device]._links.self.href;\nreturn msg;\n","outputs":1,"noerr":0,"x":930,"y":780,"wires":[["ddeb01e.337bd"]]},{"id":"913a67a4.93f578","type":"function","z":"8b01cf3e.f743f","name":"","func":"msg.url = msg.payload.modules[0]._links.self.href;\n\nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":890,"y":1460,"wires":[["d46be0d8.5779"]]},{"id":"d46be0d8.5779","type":"http request","z":"8b01cf3e.f743f","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1050,"y":1460,"wires":[["690e57d2.697c28"]]},{"id":"690e57d2.697c28","type":"function","z":"8b01cf3e.f743f","name":"","func":"msg.url = msg.payload._links.artifacts.href\n\nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1210,"y":1460,"wires":[["974c9a50.515ab8"]]},{"id":"974c9a50.515ab8","type":"http request","z":"8b01cf3e.f743f","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1370,"y":1460,"wires":[["7f8ec3aa.31facc"]]},{"id":"1e392e0f.0c35e2","type":"ui_text","z":"8b01cf3e.f743f","group":"6e71c2c1.9254ac","order":3,"width":0,"height":0,"name":"","label":"Artifact Name","format":"{{msg.payload}}","layout":"col-center","x":2100,"y":1460,"wires":[]},{"id":"123fd310.1a11cd","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1860,"y":1000,"wires":[["3c3e0eaf.42fc02"]]},{"id":"3c3e0eaf.42fc02","type":"ui_text","z":"8b01cf3e.f743f","group":"a08310c5.70be7","order":7,"width":0,"height":0,"name":"","label":"Created At","format":"{{value}}","layout":"col-center","x":2090,"y":1000,"wires":[]},{"id":"31a77a1e.cc34f6","type":"debug","z":"2cc1377f.832f08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":870,"y":120,"wires":[]},{"id":"195bed22.fd9e03","type":"http request","z":"2cc1377f.832f08","name":"POST Thing","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":240,"wires":[["c352e479.953638"]]},{"id":"e6a5320c.79a2e","type":"function","z":"2cc1377f.832f08","name":"Bearer","func":"msg.url = 'https://access.bosch-iot-suite.com/token'\n\nmsg.headers = {\n    \"Content-Type\": \"application/x-www-form-urlencoded\"\n}\n\nmsg.payload = {\n    \"grant_type\" : \"client_credentials\",\n    \"client_id\" : \"e4e96af4-e856-470b-b71d-a393ac20daff\",\n    \"client_secret\" : \"XOkr4fx~oe0c\",\n    \"scope\" : \"service:iot-hub-prod:t5f7ed5ae8357493c914ff61b8287a3e9_hub/full-access service:iot-things-eu-1:5f7ed5ae-8357-493c-914f-f61b8287a3e9_things/full-access\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":240,"wires":[["195bed22.fd9e03"]]},{"id":"c352e479.953638","type":"change","z":"2cc1377f.832f08","name":"","rules":[{"t":"set","p":"bearer","pt":"flow","to":"payload.access_token","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":240,"wires":[["241bd0b0.10185"]]},{"id":"b0d3172a.98d408","type":"inject","z":"2cc1377f.832f08","name":"Token","topic":"","payload":"","payloadType":"date","repeat":"3480","crontab":"","once":true,"onceDelay":0.1,"x":100,"y":240,"wires":[["e6a5320c.79a2e"]]},{"id":"241bd0b0.10185","type":"debug","z":"2cc1377f.832f08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":910,"y":240,"wires":[]},{"id":"ca2e66e4.b3db18","type":"inject","z":"2cc1377f.832f08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":320,"wires":[["e9ba9424.f276b8"]]},{"id":"bef55149.acde1","type":"http request","z":"2cc1377f.832f08","name":"GET","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":470,"y":320,"wires":[["59167ade.431944"]]},{"id":"b09c9272.83905","type":"debug","z":"2cc1377f.832f08","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":870,"y":320,"wires":[]},{"id":"a1cc5a64.9e1838","type":"function","z":"8b01cf3e.f743f","name":"Array Devices","func":"array = []\n\nfor (i=0; i<msg.payload.total; i++){\n    array[i] = msg.payload.content[i].name\n}\nmsg.payload = array\n\nreturn msg;","outputs":1,"noerr":0,"x":360,"y":180,"wires":[["b53faba9.840ab8","df4395d4.0a2598"]]},{"id":"b53faba9.840ab8","type":"change","z":"8b01cf3e.f743f","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":580,"y":200,"wires":[["e9b43ffa.a5d48"]]},{"id":"e9b43ffa.a5d48","type":"ui_dropdown","z":"8b01cf3e.f743f","name":"","label":"","tooltip":"","place":"Select option","group":"130466a6.7052a9","order":1,"width":0,"height":0,"passthru":true,"options":[],"payload":"","topic":"","x":740,"y":200,"wires":[["a99badbe.5ce1a"]]},{"id":"9f2c9787.af2eb8","type":"change","z":"8b01cf3e.f743f","name":"","rules":[{"t":"set","p":"number_devices","pt":"flow","to":"payload.total","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":570,"y":100,"wires":[[]]},{"id":"a99badbe.5ce1a","type":"function","z":"8b01cf3e.f743f","name":"Position Array","func":"devices_names = flow.get('devices_names');\nnome_dispositivo = msg.payload;\nnumber_devices = flow.get('number_devices');\n\nfor(i=0; i<number_devices; i++){\n    if(nome_dispositivo == devices_names[i]){\n        var variavel = i\n    }\n}\n\nmsg.payload = variavel;\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":200,"wires":[["6ebdf631.5d2c08"]]},{"id":"df4395d4.0a2598","type":"change","z":"8b01cf3e.f743f","name":"","rules":[{"t":"set","p":"devices_names","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":160,"wires":[[]]},{"id":"6ebdf631.5d2c08","type":"change","z":"8b01cf3e.f743f","name":"","rules":[{"t":"set","p":"device","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":220,"y":320,"wires":[["1fc32254.40949e"]]},{"id":"48a96bc6.f9c7f4","type":"http request","z":"8b01cf3e.f743f","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"https://api.eu1.bosch-iot-rollouts.com/rest/v1/targets","tls":"","persist":false,"proxy":"","authType":"basic","x":670,"y":440,"wires":[["ae7422e7.62906","77a64370.69eeac","d56bec64.670d8","139a5b6b.8cc535","27d2aae1.d37fb6","9c08aad9.7cf5e8","6f96dc5f.de7424","b69cf5e8.de4b38","7952a0da.44952","101d9c45.5a5604"]]},{"id":"93a2d9ff.9c1a38","type":"function","z":"2cc1377f.832f08","name":"","func":"msg.url = 'https://device.eu1.bosch-iot-rollouts.com/D60F7F26-9AFC-4FFB-8FA5-00A6FC6D774A/controller/v1/esp8266'; \n\nmsg.headers = {\n    'Accept': 'application/hal+json',\n    'Authorization': 'TargetToken cddeb4c8f3281757a3d5f67e8fe65b36'\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":480,"wires":[["8d16558.13420a8"]]},{"id":"8d16558.13420a8","type":"http request","z":"2cc1377f.832f08","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":430,"y":480,"wires":[["d065f2ff.5235e"]]},{"id":"a7258d98.273cd","type":"inject","z":"2cc1377f.832f08","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":100,"y":480,"wires":[["93a2d9ff.9c1a38"]]},{"id":"d065f2ff.5235e","type":"debug","z":"2cc1377f.832f08","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":610,"y":480,"wires":[]},{"id":"9798d0b6.54f7f","type":"comment","z":"2cc1377f.832f08","name":"Registar device Rollouts","info":"","x":130,"y":420,"wires":[]},{"id":"e9ba9424.f276b8","type":"function","z":"2cc1377f.832f08","name":"Count Things","func":"msg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/search/things/count'\n\nmsg.headers = {\n    \"Authorization\": \"Bearer \"+ flow.get('bearer'),\n    \"accept\": \"application/json\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":320,"wires":[["bef55149.acde1"]]},{"id":"59167ade.431944","type":"change","z":"2cc1377f.832f08","name":"","rules":[{"t":"set","p":"number_things","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":320,"wires":[["b09c9272.83905"]]},{"id":"adc99f7d.3e536","type":"function","z":"cbc934b7.020958","name":"Search Things","func":"msg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/search/things'\n\nmsg.headers = {\n    \"Authorization\": \"Bearer \"+ flow.get('bearer'),\n    \"accept\": \"application/json\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":420,"y":380,"wires":[["b556093b.e3ca18"]]},{"id":"b556093b.e3ca18","type":"http request","z":"cbc934b7.020958","name":"GET","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":590,"y":380,"wires":[["c263afe5.0af5e"]]},{"id":"c263afe5.0af5e","type":"function","z":"cbc934b7.020958","name":"Array Things","func":"array = []\nnumber_things = flow.get('number_things')\n\n/*\nfor (i=0; i<number_things; i++){\n    array[i] = msg.payload.items[i].thingId\n}\n*/\n\nfor (i=0; i<number_things; i++){\n    myVar = msg.payload.items[i].thingId;\n    myVar = myVar.substr(18);\n    array[i] = myVar;\n}\n\nmsg.payload = array\n\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":380,"wires":[["fe4bc912.fe5cf8"]]},{"id":"fe4bc912.fe5cf8","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":940,"y":380,"wires":[["26274e34.f84682","6e10408.de31ac"]]},{"id":"26274e34.f84682","type":"ui_dropdown","z":"cbc934b7.020958","name":"","label":"","tooltip":"","place":"Select option","group":"6fbf3357.68649c","order":4,"width":0,"height":0,"passthru":true,"options":[],"payload":"","topic":"","x":200,"y":520,"wires":[["efa3f28d.6d964","321e6ce.afb8f94"]]},{"id":"efa3f28d.6d964","type":"function","z":"cbc934b7.020958","name":"Position Array","func":"things_names = flow.get('things_names');\nthing_selected = msg.payload;\nnumber_things = flow.get('number_things');\n\nfor(i=0; i<number_things; i++){\n    if(thing_selected == things_names[i]){\n        var variavel = i\n    }\n}\n\nmsg.payload = variavel;\nreturn msg;","outputs":1,"noerr":0,"x":480,"y":520,"wires":[["8d6c4004.03589"]]},{"id":"6e10408.de31ac","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"things_names","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1180,"y":380,"wires":[[]]},{"id":"8d6c4004.03589","type":"function","z":"cbc934b7.020958","name":"Filter","func":"variavel = msg.payload;\n\nif(typeof variavel == 'number'){\n\tmsg.payload = true;\n}\nelse{\n\tmsg.payload = false;\n}\n \nreturn msg;","outputs":1,"noerr":0,"x":650,"y":520,"wires":[["d7c2dab8.c7f3d8"]]},{"id":"d7c2dab8.c7f3d8","type":"switch","z":"cbc934b7.020958","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":770,"y":520,"wires":[["3bfa28c4.6de788","945d23e7.ca639"],[]]},{"id":"321e6ce.afb8f94","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"thing_selected","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":140,"y":580,"wires":[[]]},{"id":"ec4e6ee7.e5289","type":"ui_button","z":"cbc934b7.020958","name":"","group":"6fbf3357.68649c","order":6,"width":4,"height":1,"passthru":false,"label":"Update List","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":90,"y":340,"wires":[["adc99f7d.3e536","80e55b8a.1f45b8"]]},{"id":"f0264a6c.e9c858","type":"http request","z":"cbc934b7.020958","name":"GET","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":590,"y":320,"wires":[["bf1c7d18.1518b"]]},{"id":"80e55b8a.1f45b8","type":"function","z":"cbc934b7.020958","name":"Count Things","func":"msg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/search/things/count'\n\nmsg.headers = {\n    \"Authorization\": \"Bearer \"+ flow.get('bearer'),\n    \"accept\": \"application/json\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":320,"wires":[["f0264a6c.e9c858"]]},{"id":"bf1c7d18.1518b","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"number_things","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":790,"y":320,"wires":[[]]},{"id":"8f564e67.64582","type":"http request","z":"cbc934b7.020958","name":"POST Thing","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":470,"y":100,"wires":[["6846d9af.bf3048"]]},{"id":"308373ba.5815cc","type":"function","z":"cbc934b7.020958","name":"Bearer","func":"msg.url = 'https://access.bosch-iot-suite.com/token'\n\nmsg.headers = {\n    \"Content-Type\": \"application/x-www-form-urlencoded\"\n}\n\nmsg.payload = {\n    \"grant_type\" : \"client_credentials\",\n    \"client_id\" : \"e4e96af4-e856-470b-b71d-a393ac20daff\",\n    \"client_secret\" : \"XOkr4fx~oe0c\",\n    \"scope\" : \"service:iot-hub-prod:t5f7ed5ae8357493c914ff61b8287a3e9_hub/full-access service:iot-things-eu-1:5f7ed5ae-8357-493c-914f-f61b8287a3e9_things/full-access\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":270,"y":100,"wires":[["8f564e67.64582"]]},{"id":"6846d9af.bf3048","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"bearer","pt":"flow","to":"payload.access_token","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":680,"y":100,"wires":[[]]},{"id":"a15e31f3.9611","type":"inject","z":"cbc934b7.020958","name":"Token","topic":"","payload":"","payloadType":"date","repeat":"3480","crontab":"","once":true,"onceDelay":0.1,"x":100,"y":100,"wires":[["308373ba.5815cc"]]},{"id":"c709483c.465c48","type":"ui_text","z":"cbc934b7.020958","group":"6fbf3357.68649c","order":2,"width":5,"height":1,"name":"","label":"Status","format":"{{msg.payload}}","layout":"col-center","x":1350,"y":700,"wires":[]},{"id":"85502d6.09decd","type":"moment","z":"cbc934b7.020958","d":true,"name":"","topic":"","input":"","inputType":"date","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD-MM-YYYY HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":2100,"y":1160,"wires":[["8dfd08ea.ce8b28"]]},{"id":"8dfd08ea.ce8b28","type":"ui_text","z":"cbc934b7.020958","d":true,"group":"b42c2368.52832","order":1,"width":0,"height":0,"name":"","label":"Resend Date","format":"{{msg.payload}}","layout":"col-center","x":2410,"y":1160,"wires":[]},{"id":"cabd571c.8865b8","type":"ui_led","z":"cbc934b7.020958","group":"6fbf3357.68649c","order":3,"width":1,"height":1,"label":"","labelPlacement":"left","labelAlignment":"left","colorForValue":[{"color":"green","value":"ON","valueType":"str"},{"color":"red","value":"OFF","valueType":"str"}],"allowColorForValueInMessage":false,"name":"","x":1350,"y":740,"wires":[]},{"id":"b2f47b68.f80dd8","type":"ui_template","z":"cbc934b7.020958","group":"89ca011.a83d7","name":"Clock Toolbar","order":1,"width":0,"height":0,"format":"<script id=\"titleScript\" type=\"text/javascript\">\n\n$(function() {\n    if($('.md-toolbar-tools').length != 0){\n        loadClock();\n    }else setTimeout(loadClock, 500)\n});\n\nfunction loadClock(){\n    $('#clock').remove();\n    var toolbar = $('.md-toolbar-tools');\n    \n    var div = $('<div/>');\n    var p = $('<p/ id=\"clock\">');\n    \n    div.append(p);\n    div[0].style.margin = '5px 5px 5px auto';\n    toolbar.append(div);\n\n    function displayTitle(lh) {\n        p.text(lh); \n    }\n    \n    function upTime() {\n        var d = new Date();\n        p.text(d.toLocaleString());\n    }\n\n    if(document.clockInterval){ \n            clearInterval(document.clockInterval);\n            document.clockInterval = null;\n    }\n        \n    document.clockInterval = setInterval(upTime,1000);\n}\n\n</script>","storeOutMessages":false,"fwdInMessages":false,"templateScope":"local","x":980,"y":40,"wires":[[]]},{"id":"6058cfb7.7eaf2","type":"function","z":"cbc934b7.020958","name":"Receive","func":"things_names = flow.get('things_names')\n\nmsg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.Tese.Devices:' + things_names[0];\n//msg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.Tese.Devices:ESP8266_as_Gateway';\n\nmsg.headers = {\n    Authorization: \"Bearer \"+ flow.get('bearer')\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":960,"wires":[["25368670.994f0a"]]},{"id":"25368670.994f0a","type":"http request","z":"cbc934b7.020958","name":"GET Thing","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":830,"y":960,"wires":[["77f7fac8.2e43c4"]]},{"id":"e75a210c.d1dc3","type":"function","z":"cbc934b7.020958","name":"Insert","func":"device_id = msg.payload.thingId;\ndevice_id = device_id.substr(18);\n\ntemp = msg.payload.features.temperature.properties.status.value.currentMeasured;\n\nhumid= msg.payload.features.humidity.properties.status.value.currentMeasured;\n\nlumin = msg.payload.features.illuminance.properties.status.value.currentMeasured\n\nmsg.payload = \"INSERT INTO [dbo].[monitoring] (Device_ID, Temperature, Humidity, Luminosity) VALUES (\\'\"+ device_id + \"\\',\" + temp + \",\" + humid + \",\" + lumin +\");\";\nreturn msg;","outputs":1,"noerr":0,"x":1010,"y":1160,"wires":[["8a950caf.cf0a8"]]},{"id":"8add2bc7.217a48","type":"MSSQL","z":"cbc934b7.020958","mssqlCN":"db0f3897.9ac6e8","name":"","query":"","outField":"payload","x":1435,"y":1060,"wires":[["b2331408.bd7d18"]],"l":false},{"id":"66e4f40b.59b57c","type":"inject","z":"cbc934b7.020958","name":"","topic":"","payload":"","payloadType":"date","repeat":"300","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":1060,"wires":[["6b662c6.59693d4"]]},{"id":"2b052d4a.4575e2","type":"function","z":"cbc934b7.020958","name":"Receive","func":"things_names = flow.get('things_names')\n\nmsg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.Tese.Devices:' + things_names[1];\n//msg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.Tese.Devices:Raspberry_as_Gateway';\n\nmsg.headers = {\n    Authorization: \"Bearer \"+ flow.get('bearer')\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":660,"y":1160,"wires":[["2c0cc4c4.ae6a2c"]]},{"id":"2c0cc4c4.ae6a2c","type":"http request","z":"cbc934b7.020958","name":"GET Thing","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":830,"y":1160,"wires":[["e75a210c.d1dc3"]]},{"id":"eb3ffa11.041ce8","type":"link in","z":"cbc934b7.020958","name":"Verify Status","links":["2490cbd2.7cd824","78d9461.afdb2b8","8da5aeda.f15be"],"x":395,"y":1040,"wires":[["b4e989bf.c3ab18"]]},{"id":"b4e989bf.c3ab18","type":"function","z":"cbc934b7.020958","name":"Resend","func":"things_names = flow.get('things_names')\n\nmsg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.Tese.Devices:ESP8266_as_Gateway/inbox/messages/test?timeout=10'\n//msg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.Tese.Devices:' + things_names[0] + '/inbox/messages/test?timeout=10'\n\nmsg.headers = {\n    \"Authorization\": \"Bearer \"+ flow.get('bearer'),\n    \"Content-Type\": \"application/json\"\n}\n\nmsg.content = {}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1040,"wires":[["d246d31b.4ed81"]]},{"id":"d246d31b.4ed81","type":"http request","z":"cbc934b7.020958","name":"POST Thing","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":1040,"wires":[["c83d075d.5ca028"]]},{"id":"c83d075d.5ca028","type":"switch","z":"cbc934b7.020958","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":830,"y":1040,"wires":[["3e30a34.2dc3e5c"],["e3795451.6b0048"]]},{"id":"3e30a34.2dc3e5c","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"ESP8266_as_Gateway_status","pt":"flow","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":1020,"wires":[["33c35e67.e03fa2"]]},{"id":"e3795451.6b0048","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"ESP8266_as_Gateway_status","pt":"flow","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1050,"y":1060,"wires":[["33c35e67.e03fa2"]]},{"id":"8da5aeda.f15be","type":"link out","z":"cbc934b7.020958","name":"Verify Status ","links":["adc0529e.63ca7","eb3ffa11.041ce8","70a448b8.6d2048"],"x":275,"y":1140,"wires":[]},{"id":"70a448b8.6d2048","type":"link in","z":"cbc934b7.020958","name":"Verify Status","links":["2490cbd2.7cd824","78d9461.afdb2b8","8da5aeda.f15be"],"x":395,"y":1240,"wires":[["895e3b3e.32e9f8"]]},{"id":"15812c9d.a66753","type":"http request","z":"cbc934b7.020958","name":"POST Thing","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":670,"y":1240,"wires":[["f07ff39d.1c7bf"]]},{"id":"f07ff39d.1c7bf","type":"switch","z":"cbc934b7.020958","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":830,"y":1240,"wires":[["b972aab9.5e9c48"],["fcf7f16b.f821d"]]},{"id":"b972aab9.5e9c48","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"Raspberry_as_Gateway_status","pt":"flow","to":"ON","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":1220,"wires":[["5cad346b.a9f83c"]]},{"id":"fcf7f16b.f821d","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"Raspberry_as_Gateway_status","pt":"flow","to":"OFF","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":1260,"wires":[["5cad346b.a9f83c"]]},{"id":"895e3b3e.32e9f8","type":"function","z":"cbc934b7.020958","name":"Resend","func":"things_names = flow.get('things_names')\n\nmsg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.Tese.Devices:' + things_names[1] + '/inbox/messages/test?timeout=10';\n//msg.url = 'https://things.eu-1.bosch-iot-suite.com/api/2/things/joao.Tese.Devices:Raspberry_as_Gateway/inbox/messages/test?timeout=10'\n\nmsg.headers = {\n    \"Authorization\": \"Bearer \"+ flow.get('bearer'),\n    \"Content-Type\": \"application/json\"\n}\n\nmsg.content = {}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":1240,"wires":[["15812c9d.a66753"]]},{"id":"e294df3f.f014","type":"switch","z":"cbc934b7.020958","name":"","property":"ESP8266_as_Gateway_status","propertyType":"flow","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":510,"y":960,"wires":[["6058cfb7.7eaf2"],[]]},{"id":"aaa5a546.6cfa18","type":"delay","z":"cbc934b7.020958","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":395,"y":1160,"wires":[["8ae92386.26127"]],"l":false},{"id":"8ae92386.26127","type":"switch","z":"cbc934b7.020958","name":"","property":"Raspberry_as_Gateway_status","propertyType":"flow","rules":[{"t":"eq","v":"ON","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":510,"y":1160,"wires":[["2b052d4a.4575e2"],[]]},{"id":"95548622.644948","type":"function","z":"cbc934b7.020958","name":"Device Status","func":"thing_name = flow.get('old_thing_selected');\nmyVar = thing_name + '_status';\nstatus = flow.get(myVar);\nmsg.payload = status\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":720,"wires":[["c709483c.465c48","cabd571c.8865b8"]]},{"id":"f2f5e0c0.fbe4","type":"function","z":"cbc934b7.020958","name":"Select Table","func":"thing_selected = flow.get('old_thing_selected')\n\nmsg.payload = \"SELECT TOP 10 * FROM [dbo].[monitoring] WHERE Device_ID = \\'\" + thing_selected +\"\\' ORDER BY ID DESC;\";\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":520,"wires":[["5178f552.0bf68c"]]},{"id":"f99f21ac.970c","type":"MSSQL","z":"cbc934b7.020958","mssqlCN":"db0f3897.9ac6e8","name":"","query":"","outField":"payload","x":1375,"y":520,"wires":[["97ee0fa7.782da","b1f7fb16.a46ff8","eb071348.da313"]],"l":false},{"id":"2e2f5fb.5e924a","type":"switch","z":"8b01cf3e.f743f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"empty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1130,"y":1040,"wires":[["257c3bb0.fea2b4"],["913a67a4.93f578","c903b2f1.a65f4","9bc8e2d0.36a5e","28024495.f3c24c","c2424525.8cc2a8"]]},{"id":"2b59f139.42818e","type":"ui_button","z":"8b01cf3e.f743f","name":"","group":"130466a6.7052a9","order":3,"width":3,"height":1,"passthru":false,"label":"Update List","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":130,"y":100,"wires":[["7bf7e516.5276dc"]]},{"id":"7f8ec3aa.31facc","type":"function","z":"8b01cf3e.f743f","name":"","func":"artifact_name = msg.payload[0].providedFilename;\n\nmsg.payload = artifact_name;\n\nreturn msg;","outputs":1,"noerr":0,"x":1530,"y":1460,"wires":[["1e392e0f.0c35e2"]]},{"id":"cd5fedd4.2a1c9","type":"link out","z":"8b01cf3e.f743f","name":"Artifact_Name","links":["3effbe03.df0ff2","b4c15127.6fe5a","234a244b.2c3c1c","8c12d573.6353c8","283b7a6a.1e3a36"],"x":1515,"y":960,"wires":[]},{"id":"257c3bb0.fea2b4","type":"function","z":"8b01cf3e.f743f","name":"Empty","func":"msg.payload = \" \";\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":960,"wires":[["cd5fedd4.2a1c9"]]},{"id":"c903b2f1.a65f4","type":"function","z":"8b01cf3e.f743f","name":"Date","func":"date = msg.payload.modules[0].lastModifiedAt;\n\nmsg.payload = date;\n\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":1020,"wires":[["59895ca5.8d5884"]]},{"id":"b4c15127.6fe5a","type":"link in","z":"8b01cf3e.f743f","name":"Artifact_Name","links":["cd5fedd4.2a1c9"],"x":1995,"y":1600,"wires":[["dcfed986.249828"]]},{"id":"9bc8e2d0.36a5e","type":"function","z":"8b01cf3e.f743f","name":"Date","func":"date = msg.payload.createdAt;\nmsg.payload = date;\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":1140,"wires":[["123fd310.1a11cd"]]},{"id":"234a244b.2c3c1c","type":"link in","z":"8b01cf3e.f743f","name":"Artifact_Name","links":["cd5fedd4.2a1c9"],"x":1995,"y":980,"wires":[["3c3e0eaf.42fc02"]]},{"id":"1fc32254.40949e","type":"function","z":"8b01cf3e.f743f","name":"Filter","func":"variavel = msg.payload;\n\nif(typeof variavel == 'number'){\n\tmsg.payload = true;\n}\nelse{\n\tmsg.payload = false;\n}\n \nreturn msg;","outputs":1,"noerr":0,"x":390,"y":320,"wires":[["274adff2.9474d"]]},{"id":"274adff2.9474d","type":"switch","z":"8b01cf3e.f743f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":320,"wires":[["48a96bc6.f9c7f4"],[]]},{"id":"fbc27a0e.6a82b8","type":"comment","z":"cbc934b7.020958","name":"CADA VEZ QUE SE CRIA UM NOVO DEVICE, TEM DE SE ACRESCENTAR AO FLUXO","info":"","x":330,"y":760,"wires":[]},{"id":"a2391ebf.38f6c","type":"comment","z":"cbc934b7.020958","name":"AS TABELAS DA BD TAMBÉM SÃO CRIADAS MANUALMENTE, DE ACORDO COM O NOME DO DEVICE","info":"","x":390,"y":800,"wires":[]},{"id":"98d4f32a.e9483","type":"comment","z":"cbc934b7.020958","name":"COM ESTE FLOWS PODEMOS ESCOLHER O DEVICE E VER OS DADOS QUE ESTÃO A SER RECOLHIDOS","info":"","x":400,"y":240,"wires":[]},{"id":"eae5ad33.0b16","type":"function","z":"cbc934b7.020958","name":"Old Thing Selected","func":"msg.payload = flow.get('old_thing_selected');\nreturn msg;","outputs":1,"noerr":0,"x":490,"y":640,"wires":[["945d23e7.ca639"]]},{"id":"2a234bfe.0adcf4","type":"comment","z":"cbc934b7.020958","name":"NESTES FLOWS, TODOS OS DADOS SÃO INSERIDOS MANUALMENTE ","info":"","x":280,"y":840,"wires":[]},{"id":"2acf02f7.543e9e","type":"comment","z":"cbc934b7.020958","name":"ASSIM, SE NENHUM DEVICE ESTIVER SELECIONADO, CONTINUA A ARMAZENAR DADOS","info":"","x":350,"y":880,"wires":[]},{"id":"491e2de1.ca8874","type":"function","z":"cbc934b7.020958","name":"Temp Hist","func":"/*\ntemp=[];\ndate=[];\narray=[];\n*/\n\ntemp=[];\ndate=[];\narray=[];\ntamanho = msg.payload.length;\n\nfor(i=0; i<tamanho; i++){\n    \n    temp[i] = msg.payload[i].Temperature;\n    date[i] = msg.payload[i].DateTime;\n    \n    array[i] = {\"x\":date[i], \"y\":temp[i]};\n    \n}\n\nmsg.payload = [{\"series\":[\"Temperature\"], \"labels\":[\"Temperature\"], \"data\":[array]}];\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":660,"wires":[["6669ba8e.a19cb4"]]},{"id":"cc1bd214.4973e","type":"ui_text","z":"cbc934b7.020958","group":"6fbf3357.68649c","order":1,"width":0,"height":0,"name":"","label":"Device selected","format":"{{msg.payload}}","layout":"col-center","x":1340,"y":640,"wires":[]},{"id":"36753083.f3ce9","type":"function","z":"cbc934b7.020958","name":"Device Selected","func":"thing_name = flow.get('old_thing_selected');\nmsg.payload = thing_name;\nreturn msg;","outputs":1,"noerr":0,"x":1120,"y":640,"wires":[["cc1bd214.4973e"]]},{"id":"2d60d42e.a3e95c","type":"function","z":"cbc934b7.020958","name":"Humid Hist","func":"humid=[];\ndate=[];\narray=[];\n\ntamanho = msg.payload.length;\n\nfor(i=0; i<tamanho; i++){\n    \n    humid[i] = msg.payload[i].Humidity;\n    date[i] = msg.payload[i].DateTime;\n    \n    array[i] = {\"x\":date[i], \"y\":humid[i]};\n    \n}\nmsg.payload = [{\"series\":[\"Humidade\"], \"labels\":[\"Humidade\"], \"data\":[array]}];\nreturn msg;","outputs":1,"noerr":0,"x":1850,"y":720,"wires":[["4481ea56.18b194"]]},{"id":"5bc0ed71.5ca494","type":"function","z":"cbc934b7.020958","name":"Lumin Hist","func":"lumin=[];\ndate=[];\narray=[];\n\ntamanho = msg.payload.length;\n\nfor(i=0; i<tamanho; i++){\n    \n    lumin[i] = msg.payload[i].Luminosity;\n    date[i] = msg.payload[i].DateTime;\n    \n    array[i] = {\"x\":date[i], \"y\":lumin[i]};\n    \n}\nmsg.payload = [{\"series\":[\"Luminosidade\"], \"labels\":[\"Luminosidade\"], \"data\":[array]}];\nreturn msg;","outputs":1,"noerr":0,"x":1850,"y":780,"wires":[["353a2fc4.88ebd"]]},{"id":"b2331408.bd7d18","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"DataBase_Insert","pt":"flow","to":"Close","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1610,"y":1060,"wires":[[]]},{"id":"eb3ab171.9095c","type":"delay","z":"cbc934b7.020958","name":"","pauseType":"delay","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":395,"y":960,"wires":[["e294df3f.f014"]],"l":false},{"id":"1b1f95a3.6af53a","type":"file in","z":"cbc934b7.020958","name":"","filename":"D:\\JSON_to_Register.json","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":320,"y":1580,"wires":[["25c434a8.14d57c"]]},{"id":"233ceeca.16bce2","type":"inject","z":"cbc934b7.020958","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":120,"y":1580,"wires":[["1b1f95a3.6af53a"]]},{"id":"25c434a8.14d57c","type":"function","z":"cbc934b7.020958","name":"Provisioning","func":"Instance_Id = \"5f7ed5ae-8357-493c-914f-f61b8287a3e9\";\n\nmsg.url = 'https://deviceprovisioning.eu-1.bosch-iot-suite.com/api/1/' + Instance_Id + '/devices';\n\nmsg.headers = {\n    \"Authorization\": \"Bearer \"+ flow.get('bearer'),\n    \"accept\": \"application/json\",\n    \"Content-Type\": \"application/json\"\n}\n\ndata = msg.payload;\n\nmsg.payload = data;\n\nreturn msg;","outputs":1,"noerr":0,"x":550,"y":1580,"wires":[["887e8bca.a15258"]]},{"id":"887e8bca.a15258","type":"http request","z":"cbc934b7.020958","name":"POST","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":710,"y":1580,"wires":[["6aab472a.74b678"]]},{"id":"63dbe584.cbbd2c","type":"function","z":"cbc934b7.020958","name":"Create Table","func":"id = msg.payload;\n\nmsg.payload = 'CREATE TABLE monitoring_' + id + '(ID int IDENTITY(1,1) NOT NULL PRIMARY KEY, Temperature varchar(50) NOT NULL, Humidity varchar(50) NOT NULL, Luminosity varchar(50) NOT NULL, DateTime datetime);';\n\nreturn msg;","outputs":1,"noerr":0,"x":1030,"y":1580,"wires":[["90e19cd4.4d149"]]},{"id":"cb15e76b.2ea0e8","type":"debug","z":"cbc934b7.020958","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1450,"y":1640,"wires":[]},{"id":"90e19cd4.4d149","type":"MSSQL","z":"cbc934b7.020958","mssqlCN":"db0f3897.9ac6e8","name":"","query":"","outField":"payload","x":1155,"y":1580,"wires":[["98f2753a.666038"]],"l":false},{"id":"98f2753a.666038","type":"function","z":"cbc934b7.020958","name":"Query Date","func":"id = flow.get('device_id');\n\nmsg.payload = 'CREATE TRIGGER trg_UpdateTimeEntry_3 ON [dbo].[monitoring_' + id + '] AFTER UPDATE, INSERT AS UPDATE [dbo].[monitoring_' + id +'] Set DateTime = GETDATE() WHERE ID IN (SELECT DISTINCT ID FROM Inserted)';\n\t\nreturn msg;","outputs":1,"noerr":0,"x":1270,"y":1580,"wires":[["2ec3d443.91caec","cb15e76b.2ea0e8"]]},{"id":"6aab472a.74b678","type":"function","z":"cbc934b7.020958","name":"device_id","func":"id = msg.payload.id;\nid = id.substr(18);\n\nmsg.payload = id;\n\nreturn msg;","outputs":1,"noerr":0,"x":860,"y":1580,"wires":[["63dbe584.cbbd2c","3a08ad5d.f73282"]]},{"id":"3a08ad5d.f73282","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"device_id","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1030,"y":1640,"wires":[[]]},{"id":"2ec3d443.91caec","type":"MSSQL","z":"cbc934b7.020958","mssqlCN":"db0f3897.9ac6e8","name":"","query":"","outField":"payload","x":1415,"y":1580,"wires":[[]],"l":false},{"id":"90b9dc53.88a8c","type":"comment","z":"cbc934b7.020958","name":"FLOW PARA RGISTAR O DEVICE E CRIAR UMA TABELA COM O SEU NOME","info":"","x":320,"y":1520,"wires":[]},{"id":"8a950caf.cf0a8","type":"delay","z":"cbc934b7.020958","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":1115,"y":1160,"wires":[["64a6b286.5bd19c"]],"l":false},{"id":"4f8affd1.bd0f3","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"DataBase_Insert","pt":"msg","to":"Open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":900,"wires":[[]]},{"id":"9e35daca.69ce28","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"DataBase_Insert","pt":"msg","to":"Open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1450,"y":1220,"wires":[[]]},{"id":"931fd736.d92f78","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"DataBase_Select","pt":"msg","to":"Open","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1350,"y":460,"wires":[[]]},{"id":"97ee0fa7.782da","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"DataBase_Select","pt":"msg","to":"Close","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1470,"y":580,"wires":[[]]},{"id":"731e782.f7d7d88","type":"function","z":"cbc934b7.020958","name":"Verification","func":"DataBase_Select = flow.get('DataBase_Select');\nquery = msg.payload;\n\nif(DataBase_Select == \"Close\"){\n    \n    msg.payload = query;\n    return msg;\n}\nelse{\n    \n    for(i=0; i<20;){\n        i++    \n    }\n    \n    msg.payload = query;\n    return msg;\n}","outputs":1,"noerr":0,"x":1250,"y":960,"wires":[["8add2bc7.217a48","4f8affd1.bd0f3"]]},{"id":"64a6b286.5bd19c","type":"function","z":"cbc934b7.020958","name":"Verification","func":"DataBase_Select = flow.get('DataBase_Select');\nquery = msg.payload;\n\nif(DataBase_Select == \"Close\"){\n    \n    msg.payload = query;\n    return msg;\n}\nelse{\n    \n    for(i=0; i<20;){\n        i++    \n    }\n    \n    msg.payload = query;\n    return msg;\n}","outputs":1,"noerr":0,"x":1250,"y":1160,"wires":[["8add2bc7.217a48","9e35daca.69ce28"]]},{"id":"5178f552.0bf68c","type":"function","z":"cbc934b7.020958","name":"Verification","func":"DataBase_Insert = flow.get('DataBase_Insert');\nquery = msg.payload;\n\nif(DataBase_Insert == \"Close\"){\n    \n    msg.payload = query;\n    return msg;\n}\nelse{\n    \n    for(i=0; i<20;){\n        i++    \n    }\n    \n    msg.payload = query;\n    return msg;\n}","outputs":1,"noerr":0,"x":1230,"y":520,"wires":[["f99f21ac.970c","931fd736.d92f78"]]},{"id":"b1f7fb16.a46ff8","type":"switch","z":"cbc934b7.020958","name":"","property":"payload","propertyType":"msg","rules":[{"t":"empty"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1510,"y":520,"wires":[["2d295b67.7be694"],["4e6c115f.6f532","7bcaa5a0.d6e32c","837ddbae.3d71c8","3430422c.c3c41e","491e2de1.ca8874","2d60d42e.a3e95c","5bc0ed71.5ca494"]]},{"id":"b6c96553.0567b8","type":"link out","z":"cbc934b7.020958","name":"NaN","links":["88e921d5.5141a","f1d7f405.3fddd8","740db2ec.7ce6dc","2e0a5558.72983a","53dbc614.643d78","3093269b.54831a","76ebfa2b.cf6a14","384404fd.41b2cc","2d61eac8.6f04a6","b31c794c.c01f58","f9cf1596.6d2138","61f2437e.9e857c","ef552aee.e10ad8","766be054.ce587","dd878603.c72708","17a7c8d5.5915a7"],"x":1615,"y":360,"wires":[]},{"id":"88e921d5.5141a","type":"link in","z":"cbc934b7.020958","name":"","links":["b6c96553.0567b8"],"x":1895,"y":260,"wires":[["2e572310.55fdbc","efe5499a.2a2af8","3b001f21.8ed2a"]]},{"id":"2e0a5558.72983a","type":"link in","z":"cbc934b7.020958","name":"","links":["b6c96553.0567b8"],"x":2415,"y":1600,"wires":[["ccdf2f02.1c6f8"]]},{"id":"76ebfa2b.cf6a14","type":"link in","z":"cbc934b7.020958","name":"","links":["b6c96553.0567b8"],"x":2655,"y":1620,"wires":[["cbf50e54.34146","281c1c5f.446134","4d3be75e.57cd68"]]},{"id":"b31c794c.c01f58","type":"link in","z":"cbc934b7.020958","name":"","links":["b6c96553.0567b8"],"x":1995,"y":480,"wires":[["5e5ff4a1.6d26ac","a50f1db6.22dc6","aabc8600.efeec8"]]},{"id":"2d295b67.7be694","type":"function","z":"cbc934b7.020958","name":"Empty","func":"msg.payload = \" \";\nreturn msg;","outputs":1,"noerr":0,"x":1530,"y":360,"wires":[["b6c96553.0567b8"]]},{"id":"ef552aee.e10ad8","type":"link in","z":"cbc934b7.020958","name":"","links":["b6c96553.0567b8"],"x":1915,"y":620,"wires":[["4481ea56.18b194","353a2fc4.88ebd","6669ba8e.a19cb4"]]},{"id":"e7ad3b6.5fe99c8","type":"inject","z":"8b01cf3e.f743f","name":"","topic":"","payload":"","payloadType":"date","repeat":"1200","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":180,"wires":[["7bf7e516.5276dc"]]},{"id":"766be054.ce587","type":"link in","z":"cbc934b7.020958","name":"","links":["b6c96553.0567b8"],"x":2415,"y":1800,"wires":[["2d2a5524.f5cfda"]]},{"id":"dd878603.c72708","type":"link in","z":"cbc934b7.020958","name":"","links":["b6c96553.0567b8"],"x":2415,"y":1700,"wires":[["6101fb65.290cd4"]]},{"id":"91d2a858.e47398","type":"comment","z":"cbc934b7.020958","name":"FLOW PARA OBTER O TOKEN","info":"","x":150,"y":40,"wires":[]},{"id":"9733550c.cb5158","type":"inject","z":"cbc934b7.020958","name":"","topic":"","payload":"","payloadType":"date","repeat":"300","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":400,"wires":[["d6d6f72f.ae10c8"]]},{"id":"d6d6f72f.ae10c8","type":"delay","z":"cbc934b7.020958","name":"","pauseType":"delay","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":235,"y":400,"wires":[["adc99f7d.3e536","80e55b8a.1f45b8"]],"l":false},{"id":"3c11c233.38009e","type":"delay","z":"cbc934b7.020958","name":"","pauseType":"delay","timeout":"35","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":355,"y":640,"wires":[["eae5ad33.0b16"]],"l":false},{"id":"6b662c6.59693d4","type":"delay","z":"cbc934b7.020958","name":"","pauseType":"delay","timeout":"10","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":235,"y":1060,"wires":[["8da5aeda.f15be","eb3ab171.9095c","aaa5a546.6cfa18"]],"l":false},{"id":"672f68f.6628298","type":"inject","z":"cbc934b7.020958","name":"","topic":"","payload":"","payloadType":"date","repeat":"300","crontab":"","once":true,"onceDelay":0.1,"x":230,"y":640,"wires":[["3c11c233.38009e"]]},{"id":"3bfa28c4.6de788","type":"change","z":"cbc934b7.020958","name":"","rules":[{"t":"set","p":"old_thing_selected","pt":"flow","to":"thing_selected","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":960,"y":460,"wires":[[]]},{"id":"945d23e7.ca639","type":"delay","z":"cbc934b7.020958","name":"","pauseType":"delay","timeout":"3","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":895,"y":520,"wires":[["f2f5e0c0.fbe4","36753083.f3ce9","95548622.644948"]],"l":false},{"id":"660665f0.48813c","type":"function","z":"cbc934b7.020958","name":"","func":"var previous_estado = context.previous_estado\n\nvar estado = flow.get('ESP8266_as_Gateway_status');\n\ncontext.previous_estado = estado;\n\n// Check if the new state is different from the previous\nif (previous_estado != estado){\n\tif (estado === \"OFF\"){\n\t    msg.payload = {}\n        msg.payload.chatId = 973258847;\n        msg.payload.type = 'message';\n\t\tmsg.payload.content = 'O dispositivo ESP8266_as_Gateway precisa de manutenção!';\n\t\treturn msg;\n\t}\n\telse if (estado === \"ON\"){\n\t    msg.payload = {}\n        msg.payload.chatId = 973258847;\n        msg.payload.type = 'message';\n\t\tmsg.payload.content = 'O dispositivo ESP8266_as_Gateway está a funcionar corretamente!';\n\t\treturn msg;\n\t}\n}","outputs":1,"noerr":0,"x":1390,"y":1360,"wires":[["e440da4b.3bbf38"]]},{"id":"33c35e67.e03fa2","type":"link out","z":"cbc934b7.020958","name":"Status ESP","links":["63b9164a.33c428"],"x":1275,"y":1040,"wires":[]},{"id":"63b9164a.33c428","type":"link in","z":"cbc934b7.020958","name":"","links":["33c35e67.e03fa2"],"x":1275,"y":1360,"wires":[["660665f0.48813c"]]},{"id":"e440da4b.3bbf38","type":"telegram sender","z":"cbc934b7.020958","name":"","bot":"bbbb4c63.27e04","x":1590,"y":1360,"wires":[[]]},{"id":"a50f1db6.22dc6","type":"ui_text","z":"cbc934b7.020958","group":"ce0bb80c.ee4f68","order":2,"width":0,"height":0,"name":"","label":"Last Read Date","format":"{{payload}}","layout":"col-center","x":2220,"y":560,"wires":[]},{"id":"aabc8600.efeec8","type":"ui_text","z":"cbc934b7.020958","group":"ce24cce4.037e2","order":2,"width":0,"height":0,"name":"","label":"Last Read Date","format":"{{payload}}","layout":"col-center","x":2220,"y":600,"wires":[]},{"id":"5cad346b.a9f83c","type":"link out","z":"cbc934b7.020958","name":"Status Rasp","links":["709ee332.c3982c"],"x":1275,"y":1240,"wires":[]},{"id":"c121ccf.85eea3","type":"function","z":"cbc934b7.020958","name":"","func":"var previous_estado = context.previous_estado\n\nvar estado = flow.get('Raspberry_as_Gateway_status');\n\ncontext.previous_estado = estado;\n\n// Check if the new state is different from the previous\nif (previous_estado != estado){\n\tif (estado === \"OFF\"){\n\t    msg.payload = {}\n        msg.payload.chatId = 973258847;\n        msg.payload.type = 'message';\n\t\tmsg.payload.content = 'O dispositivo Raspberry_as_Gateway precisa de manutenção!';\n\t\treturn msg;\n\t}\n\telse if (estado === \"ON\"){\n\t    msg.payload = {}\n        msg.payload.chatId = 973258847;\n        msg.payload.type = 'message';\n\t\tmsg.payload.content = 'O dispositivo Raspberry_as_Gateway está a funcionar corretamente!';\n\t\treturn msg;\n\t}\n}","outputs":1,"noerr":0,"x":1390,"y":1420,"wires":[["b6572f96.01853"]]},{"id":"709ee332.c3982c","type":"link in","z":"cbc934b7.020958","name":"","links":["5cad346b.a9f83c"],"x":1275,"y":1420,"wires":[["c121ccf.85eea3"]]},{"id":"b6572f96.01853","type":"telegram sender","z":"cbc934b7.020958","name":"","bot":"bbbb4c63.27e04","x":1590,"y":1420,"wires":[[]]},{"id":"86f98f2a.57b5e","type":"file in","z":"4a5fac2a.8dbb34","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":410,"y":240,"wires":[["935e52d9.fbf8d"]]},{"id":"935e52d9.fbf8d","type":"json","z":"4a5fac2a.8dbb34","name":"","property":"payload","action":"","pretty":false,"x":570,"y":240,"wires":[["3db869d8.eb0d46"]]},{"id":"3db869d8.eb0d46","type":"change","z":"4a5fac2a.8dbb34","name":"","rules":[{"t":"set","p":"payload.id","pt":"msg","to":"device_id","tot":"flow"},{"t":"set","p":"payload.hub.credentials.secrets[0].password","pt":"msg","to":"password","tot":"flow"}],"action":"","property":"","from":"","to":"","reg":false,"x":760,"y":240,"wires":[["a94cd5a7.d3d268"]]},{"id":"a94cd5a7.d3d268","type":"json","z":"4a5fac2a.8dbb34","name":"","property":"payload","action":"obj","pretty":false,"x":930,"y":240,"wires":[["152beabb.c03965"]]},{"id":"152beabb.c03965","type":"function","z":"4a5fac2a.8dbb34","name":"Provisioning","func":"Instance_Id = \"5f7ed5ae-8357-493c-914f-f61b8287a3e9\";\n\nmsg.url = 'https://deviceprovisioning.eu-1.bosch-iot-suite.com/api/1/' + Instance_Id + '/devices';\n\nmsg.headers = {\n    \"Authorization\": \"Bearer \"+ flow.get('bearer'),\n    \"accept\": \"application/json\",\n    \"Content-Type\": \"application/json\"\n}\n\ndata = msg.payload;\n\nmsg.payload = data;\n\nreturn msg;","outputs":1,"noerr":0,"x":1090,"y":240,"wires":[["210c361f.869bda"]]},{"id":"210c361f.869bda","type":"http request","z":"4a5fac2a.8dbb34","name":"POST","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":1250,"y":240,"wires":[["954fe9c0.117fe8"]]},{"id":"5c1c42be.255bbc","type":"http request","z":"4a5fac2a.8dbb34","name":"POST Thing","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":490,"y":80,"wires":[["5741a86b.998d48"]]},{"id":"3e25bcbc.2c2d54","type":"function","z":"4a5fac2a.8dbb34","name":"Bearer","func":"msg.url = 'https://access.bosch-iot-suite.com/token'\n\nmsg.headers = {\n    \"Content-Type\": \"application/x-www-form-urlencoded\"\n}\n\nmsg.payload = {\n    \"grant_type\" : \"client_credentials\",\n    \"client_id\" : \"e4e96af4-e856-470b-b71d-a393ac20daff\",\n    \"client_secret\" : \"XOkr4fx~oe0c\",\n    \"scope\" : \"service:iot-hub-prod:t5f7ed5ae8357493c914ff61b8287a3e9_hub/full-access service:iot-things-eu-1:5f7ed5ae-8357-493c-914f-f61b8287a3e9_things/full-access\"\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":290,"y":80,"wires":[["5c1c42be.255bbc"]]},{"id":"5741a86b.998d48","type":"change","z":"4a5fac2a.8dbb34","name":"","rules":[{"t":"set","p":"bearer","pt":"flow","to":"payload.access_token","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":700,"y":80,"wires":[[]]},{"id":"6678461e.d25488","type":"inject","z":"4a5fac2a.8dbb34","name":"Token","topic":"","payload":"","payloadType":"date","repeat":"3480","crontab":"","once":true,"onceDelay":0.1,"x":120,"y":80,"wires":[["3e25bcbc.2c2d54"]]},{"id":"7c2d0e8f.617f7","type":"ui_text_input","z":"4a5fac2a.8dbb34","name":"","label":"Device id","tooltip":"","group":"f6042d8f.498eb","order":3,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":700,"y":320,"wires":[["db006c5d.e7782"]]},{"id":"db006c5d.e7782","type":"change","z":"4a5fac2a.8dbb34","name":"","rules":[{"t":"set","p":"device_id","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":320,"wires":[[]]},{"id":"6c7269ab.354528","type":"ui_button","z":"4a5fac2a.8dbb34","name":"","group":"f6042d8f.498eb","order":6,"width":4,"height":1,"passthru":false,"label":"Register","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":100,"y":240,"wires":[["6f6982cb.02cf9c"]]},{"id":"6d6ddb13.62d354","type":"ui_text_input","z":"4a5fac2a.8dbb34","name":"","label":"Password","tooltip":"","group":"f6042d8f.498eb","order":4,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":700,"y":380,"wires":[["ffa4fa6e.c3c958"]]},{"id":"ffa4fa6e.c3c958","type":"change","z":"4a5fac2a.8dbb34","name":"","rules":[{"t":"set","p":"password","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":910,"y":380,"wires":[[]]},{"id":"954fe9c0.117fe8","type":"switch","z":"4a5fac2a.8dbb34","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"201","vt":"str"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1390,"y":240,"wires":[["175b9ae.e040465"],["6ab4d1aa.5821b"]]},{"id":"175b9ae.e040465","type":"function","z":"4a5fac2a.8dbb34","name":"Success","func":"msg.payload = \"The device has been successfully provisioned.\"\nreturn msg;","outputs":1,"noerr":0,"x":1540,"y":200,"wires":[["ba90998f.aa0d88"]]},{"id":"6ab4d1aa.5821b","type":"function","z":"4a5fac2a.8dbb34","name":"Error","func":"erro = msg.statusCode\nmsg.payload = \"The device could not be provisioned. Error \" + erro\nreturn msg;","outputs":1,"noerr":0,"x":1530,"y":280,"wires":[["ba90998f.aa0d88"]]},{"id":"ba90998f.aa0d88","type":"ui_text","z":"4a5fac2a.8dbb34","group":"f6042d8f.498eb","order":8,"width":6,"height":2,"name":"","label":"Result","format":"{{msg.payload}}","layout":"col-center","x":1710,"y":240,"wires":[]},{"id":"b7a7ed11.4d007","type":"ui_text","z":"4a5fac2a.8dbb34","group":"f6042d8f.498eb","order":1,"width":0,"height":0,"name":"","label":"Namespace","format":"joao.Tese.Devices","layout":"row-spread","x":1210,"y":360,"wires":[]},{"id":"eb071348.da313","type":"debug","z":"cbc934b7.020958","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":1740,"y":140,"wires":[]},{"id":"41b1c65e.0b9458","type":"ui_text","z":"8b01cf3e.f743f","group":"a08310c5.70be7","order":4,"width":0,"height":0,"name":"","label":"Last Modified By","format":"{{msg.payload.lastModifiedBy}}","layout":"col-center","x":2100,"y":760,"wires":[]},{"id":"69fe2a0.f143bd8","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1860,"y":840,"wires":[["77f718f4.0838f8"]]},{"id":"28024495.f3c24c","type":"function","z":"8b01cf3e.f743f","name":"Date","func":"date = msg.payload.lastModifiedAt\nmsg.payload = date;\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":1080,"wires":[["69fe2a0.f143bd8"]]},{"id":"77f718f4.0838f8","type":"ui_text","z":"8b01cf3e.f743f","group":"a08310c5.70be7","order":5,"width":0,"height":0,"name":"","label":"Last Modified At","format":"{{value}}","layout":"col-center","x":2100,"y":840,"wires":[]},{"id":"8c12d573.6353c8","type":"link in","z":"8b01cf3e.f743f","name":"Artifact_Name","links":["cd5fedd4.2a1c9"],"x":1995,"y":820,"wires":[["77f718f4.0838f8"]]},{"id":"c2424525.8cc2a8","type":"function","z":"8b01cf3e.f743f","name":"Date","func":"date = msg.payload.modules[0].createdAt;\nmsg.payload = date;\nreturn msg;","outputs":1,"noerr":0,"x":1431.51513671875,"y":1198.0302734375,"wires":[["36b1e7a9.6d23b8"]]},{"id":"283b7a6a.1e3a36","type":"link in","z":"8b01cf3e.f743f","name":"Artifact_Name","links":["cd5fedd4.2a1c9"],"x":1995,"y":1760,"wires":[["4a8dc35.3ff493c"]]},{"id":"36b1e7a9.6d23b8","type":"moment","z":"8b01cf3e.f743f","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1840,"y":1780,"wires":[["4a8dc35.3ff493c"]]},{"id":"4a8dc35.3ff493c","type":"ui_text","z":"8b01cf3e.f743f","group":"6e71c2c1.9254ac","order":7,"width":0,"height":0,"name":"","label":"Created At","format":"{{value}}","layout":"col-center","x":2090,"y":1780,"wires":[]},{"id":"49196a10.7c5894","type":"ui_text","z":"8b01cf3e.f743f","group":"6e71c2c1.9254ac","order":4,"width":0,"height":0,"name":"","label":"Last Modified By","format":"{{msg.payload.modules[0].lastModifiedBy}}","layout":"col-center","x":2100,"y":1540,"wires":[]},{"id":"5374a8b6.0cb858","type":"http request","z":"ee291f49.98ee5","name":"","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":890,"y":220,"wires":[["4915f2db.3c796c","9c242e92.d1716"]]},{"id":"f5bbc5ba.12ce88","type":"function","z":"ee291f49.98ee5","name":"Pre-provision","func":"device_name = flow.get('device_name') \ndevice_id = flow.get('device_id')\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/targets'\n    \nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n    \nmsg.payload = [ {\"controllerId\" : device_id,\n                \"name\" : device_name,\n                \"description\" : \"My first Device created via Management API\"\n}]\n\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":220,"wires":[["5374a8b6.0cb858"]]},{"id":"a54bf875.24f368","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"Controller ID","tooltip":"","group":"cb66b4f5.45fef8","order":1,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":170,"y":300,"wires":[["83442ca9.1e06a"]]},{"id":"eeda9a34.4bda28","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"Name","tooltip":"","group":"cb66b4f5.45fef8","order":2,"width":6,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":150,"y":360,"wires":[["c5a0ec5b.67c6b"]]},{"id":"83442ca9.1e06a","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"device_id","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":410,"y":300,"wires":[[]]},{"id":"c5a0ec5b.67c6b","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"device_name","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":360,"wires":[[]]},{"id":"2c2d1736.0955f8","type":"ui_button","z":"ee291f49.98ee5","name":"","group":"cb66b4f5.45fef8","order":4,"width":4,"height":1,"passthru":false,"label":"Provisioning","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":170,"y":220,"wires":[["c0bfe6c4.258228"]]},{"id":"549ea25e.375cbc","type":"function","z":"ee291f49.98ee5","name":"Register","func":"controller_id = msg.payload[0].controllerId;\nsecurityToken = msg.payload[0].securityToken;\n\nmsg.url = 'https://device.eu1.bosch-iot-rollouts.com/D60F7F26-9AFC-4FFB-8FA5-00A6FC6D774A/controller/v1/' + controller_id; \n\nmsg.headers = {\n    'Accept': 'application/hal+json',\n    'Authorization': 'TargetToken ' + securityToken\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":1280,"y":220,"wires":[["67239a07.f92e14"]]},{"id":"67239a07.f92e14","type":"http request","z":"ee291f49.98ee5","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"","x":1450,"y":220,"wires":[["f584abac.f0e9d8"]]},{"id":"8fa84553.122c18","type":"function","z":"ee291f49.98ee5","name":"Create SW","func":"sw_name = flow.get('sw_name')\nsw_version = flow.get('sw_version')\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/softwaremodules';\n    \nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n    \nmsg.payload = [{\n   /*\"vendor\" : \"Example Ltd.\",*/\n   \"name\" : sw_name,\n   /*\"description\" : \"First version of MyOS.\",*/\n   \"type\" : \"Application\",\n   \"version\" : sw_version\n}]\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":680,"wires":[["c8dac146.b14fb"]]},{"id":"c8dac146.b14fb","type":"http request","z":"ee291f49.98ee5","name":"","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":870,"y":680,"wires":[["70114bb2.90b724"]]},{"id":"19a156c7.3dfed9","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"SW Name","tooltip":"","group":"aebbbce8.fea28","order":2,"width":7,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":170,"y":760,"wires":[["2d7a300e.ee9b"]]},{"id":"33d57962.724e56","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"SW Version","tooltip":"","group":"aebbbce8.fea28","order":3,"width":7,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":170,"y":820,"wires":[["d652d792.24d068"]]},{"id":"2d7a300e.ee9b","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"sw_name","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":760,"wires":[[]]},{"id":"d652d792.24d068","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"sw_version","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":430,"y":820,"wires":[[]]},{"id":"4ef0f87d.bd9708","type":"ui_button","z":"ee291f49.98ee5","name":"","group":"aebbbce8.fea28","order":5,"width":3,"height":1,"passthru":false,"label":"Create SW Module","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":190,"y":680,"wires":[["1732c30a.a41dbd"]]},{"id":"63bfdc75.d40b94","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"SW_Module_Id","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1280,"wires":[[]]},{"id":"4f8aba31.2ab254","type":"function","z":"ee291f49.98ee5","name":"Format the header and payload","func":"SM_Id = flow.get('SW_Module_Id');\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/softwaremodules/' +SM_Id+ '/artifacts'; \n\nmsg.headers = {\n    \"Content-Type\": \"multipart/form-data; boundary=------------------------d74496d66958873e\"\n}\n\n\nmsg.payload = '--------------------------d74496d66958873e\\r\\n'+\n'Content-Disposition: form-data; name=\"select\"\\r\\n'+\n'\\r\\n'+\n'true\\r\\n'+\n'--------------------------d74496d66958873e\\r\\n'+\n'Content-Disposition: form-data; name=\"print\"\\r\\n'+\n'\\r\\n'+\n'true\\r\\n'+\n'--------------------------d74496d66958873e\\r\\n'+\n'Content-Disposition: form-data; name=\"file\"; filename=\"'+msg.filename+'\"\\r\\n'+\n'Content-Type: application/octet-stream\\r\\n'+\n'\\r\\n'+\nmsg.payload+'\\r\\n'+\n'--------------------------d74496d66958873e--\\r\\n';\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":1200,"wires":[[]]},{"id":"a60d9d33.6f824","type":"file in","z":"ee291f49.98ee5","name":"","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"binary","x":830,"y":1140,"wires":[["df969311.7ce14"]]},{"id":"11b0e7fb.71ffd8","type":"http request","z":"ee291f49.98ee5","name":"","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1290,"y":1140,"wires":[["4516bc32.3f4bb4"]]},{"id":"78f89cdf.2d36b4","type":"function","z":"ee291f49.98ee5","name":"File Path","func":"//msg.filename = \"D:\\\\LED_BUILTIN_Test_and_Update.bin\";\nmsg.filename = flow.get('file_path')\n\nreturn msg;","outputs":1,"noerr":0,"x":700,"y":1140,"wires":[["a60d9d33.6f824"]]},{"id":"b0c17204.e95cb","type":"function","z":"ee291f49.98ee5","name":"Create DS","func":"ds_name = flow.get('ds_name');\nds_version = flow.get('ds_version');\n//SM_ID = flow.get('sw_module_id_input');\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/distributionsets';\n\nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n\nmsg.payload = [{\n    \"requiredMigrationStep\": false,\n    \"name\": ds_name,\n    //\"description\": \"MyOS initial update\",\n    \"type\": \"app\",\n    \"version\": ds_version\n    /*\"modules\": [{\n        \"id\": SM_ID\n    }]*/\n}]\n\nreturn msg;","outputs":1,"noerr":0,"x":770,"y":1580,"wires":[["b0b0341e.649a38"]]},{"id":"f4d91c91.0a53a","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"Distribution Name","tooltip":"","group":"f36b8716.4af3b8","order":3,"width":7,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":190,"y":1660,"wires":[["80a609a2.8814f8"]]},{"id":"a57b6048.9a642","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"Distribution Version","tooltip":"","group":"f36b8716.4af3b8","order":4,"width":7,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":190,"y":1720,"wires":[["9b61c17d.de12f"]]},{"id":"80a609a2.8814f8","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"ds_name","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1660,"wires":[[]]},{"id":"9b61c17d.de12f","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"ds_version","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":1720,"wires":[[]]},{"id":"b0b0341e.649a38","type":"http request","z":"ee291f49.98ee5","name":"","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":990,"y":1580,"wires":[["fcebd0ef.e96e9"]]},{"id":"7adc752f.6f8c1c","type":"ui_button","z":"ee291f49.98ee5","name":"","group":"f36b8716.4af3b8","order":6,"width":5,"height":1,"passthru":false,"label":"Create Distribution","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":190,"y":1580,"wires":[["4ed88b02.9f4ca4"]]},{"id":"92d0dd1f.554ac","type":"function","z":"ee291f49.98ee5","name":"Assign SM","func":"DS_ID = flow.get('Distribution_ID')\nSM_ID = flow.get('sw_module_id_input')\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/distributionsets/' +DS_ID+ '/assignedSM'\n\nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n\nmsg.payload = [{\n    \"id\": SM_ID\n}]\n\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":2040,"wires":[["52d09b6b.2cb784"]]},{"id":"52d09b6b.2cb784","type":"http request","z":"ee291f49.98ee5","name":"","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":870,"y":2040,"wires":[["164480e5.b6d53f"]]},{"id":"e1e9e73b.db81c8","type":"function","z":"8b01cf3e.f743f","name":"Filter","func":"variavel = msg.payload;\n\nif(typeof variavel == 'number'){\n\tmsg.payload = true;\n}\nelse{\n\tmsg.payload = false;\n}\n \nreturn msg;","outputs":1,"noerr":0,"x":1130,"y":660,"wires":[["ceb59d83.9cb1f"]]},{"id":"ceb59d83.9cb1f","type":"switch","z":"8b01cf3e.f743f","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1270,"y":660,"wires":[["90cc2646.4800b8"],["a3bc6096.db6d5"]]},{"id":"a3bc6096.db6d5","type":"function","z":"8b01cf3e.f743f","name":"Empty","func":"msg.payload = \" \";\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":680,"wires":[["5c9f6742.d04498"]]},{"id":"3effbe03.df0ff2","type":"link in","z":"8b01cf3e.f743f","name":"Artifact_Name","links":["cd5fedd4.2a1c9"],"x":1995,"y":1440,"wires":[["1e392e0f.0c35e2"]]},{"id":"49fb984f.396a18","type":"comment","z":"8b01cf3e.f743f","name":"DEVICE","info":"","x":1360,"y":280,"wires":[]},{"id":"cb2a2019.e8252","type":"comment","z":"8b01cf3e.f743f","name":"DISTRIBUTION","info":"","x":2100,"y":460,"wires":[]},{"id":"17e14906.3e3017","type":"comment","z":"8b01cf3e.f743f","name":"SOFTWARE MODULE","info":"","x":2120,"y":1240,"wires":[]},{"id":"f584abac.f0e9d8","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1610,"y":220,"wires":[["6b44fa18.3d9ae4","883fe226.7badc","991cac8.b409b5","d6483d80.8e86a"],["8c723275.f518"]]},{"id":"6b44fa18.3d9ae4","type":"function","z":"ee291f49.98ee5","name":"Success","func":"msg.payload = \"Success! The device is pre-provisioned and registered!\"\nreturn msg;","outputs":1,"noerr":0,"x":1840,"y":280,"wires":[["bdf0916f.8d524"]]},{"id":"8c723275.f518","type":"function","z":"ee291f49.98ee5","name":"Error","func":"status = msg.statusCode;\nmsg.payload = \"Fail! Error \" +status;\nreturn msg;","outputs":1,"noerr":0,"x":1830,"y":340,"wires":[["bdf0916f.8d524"]]},{"id":"bdf0916f.8d524","type":"ui_text","z":"ee291f49.98ee5","group":"cb66b4f5.45fef8","order":6,"width":6,"height":2,"name":"","label":"Result","format":"{{msg.payload}}","layout":"col-center","x":2070,"y":340,"wires":[]},{"id":"4915f2db.3c796c","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"201","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1070,"y":220,"wires":[["549ea25e.375cbc"],["56555546.b48b7c"]]},{"id":"56555546.b48b7c","type":"function","z":"ee291f49.98ee5","name":"Fail","func":"message = msg.payload.message;\nmsg.payload = message;\nreturn msg;","outputs":1,"noerr":0,"x":1830,"y":400,"wires":[["bdf0916f.8d524"]]},{"id":"70114bb2.90b724","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"201","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1030,"y":680,"wires":[["d4bc2e16.f010b","88067495.d4b4f8","2f3b51c7.5b4e3e","9689dce4.ecb28"],["653fdc01.aa4fd4"]]},{"id":"7101f463.d998ac","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":12,"width":7,"height":1,"name":"","label":"","format":"Upload an Artifact","layout":"row-left","x":970,"y":780,"wires":[]},{"id":"4516bc32.3f4bb4","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"201","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1470,"y":1140,"wires":[["2323aa14.1f1826","976f5c9b.a0066"],["9f04f53b.670418"]]},{"id":"2323aa14.1f1826","type":"function","z":"ee291f49.98ee5","name":"Success","func":"msg.payload = \"Success!\"\nreturn msg;","outputs":1,"noerr":0,"x":1660,"y":1200,"wires":[["79c905d1.78a99c"]]},{"id":"9f04f53b.670418","type":"function","z":"ee291f49.98ee5","name":"Fail","func":"message = msg.payload.message;\nmsg.payload = message;\nreturn msg;","outputs":1,"noerr":0,"x":1670,"y":1280,"wires":[["79c905d1.78a99c"]]},{"id":"fcebd0ef.e96e9","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"201","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1170,"y":1580,"wires":[["6a724a83.dbe6b4","b79218f9.4de2e8","c5a7980a.074098","f82a7df9.9ee12"],["5095a31d.e94f4c"]]},{"id":"cb70e0d.2017b2","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":1,"width":7,"height":1,"name":"","label":"","format":"Create a Software Module","layout":"row-left","x":970,"y":740,"wires":[]},{"id":"164480e5.b6d53f","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1030,"y":2040,"wires":[["c4a89cb8.fb608","207502de.403bde","63404b8f.d4a804"],["4c262a5a.060194"]]},{"id":"c3fc94fe.94fc48","type":"function","z":"ee291f49.98ee5","name":"Assign DS","func":"DS_ID = flow.get('Distribution_ID')\ndevice_id = flow.get('Device_ID')\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/distributionsets/' +DS_ID+ '/assignedTargets/'\n\nmsg.headers = {\n    \"Content-Type\": \"application/json;charset=UTF-8\"\n}\n\nmsg.payload = [{\n  \"id\" : device_id,\n  \"type\" : \"forced\"\n}]\n\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":2480,"wires":[["ee91fc3d.00331"]]},{"id":"4b574ee8.eaaa3","type":"ui_button","z":"ee291f49.98ee5","name":"","group":"a075749.8b83888","order":5,"width":3,"height":1,"passthru":false,"label":"Assign","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":150,"y":2480,"wires":[["754c87e8.483708"]]},{"id":"ee91fc3d.00331","type":"http request","z":"ee291f49.98ee5","name":"","method":"POST","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":910,"y":2480,"wires":[["c0e43d45.e38fe"]]},{"id":"c0e43d45.e38fe","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1090,"y":2480,"wires":[["bcebb32f.0479c"],["e87550b9.2176f"]]},{"id":"bcebb32f.0479c","type":"function","z":"ee291f49.98ee5","name":"Success","func":"msg.payload = \"Success!\"\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":2440,"wires":[["b6875fc4.7ca4e"]]},{"id":"e87550b9.2176f","type":"function","z":"ee291f49.98ee5","name":"Fail","func":"status = msg.statusCode;\nmsg.payload = \"Fail! Error \" +status;\nreturn msg;","outputs":1,"noerr":0,"x":1250,"y":2520,"wires":[["b6875fc4.7ca4e"]]},{"id":"b6875fc4.7ca4e","type":"ui_text","z":"ee291f49.98ee5","group":"a075749.8b83888","order":7,"width":5,"height":2,"name":"","label":"Result","format":"{{msg.payload}}","layout":"col-center","x":1430,"y":2480,"wires":[]},{"id":"498bf5a2.43d9bc","type":"comment","z":"ee291f49.98ee5","name":"PRE-PROVISION AND REGISTER THE DEVICE","info":"","x":280,"y":120,"wires":[]},{"id":"1e6a094d.a42617","type":"comment","z":"ee291f49.98ee5","name":"CREATE A SW MODULE","info":"","x":210,"y":580,"wires":[]},{"id":"a6f786e0.37d998","type":"comment","z":"ee291f49.98ee5","name":"CREATE A DISTRIBUTION SET","info":"","x":230,"y":1460,"wires":[]},{"id":"69adf742.7f9a98","type":"comment","z":"ee291f49.98ee5","name":"ASSIGN A DISTRIBUTION SET TO A DEVICE","info":"","x":270,"y":2380,"wires":[]},{"id":"89f664ca.045278","type":"link in","z":"ee291f49.98ee5","name":"","links":["ca8a7b2b.818958"],"x":1995,"y":400,"wires":[["bdf0916f.8d524"]]},{"id":"58db1695.6f6628","type":"link out","z":"ee291f49.98ee5","name":"Invalid_sw","links":["40694bda.1b7d84","a1d5fb95.83b218"],"x":775,"y":740,"wires":[]},{"id":"9c242e92.d1716","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"securityToken","pt":"flow","to":"payload[0].securityToken","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1060,"y":160,"wires":[[]]},{"id":"f1ec0757.f134a8","type":"ui_text","z":"ee291f49.98ee5","group":"cb66b4f5.45fef8","order":9,"width":6,"height":1,"name":"","label":"Controller Id","format":"{{msg.payload}}","layout":"col-center","x":2110,"y":160,"wires":[]},{"id":"566947f3.188758","type":"ui_text","z":"ee291f49.98ee5","group":"cb66b4f5.45fef8","order":10,"width":6,"height":2,"name":"","label":"Security Token","format":"{{msg.payload}}","layout":"col-center","x":2120,"y":220,"wires":[]},{"id":"883fe226.7badc","type":"function","z":"ee291f49.98ee5","name":"Controller Id","func":"msg.payload = flow.get('device_id')\nreturn msg;","outputs":1,"noerr":0,"x":1850,"y":160,"wires":[["f1ec0757.f134a8"]]},{"id":"991cac8.b409b5","type":"function","z":"ee291f49.98ee5","name":"Security Token","func":"msg.payload = flow.get('securityToken')\nreturn msg;","outputs":1,"noerr":0,"x":1860,"y":220,"wires":[["566947f3.188758"]]},{"id":"976f5c9b.a0066","type":"function","z":"ee291f49.98ee5","name":"FileName","func":"file_name = msg.payload.providedFilename;\nmsg.payload = file_name;\nreturn msg;","outputs":1,"noerr":0,"x":1660,"y":1100,"wires":[["4f758862.a432f8"]]},{"id":"4f758862.a432f8","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":20,"width":7,"height":1,"name":"","label":"File Name","format":"{{msg.payload}}","layout":"col-center","x":1870,"y":1100,"wires":[]},{"id":"d6483d80.8e86a","type":"function","z":"ee291f49.98ee5","name":"Name","func":"name = flow.get('device_name');\nmsg.payload = name;\nreturn msg;","outputs":1,"noerr":0,"x":1830,"y":100,"wires":[["11eaac26.b30b04"]]},{"id":"11eaac26.b30b04","type":"ui_text","z":"ee291f49.98ee5","group":"cb66b4f5.45fef8","order":8,"width":6,"height":1,"name":"","label":"Name","format":"{{msg.payload}}","layout":"col-center","x":2090,"y":100,"wires":[]},{"id":"7537fd8e.fb3884","type":"ui_text","z":"ee291f49.98ee5","group":"cb66b4f5.45fef8","order":7,"width":6,"height":1,"name":"","label":"","format":"Last Device Provisioned","layout":"row-left","x":990,"y":300,"wires":[]},{"id":"a4412aad.9c15d8","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":8,"width":0,"height":0,"name":"","label":"","format":"Last SW Module Created","layout":"row-left","x":970,"y":820,"wires":[]},{"id":"b29b1b02.7130c8","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":9,"width":7,"height":1,"name":"","label":"","format":"Last Distribution Set Created","layout":"row-left","x":1110,"y":1640,"wires":[]},{"id":"d011f6e5.8d5fc8","type":"function","z":"ee291f49.98ee5","name":"SW_Module_Version","func":"SW_Module_Version = msg.payload.version\nmsg.payload = SW_Module_Version;\nreturn msg;","outputs":1,"noerr":0,"x":1880,"y":2100,"wires":[["3ab44299.eef83e"]]},{"id":"fb1d94e1.a42ff8","type":"function","z":"ee291f49.98ee5","name":"SW_Module_Name","func":"SW_Module_Name = msg.payload.name\nmsg.payload = SW_Module_Name;\nreturn msg;","outputs":1,"noerr":0,"x":1870,"y":2040,"wires":[["6fc4c027.2c458"]]},{"id":"6fc4c027.2c458","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":21,"width":7,"height":1,"name":"","label":"SW Module Assigned (Name)","format":"{{msg.payload}}","layout":"col-center","x":2170,"y":2040,"wires":[]},{"id":"3ab44299.eef83e","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":22,"width":7,"height":1,"name":"","label":"SW Module Assigned (Version)","format":"{{msg.payload}}","layout":"col-center","x":2170,"y":2100,"wires":[]},{"id":"55c76321.93a5ec","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"SW Module ID","tooltip":"","group":"f36b8716.4af3b8","order":14,"width":7,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":180,"y":2120,"wires":[["2d807aa9.453b16"]]},{"id":"2d807aa9.453b16","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"sw_module_id_input","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":480,"y":2120,"wires":[[]]},{"id":"df969311.7ce14","type":"function","z":"ee291f49.98ee5","name":"Format the header and payload","func":"SM_Id = flow.get('SW_Module_Id');\nfilename = msg.filename;\nfilename = filename.substr(0, filename.length - 4);\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/softwaremodules/' +SM_Id+ '/artifacts'; \n\nmsg.headers = {\n    \"Content-Type\": \"multipart/form-data; boundary=6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm\"\n}\n\nmsg.payload = '--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm\\r\\n'+\n    'Content-Disposition: form-data; name=\"file\"; filename=\"'+msg.filename+'\"\\r\\n'+\n    '\\r\\n'+\n    msg.payload+'\\r\\n'+\n    '--6o2knFse3p53ty9dmcQvWAIx1zInP11uCfbm--\\r\\n';\n\nreturn msg;","outputs":1,"noerr":0,"x":1050,"y":1140,"wires":[["11b0e7fb.71ffd8"]]},{"id":"35cf8e8d.22f682","type":"ui_text_input","z":"4a5fac2a.8dbb34","name":"","label":"File Path","tooltip":"","group":"f6042d8f.498eb","order":2,"width":0,"height":0,"passthru":true,"mode":"text","delay":300,"topic":"","x":100,"y":300,"wires":[["dd1e43dd.80499"]]},{"id":"dd1e43dd.80499","type":"change","z":"4a5fac2a.8dbb34","name":"","rules":[{"t":"set","p":"file_path","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":300,"y":300,"wires":[[]]},{"id":"6f6982cb.02cf9c","type":"function","z":"4a5fac2a.8dbb34","name":"File Path","func":"//msg.filename = \"D:\\\\LED_BUILTIN_Test_and_Update.bin\";\nmsg.filename = flow.get('file_path')\n\nreturn msg;","outputs":1,"noerr":0,"x":260,"y":240,"wires":[["86f98f2a.57b5e"]]},{"id":"ba65926d.fa298","type":"ui_button","z":"d1dbdd74.e1a3","name":"","group":"2a9c7ac8.8f2c66","order":3,"width":3,"height":1,"passthru":false,"label":"Update List","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":110,"y":80,"wires":[["de9dc58c.b043b8"]]},{"id":"de9dc58c.b043b8","type":"http request","z":"d1dbdd74.e1a3","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"https://api.eu1.bosch-iot-rollouts.com/rest/v1/distributionsets","tls":"","persist":false,"proxy":"","authType":"basic","x":290,"y":80,"wires":[["717eaa1b.4776f4","471939d2.acea18","ef8424a4.7f7dd8"]]},{"id":"717eaa1b.4776f4","type":"function","z":"d1dbdd74.e1a3","name":"Array Devices","func":"array = []\n\nfor (i=0; i<msg.payload.total; i++){\n    array[i] = msg.payload.content[i].name\n}\nmsg.payload = array\n\nreturn msg;","outputs":1,"noerr":0,"x":340,"y":160,"wires":[["61c766db.d02828","4b46aefa.f7057"]]},{"id":"471939d2.acea18","type":"change","z":"d1dbdd74.e1a3","name":"","rules":[{"t":"set","p":"number_distributions","pt":"flow","to":"payload.total","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":80,"wires":[[]]},{"id":"4b46aefa.f7057","type":"change","z":"d1dbdd74.e1a3","name":"","rules":[{"t":"set","p":"distributions_names","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":140,"wires":[[]]},{"id":"61c766db.d02828","type":"change","z":"d1dbdd74.e1a3","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":560,"y":180,"wires":[["29157e08.003172"]]},{"id":"29157e08.003172","type":"ui_dropdown","z":"d1dbdd74.e1a3","name":"","label":"","tooltip":"","place":"Select option","group":"2a9c7ac8.8f2c66","order":1,"width":0,"height":0,"passthru":true,"options":[],"payload":"","topic":"","x":720,"y":180,"wires":[["46d9e81c.d0cf58"]]},{"id":"46d9e81c.d0cf58","type":"function","z":"d1dbdd74.e1a3","name":"Position Array","func":"distributions_names = flow.get('distributions_names');\nnome_distribution = msg.payload;\nnumber_distributions = flow.get('number_distributions');\n\nfor(i=0; i<number_distributions; i++){\n    if(nome_distribution == distributions_names[i]){\n        var variavel = i\n    }\n}\n\nmsg.payload = variavel;\nreturn msg;","outputs":1,"noerr":0,"x":900,"y":180,"wires":[["6da55005.663e8"]]},{"id":"6da55005.663e8","type":"change","z":"d1dbdd74.e1a3","name":"","rules":[{"t":"set","p":"distribution","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":250,"y":300,"wires":[["ef1b8d88.df24d"]]},{"id":"ef1b8d88.df24d","type":"function","z":"d1dbdd74.e1a3","name":"Filter","func":"variavel = msg.payload;\n\nif(typeof variavel == 'number'){\n\tmsg.payload = true;\n}\nelse{\n\tmsg.payload = false;\n}\n \nreturn msg;","outputs":1,"noerr":0,"x":410,"y":300,"wires":[["d24146a2.2d7348"]]},{"id":"d24146a2.2d7348","type":"switch","z":"d1dbdd74.e1a3","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":550,"y":300,"wires":[["a860ab2a.cc9c88"],[]]},{"id":"a860ab2a.cc9c88","type":"http request","z":"d1dbdd74.e1a3","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"https://api.eu1.bosch-iot-rollouts.com/rest/v1/distributionsets","tls":"","persist":false,"proxy":"","authType":"basic","x":690,"y":420,"wires":[["458dd19f.5489d","6822f2e1.9a78fc","8322f925.7056e8","de04fb25.7845d8","9c3b38f6.c6f808","ded64c55.c1228","ecab3d49.88c23","d373b5c4.949f98","82b956bd.be5528"]]},{"id":"ef8424a4.7f7dd8","type":"debug","z":"d1dbdd74.e1a3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":430,"y":40,"wires":[]},{"id":"458dd19f.5489d","type":"debug","z":"d1dbdd74.e1a3","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":750,"y":280,"wires":[]},{"id":"ba6377bc.1b3498","type":"ui_text","z":"d1dbdd74.e1a3","group":"8c3ddb65.4fc0c8","order":1,"width":0,"height":0,"name":"","label":"Name","format":"{{msg.payload}}","layout":"col-center","x":1190,"y":320,"wires":[]},{"id":"23b61e68.d0dbb2","type":"moment","z":"d1dbdd74.e1a3","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1240,"y":520,"wires":[["3a348e86.3d4dd2"]]},{"id":"5b396d86.7d5804","type":"ui_text","z":"d1dbdd74.e1a3","group":"8c3ddb65.4fc0c8","order":6,"width":0,"height":0,"name":"","label":"Created By","format":"{{msg.payload}}","layout":"col-center","x":1210,"y":480,"wires":[]},{"id":"3a348e86.3d4dd2","type":"ui_text","z":"d1dbdd74.e1a3","group":"8c3ddb65.4fc0c8","order":7,"width":0,"height":0,"name":"","label":"Created At","format":"{{msg.payload}}","layout":"col-center","x":1470,"y":520,"wires":[]},{"id":"d16214c.27b55e8","type":"moment","z":"d1dbdd74.e1a3","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1240,"y":440,"wires":[["978b9341.7c95c"]]},{"id":"978b9341.7c95c","type":"ui_text","z":"d1dbdd74.e1a3","group":"8c3ddb65.4fc0c8","order":5,"width":0,"height":0,"name":"","label":"Last Modified At","format":"{{msg.payload}}","layout":"col-center","x":1480,"y":440,"wires":[]},{"id":"8f28202b.dc967","type":"ui_text","z":"d1dbdd74.e1a3","group":"8c3ddb65.4fc0c8","order":4,"width":0,"height":0,"name":"","label":"Last Modified By","format":"{{msg.payload}}","layout":"col-center","x":1220,"y":400,"wires":[]},{"id":"6822f2e1.9a78fc","type":"function","z":"d1dbdd74.e1a3","name":"Name","func":"distribution = flow.get('distribution');\n\nname = msg.payload.content[distribution].name;\nmsg.payload = name;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":320,"wires":[["ba6377bc.1b3498"]]},{"id":"9c3b38f6.c6f808","type":"function","z":"d1dbdd74.e1a3","name":"Created By","func":"distribution = flow.get('distribution');\n\ncreate = msg.payload.content[distribution].createdBy;\nmsg.payload = create;\nreturn msg;\n","outputs":1,"noerr":0,"x":930,"y":480,"wires":[["5b396d86.7d5804"]]},{"id":"ded64c55.c1228","type":"function","z":"d1dbdd74.e1a3","name":"Created At","func":"distribution = flow.get('distribution');\n\ndate = msg.payload.content[distribution].createdAt;\nmsg.payload = date;\nreturn msg;\n","outputs":1,"noerr":0,"x":930,"y":520,"wires":[["23b61e68.d0dbb2"]]},{"id":"8322f925.7056e8","type":"function","z":"d1dbdd74.e1a3","name":"Last Modified By","func":"distribution = flow.get('distribution');\n\nmodify = msg.payload.content[distribution].lastModifiedBy;\nmsg.payload = modify;\nreturn msg;\n","outputs":1,"noerr":0,"x":940,"y":400,"wires":[["8f28202b.dc967"]]},{"id":"de04fb25.7845d8","type":"function","z":"d1dbdd74.e1a3","name":"Last Modified At","func":"distribution = flow.get('distribution');\n\ndate = msg.payload.content[distribution].lastModifiedAt;\nmsg.payload = date;\nreturn msg;\n","outputs":1,"noerr":0,"x":940,"y":440,"wires":[["d16214c.27b55e8"]]},{"id":"ecab3d49.88c23","type":"function","z":"d1dbdd74.e1a3","name":"Version","func":"distribution = flow.get('distribution');\n\nversion = msg.payload.content[distribution].version;\nmsg.payload = version;\nreturn msg;","outputs":1,"noerr":0,"x":920,"y":360,"wires":[["386cde8d.b4e202"]]},{"id":"386cde8d.b4e202","type":"ui_text","z":"d1dbdd74.e1a3","group":"8c3ddb65.4fc0c8","order":2,"width":0,"height":0,"name":"","label":"Version","format":"{{msg.payload}}","layout":"col-center","x":1200,"y":360,"wires":[]},{"id":"d373b5c4.949f98","type":"function","z":"d1dbdd74.e1a3","name":"DS_ID","func":"distribution = flow.get('distribution');\nDS_ID = msg.payload.content[distribution].id;\nmsg.payload = DS_ID;\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":560,"wires":[["3fbae047.83d23"]]},{"id":"3fbae047.83d23","type":"ui_text","z":"d1dbdd74.e1a3","group":"8c3ddb65.4fc0c8","order":3,"width":0,"height":0,"name":"","label":"DS_ID","format":"{{msg.payload}}","layout":"col-center","x":1190,"y":560,"wires":[]},{"id":"15787d15.74d943","type":"ui_button","z":"d1dbdd74.e1a3","name":"","group":"aa4c6727.1bc928","order":3,"width":4,"height":1,"passthru":false,"label":"View SW Modules","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"tab\":\"Software Modules\"}","payloadType":"json","topic":"","x":210,"y":540,"wires":[["73ae01bb.b26c3"]]},{"id":"73ae01bb.b26c3","type":"ui_ui_control","z":"d1dbdd74.e1a3","name":"","events":"all","x":450,"y":540,"wires":[[]]},{"id":"84728e7b.8cfda","type":"ui_button","z":"600a4a09.bfc9f4","name":"","group":"40051f70.40003","order":3,"width":4,"height":1,"passthru":false,"label":"Update List","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":130,"y":100,"wires":[["689b301d.98d9c"]]},{"id":"689b301d.98d9c","type":"http request","z":"600a4a09.bfc9f4","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"https://api.eu1.bosch-iot-rollouts.com/rest/v1/softwaremodules","tls":"","persist":false,"proxy":"","authType":"basic","x":310,"y":100,"wires":[["c17eae5b.6d4df","8bf42244.97dd6","c7702c7f.659ee"]]},{"id":"c17eae5b.6d4df","type":"function","z":"600a4a09.bfc9f4","name":"Array Devices","func":"array = []\n\nfor (i=0; i<msg.payload.total; i++){\n    array[i] = msg.payload.content[i].name\n}\nmsg.payload = array\n\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":180,"wires":[["7c4686f0.b3efd8","8faabd8a.b07f2"]]},{"id":"8bf42244.97dd6","type":"change","z":"600a4a09.bfc9f4","name":"","rules":[{"t":"set","p":"number_sw_modules","pt":"flow","to":"payload.total","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":590,"y":100,"wires":[[]]},{"id":"8faabd8a.b07f2","type":"change","z":"600a4a09.bfc9f4","name":"","rules":[{"t":"set","p":"sw_modules_names","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":640,"y":160,"wires":[[]]},{"id":"7c4686f0.b3efd8","type":"change","z":"600a4a09.bfc9f4","name":"","rules":[{"t":"set","p":"options","pt":"msg","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":200,"wires":[["5d58795e.0b1f18","11770b75.8cd6a5"]]},{"id":"5d58795e.0b1f18","type":"ui_dropdown","z":"600a4a09.bfc9f4","name":"","label":"","tooltip":"","place":"Select option","group":"40051f70.40003","order":1,"width":0,"height":0,"passthru":true,"options":[],"payload":"","topic":"","x":760,"y":200,"wires":[["ff238dbc.7ba18"]]},{"id":"ff238dbc.7ba18","type":"function","z":"600a4a09.bfc9f4","name":"Position Array","func":"sw_modules_names = flow.get('sw_modules_names');\nnome_sw_module = msg.payload;\nnumber_sw_modules = flow.get('number_sw_modules');\n\nfor(i=0; i<number_sw_modules; i++){\n    if(nome_sw_module == sw_modules_names[i]){\n        var variavel = i\n    }\n}\n\nmsg.payload = variavel;\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":200,"wires":[["4ab9b5d2.3966ac"]]},{"id":"4ab9b5d2.3966ac","type":"change","z":"600a4a09.bfc9f4","name":"","rules":[{"t":"set","p":"sw_module","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":320,"wires":[["a04f0a2c.0a8228"]]},{"id":"a04f0a2c.0a8228","type":"function","z":"600a4a09.bfc9f4","name":"Filter","func":"variavel = msg.payload;\n\nif(typeof variavel == 'number'){\n\tmsg.payload = true;\n}\nelse{\n\tmsg.payload = false;\n}\n \nreturn msg;","outputs":1,"noerr":0,"x":430,"y":320,"wires":[["624f7912.1117f8"]]},{"id":"624f7912.1117f8","type":"switch","z":"600a4a09.bfc9f4","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":570,"y":320,"wires":[["9aa9aeb1.b8cf7"],[]]},{"id":"9aa9aeb1.b8cf7","type":"http request","z":"600a4a09.bfc9f4","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"https://api.eu1.bosch-iot-rollouts.com/rest/v1/softwaremodules","tls":"","persist":false,"proxy":"","authType":"basic","x":710,"y":440,"wires":[["71ee9658.fc85f8","e1c977fe.6cac58","fd118bdc.d743f8","bb1b4f55.f04c1","ffa4d778.8d0248","ecdf7fe5.78c15","828e3f89.87221","2839b0d4.b80b4","72d8a1da.77c9"]]},{"id":"c7702c7f.659ee","type":"debug","z":"600a4a09.bfc9f4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":450,"y":60,"wires":[]},{"id":"71ee9658.fc85f8","type":"debug","z":"600a4a09.bfc9f4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":770,"y":300,"wires":[]},{"id":"c4d36d.b39f5c9","type":"ui_text","z":"600a4a09.bfc9f4","group":"45d7facf.87f524","order":1,"width":0,"height":0,"name":"","label":"Name","format":"{{msg.payload}}","layout":"col-center","x":1210,"y":340,"wires":[]},{"id":"844647eb.542e48","type":"moment","z":"600a4a09.bfc9f4","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1260,"y":540,"wires":[["86a7cac2.3ffbe8"]]},{"id":"6202afcd.9eefa","type":"ui_text","z":"600a4a09.bfc9f4","group":"45d7facf.87f524","order":6,"width":0,"height":0,"name":"","label":"Created By","format":"{{msg.payload}}","layout":"col-center","x":1230,"y":500,"wires":[]},{"id":"86a7cac2.3ffbe8","type":"ui_text","z":"600a4a09.bfc9f4","group":"45d7facf.87f524","order":7,"width":0,"height":0,"name":"","label":"Created At","format":"{{msg.payload}}","layout":"col-center","x":1490,"y":540,"wires":[]},{"id":"702a5929.ae7248","type":"moment","z":"600a4a09.bfc9f4","name":"","topic":"","input":"payload","inputType":"msg","inTz":"Europe/Lisbon","adjAmount":0,"adjType":"days","adjDir":"add","format":"DD/MM/YYYY   HH:mm:ss","locale":"pt_PT","output":"payload","outputType":"msg","outTz":"Europe/Lisbon","x":1260,"y":460,"wires":[["bcc59094.d42ab"]]},{"id":"bcc59094.d42ab","type":"ui_text","z":"600a4a09.bfc9f4","group":"45d7facf.87f524","order":5,"width":0,"height":0,"name":"","label":"Last Modified At","format":"{{msg.payload}}","layout":"col-center","x":1500,"y":460,"wires":[]},{"id":"a22bd2dd.e6cea","type":"ui_text","z":"600a4a09.bfc9f4","group":"45d7facf.87f524","order":4,"width":0,"height":0,"name":"","label":"Last Modified By","format":"{{msg.payload}}","layout":"col-center","x":1240,"y":420,"wires":[]},{"id":"e1c977fe.6cac58","type":"function","z":"600a4a09.bfc9f4","name":"Name","func":"sw_module = flow.get('sw_module');\n\nname = msg.payload.content[sw_module].name;\nmsg.payload = name;\nreturn msg;","outputs":1,"noerr":0,"x":930,"y":340,"wires":[["c4d36d.b39f5c9"]]},{"id":"ffa4d778.8d0248","type":"function","z":"600a4a09.bfc9f4","name":"Created By","func":"sw_module = flow.get('sw_module');\n\ncreate = msg.payload.content[sw_module].createdBy;\nmsg.payload = create;\nreturn msg;\n","outputs":1,"noerr":0,"x":950,"y":500,"wires":[["6202afcd.9eefa"]]},{"id":"ecdf7fe5.78c15","type":"function","z":"600a4a09.bfc9f4","name":"Created At","func":"sw_module = flow.get('sw_module');\n\ndate = msg.payload.content[sw_module].createdAt;\nmsg.payload = date;\nreturn msg;\n","outputs":1,"noerr":0,"x":950,"y":540,"wires":[["844647eb.542e48"]]},{"id":"fd118bdc.d743f8","type":"function","z":"600a4a09.bfc9f4","name":"Last Modified By","func":"sw_module = flow.get('sw_module');\n\nmodify = msg.payload.content[sw_module].lastModifiedBy;\nmsg.payload = modify;\nreturn msg;\n","outputs":1,"noerr":0,"x":960,"y":420,"wires":[["a22bd2dd.e6cea"]]},{"id":"bb1b4f55.f04c1","type":"function","z":"600a4a09.bfc9f4","name":"Last Modified At","func":"sw_module = flow.get('sw_module');\n\ndate = msg.payload.content[sw_module].lastModifiedAt;\nmsg.payload = date;\nreturn msg;\n","outputs":1,"noerr":0,"x":960,"y":460,"wires":[["702a5929.ae7248"]]},{"id":"828e3f89.87221","type":"function","z":"600a4a09.bfc9f4","name":"Version","func":"sw_module = flow.get('sw_module');\n\nversion = msg.payload.content[sw_module].version;\nmsg.payload = version;\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":380,"wires":[["c3478df5.e27bf"]]},{"id":"c3478df5.e27bf","type":"ui_text","z":"600a4a09.bfc9f4","group":"45d7facf.87f524","order":2,"width":0,"height":0,"name":"","label":"Version","format":"{{msg.payload}}","layout":"col-center","x":1220,"y":380,"wires":[]},{"id":"2839b0d4.b80b4","type":"function","z":"600a4a09.bfc9f4","name":"SW_ID","func":"sw_module = flow.get('sw_module');\nSW_ID = msg.payload.content[sw_module].id;\nmsg.payload = SW_ID;\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":580,"wires":[["1e20d9eb.9f0216"]]},{"id":"1e20d9eb.9f0216","type":"ui_text","z":"600a4a09.bfc9f4","group":"45d7facf.87f524","order":3,"width":0,"height":0,"name":"","label":"SW Module ID","format":"{{msg.payload}}","layout":"col-center","x":1240,"y":580,"wires":[]},{"id":"4574d28.059962c","type":"ui_button","z":"600a4a09.bfc9f4","name":"","group":"40051f70.40003","order":7,"width":4,"height":1,"passthru":false,"label":"Return to Distributions","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"tab\":\"Distributions\"}","payloadType":"json","topic":"","x":240,"y":560,"wires":[["3f7fa86.2590458"]]},{"id":"3f7fa86.2590458","type":"ui_ui_control","z":"600a4a09.bfc9f4","name":"","events":"all","x":470,"y":560,"wires":[[]]},{"id":"82b956bd.be5528","type":"function","z":"d1dbdd74.e1a3","name":"Array","func":"distribution = flow.get('distribution');\n\nmodules = msg.payload.content[distribution].modules;\nnumber_modules = modules.length;\n\nname = [];\nversion = [];\narray = [];\n\nfor(i=0; i<number_modules; i++){\n    \n    name[i] = msg.payload.content[distribution].modules[i].name;\n    version[i] = msg.payload.content[distribution].modules[i].version;\n    \n    array[i] = {\"x\":name[i], \"y\":version[i]};\n}\n\nmsg.payload = array;\n\nreturn msg;","outputs":1,"noerr":0,"x":910,"y":600,"wires":[["21df5c84.e904f4"]]},{"id":"21df5c84.e904f4","type":"function","z":"d1dbdd74.e1a3","name":"Text","func":"tamanho = msg.payload.length;\ntext = \"\"\n\nfor (i=0; i<tamanho; i++){\n    text = text + \"Name: \" + msg.payload[i].x +\"; Version: \" + msg.payload[i].y + \"</br>\";\n    text = text + \"</br>\";\n}\n\nmsg.payload = text;\nreturn msg;","outputs":1,"noerr":0,"x":1190,"y":600,"wires":[["165e9e1c.e1cb02"]]},{"id":"165e9e1c.e1cb02","type":"ui_text","z":"d1dbdd74.e1a3","group":"aa4c6727.1bc928","order":1,"width":8,"height":3,"name":"","label":"Name and Version","format":"{{value}}","layout":"col-center","x":1490,"y":600,"wires":[]},{"id":"72d8a1da.77c9","type":"function","z":"600a4a09.bfc9f4","name":"Artifacts","func":"sw_module = flow.get('sw_module');\n\nurl = msg.payload.content[sw_module]._links.self.href;\nurl = url + '/artifacts';\n\nmsg.url = url;\n\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":660,"wires":[["295ef629.01633a"]]},{"id":"295ef629.01633a","type":"http request","z":"600a4a09.bfc9f4","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1090,"y":660,"wires":[["d7e0fb74.d95938","a5fda492.747d58"]]},{"id":"d7e0fb74.d95938","type":"debug","z":"600a4a09.bfc9f4","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":1140,"y":720,"wires":[]},{"id":"a5fda492.747d58","type":"function","z":"600a4a09.bfc9f4","name":"Array","func":"number_artifacts = msg.payload.length;\narray = [];\n\nfor(i=0; i<number_artifacts; i++){\n    array[i] = msg.payload[i].providedFilename;\n}\n\nmsg.payload = array;\n\nreturn msg;","outputs":1,"noerr":0,"x":1290,"y":660,"wires":[["53c87fe5.f16d8"]]},{"id":"c07e1584.842618","type":"ui_text","z":"600a4a09.bfc9f4","group":"34dfd948.533d96","order":1,"width":9,"height":3,"name":"","label":"File Name","format":"{{msg.payload}}","layout":"col-center","x":1700,"y":660,"wires":[]},{"id":"53c87fe5.f16d8","type":"function","z":"600a4a09.bfc9f4","name":"Text","func":"tamanho = msg.payload.length;\ntext = \"\"\n\nfor (i=0; i<tamanho; i++){\n    text = text +  msg.payload[i] + \"</br>\";\n    text = text + \"</br>\";\n}\n\nmsg.payload = text;\nreturn msg;","outputs":1,"noerr":0,"x":1470,"y":660,"wires":[["c07e1584.842618"]]},{"id":"f9cf77e0.eb2258","type":"ui_button","z":"8b01cf3e.f743f","name":"","group":"a08310c5.70be7","order":10,"width":4,"height":1,"passthru":false,"label":"View Distributions","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"tab\":\"Distributions\"}","payloadType":"json","topic":"","x":150,"y":540,"wires":[["32ff66eb.b169ba"]]},{"id":"32ff66eb.b169ba","type":"ui_ui_control","z":"8b01cf3e.f743f","name":"","events":"all","x":390,"y":540,"wires":[[]]},{"id":"79ab39a.4df34c8","type":"ui_button","z":"8b01cf3e.f743f","name":"","group":"6e71c2c1.9254ac","order":10,"width":4,"height":1,"passthru":false,"label":"View SW Modules","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"tab\":\"Software Modules\"}","payloadType":"json","topic":"","x":150,"y":600,"wires":[["335f1a0d.424c76"]]},{"id":"335f1a0d.424c76","type":"ui_ui_control","z":"8b01cf3e.f743f","name":"","events":"all","x":390,"y":600,"wires":[[]]},{"id":"e6155f80.d4062","type":"ui_button","z":"d1dbdd74.e1a3","name":"","group":"2a9c7ac8.8f2c66","order":7,"width":5,"height":1,"passthru":false,"label":"Return to Device Information","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"tab\":\"Device Information\"}","payloadType":"json","topic":"","x":240,"y":600,"wires":[["9abf91a1.2dd03"]]},{"id":"9abf91a1.2dd03","type":"ui_ui_control","z":"d1dbdd74.e1a3","name":"","events":"all","x":450,"y":600,"wires":[[]]},{"id":"4d3945df.97657c","type":"inject","z":"d1dbdd74.e1a3","name":"","topic":"","payload":"","payloadType":"date","repeat":"1200","crontab":"","once":true,"onceDelay":0.1,"x":110,"y":160,"wires":[["de9dc58c.b043b8"]]},{"id":"ea96fa9f.5245f8","type":"inject","z":"600a4a09.bfc9f4","name":"","topic":"","payload":"","payloadType":"date","repeat":"1200","crontab":"","once":true,"onceDelay":0.1,"x":130,"y":180,"wires":[["689b301d.98d9c"]]},{"id":"d4bc2e16.f010b","type":"function","z":"ee291f49.98ee5","name":"SW_Module_Name","func":"name = msg.payload[0].name;\nmsg.payload = name;\nreturn msg;","outputs":1,"noerr":0,"x":1270,"y":580,"wires":[["1614666b.4a642a"]]},{"id":"1614666b.4a642a","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":9,"width":7,"height":1,"name":"","label":"SW Module Name","format":"{{msg.payload}}","layout":"col-center","x":1550,"y":580,"wires":[]},{"id":"88067495.d4b4f8","type":"function","z":"ee291f49.98ee5","name":"SW Module Version","func":"version = msg.payload[0].version;\nmsg.payload = version; \nreturn msg;","outputs":1,"noerr":0,"x":1270,"y":640,"wires":[["447807b5.903cb8"]]},{"id":"447807b5.903cb8","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":10,"width":7,"height":1,"name":"","label":"SW Module Version","format":"{{msg.payload}}","layout":"col-center","x":1550,"y":640,"wires":[]},{"id":"2f3b51c7.5b4e3e","type":"function","z":"ee291f49.98ee5","name":"SW Module ID","func":"id = msg.payload[0].id;\nmsg.payload = id;\nreturn msg;","outputs":1,"noerr":0,"x":1260,"y":700,"wires":[["cbf36141.9411d"]]},{"id":"cbf36141.9411d","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":11,"width":7,"height":1,"name":"","label":"SW Module ID","format":"{{msg.payload}}","layout":"col-center","x":1540,"y":700,"wires":[]},{"id":"9689dce4.ecb28","type":"function","z":"ee291f49.98ee5","name":"Success","func":"msg.payload = \"Success! SW Module is created!\"\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":760,"wires":[["fad67b4f.5efa68"]]},{"id":"fad67b4f.5efa68","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":7,"width":7,"height":1,"name":"","label":"Result","format":"{{msg.payload}}","layout":"col-center","x":1430,"y":800,"wires":[]},{"id":"29d874a6.1cbb3c","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"File Path","tooltip":"","group":"aebbbce8.fea28","order":13,"width":7,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":160,"y":1220,"wires":[["726f0d4a.603cd4"]]},{"id":"726f0d4a.603cd4","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"file_path","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":420,"y":1220,"wires":[[]]},{"id":"a1d5fb95.83b218","type":"link in","z":"ee291f49.98ee5","name":"","links":["58db1695.6f6628"],"x":1355,"y":840,"wires":[["fad67b4f.5efa68"]]},{"id":"653fdc01.aa4fd4","type":"function","z":"ee291f49.98ee5","name":"Erro","func":"message = msg.payload.message;\nmsg.payload = message;\nreturn msg;","outputs":1,"noerr":0,"x":1250,"y":840,"wires":[["fad67b4f.5efa68"]]},{"id":"cb68f8bc.782408","type":"ui_button","z":"ee291f49.98ee5","name":"","group":"aebbbce8.fea28","order":16,"width":3,"height":1,"passthru":false,"label":"Upload Artifact","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":180,"y":1140,"wires":[["3eef53dd.a2736c"]]},{"id":"65b84e78.4082e","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"SW Module ID","tooltip":"","group":"aebbbce8.fea28","order":14,"width":7,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":180,"y":1280,"wires":[["63bfdc75.d40b94"]]},{"id":"79c905d1.78a99c","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":18,"width":7,"height":2,"name":"","label":"Result","format":"{{msg.payload}}","layout":"col-center","x":1870,"y":1240,"wires":[]},{"id":"3eef53dd.a2736c","type":"function","z":"ee291f49.98ee5","name":"Filter","func":"file_path = flow.get('file_path');\n\ntamanho = file_path.length;\n\nif (tamanho === 0){\n    msg.payload = false\n}\nelse{\n    msg.payload = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":1140,"wires":[["84b8d9ce.976478"]]},{"id":"84b8d9ce.976478","type":"switch","z":"ee291f49.98ee5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":1140,"wires":[["78f89cdf.2d36b4"],["fdaedbc8.23f168"]]},{"id":"fdaedbc8.23f168","type":"function","z":"ee291f49.98ee5","name":"","func":"msg.payload = \"Invalid Fields\";\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":1200,"wires":[["6fe0f1a0.a54cf"]]},{"id":"6fe0f1a0.a54cf","type":"link out","z":"ee291f49.98ee5","name":"Invalid_artifact","links":["3c5dbbef.c24b84"],"x":815,"y":1200,"wires":[]},{"id":"3c5dbbef.c24b84","type":"link in","z":"ee291f49.98ee5","name":"","links":["6fe0f1a0.a54cf"],"x":1795,"y":1280,"wires":[["79c905d1.78a99c"]]},{"id":"11770b75.8cd6a5","type":"debug","z":"600a4a09.bfc9f4","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":950,"y":100,"wires":[]},{"id":"6092f1a2.839e6","type":"ui_text","z":"ee291f49.98ee5","group":"aebbbce8.fea28","order":19,"width":0,"height":0,"name":"","label":"","format":"Last Artifact Upload and SW Module","layout":"row-left","x":970,"y":860,"wires":[]},{"id":"3b8796f3.4d06aa","type":"ui_button","z":"ee291f49.98ee5","name":"","group":"f36b8716.4af3b8","order":17,"width":5,"height":1,"passthru":false,"label":"Assign SW Module","tooltip":"","color":"","bgcolor":"","icon":"","payload":"","payloadType":"str","topic":"","x":190,"y":2040,"wires":[["dce5c428.d83b88"]]},{"id":"67062dbd.fed124","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"Distribution ID","tooltip":"","group":"f36b8716.4af3b8","order":15,"width":7,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":180,"y":2180,"wires":[["33c226cc.dc842a"]]},{"id":"33c226cc.dc842a","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"Distribution_ID","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":2180,"wires":[[]]},{"id":"49cf9323.2fadac","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":2,"width":7,"height":1,"name":"","label":"","format":"Create a Distribution Set","layout":"row-left","x":1110,"y":1700,"wires":[]},{"id":"ad8b770d.6ab698","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":13,"width":7,"height":1,"name":"","label":"","format":"Assign SW Module","layout":"row-left","x":1010,"y":2140,"wires":[]},{"id":"2929cbc3.25f134","type":"comment","z":"ee291f49.98ee5","name":"ASSIGN SW MODULE","info":"","x":200,"y":1940,"wires":[]},{"id":"6a724a83.dbe6b4","type":"function","z":"ee291f49.98ee5","name":"DS_Name","func":"DS_Name = msg.payload[0].name;\nmsg.payload = DS_Name;\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":1440,"wires":[["3623ccee.714434"]]},{"id":"b79218f9.4de2e8","type":"function","z":"ee291f49.98ee5","name":"DS_Version","func":"DS_Version = msg.payload[0].version;\nmsg.payload = DS_Version;\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":1500,"wires":[["f7624055.0d97a"]]},{"id":"f7624055.0d97a","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":11,"width":7,"height":1,"name":"","label":"Distribution Version","format":"{{msg.payload}}","layout":"col-center","x":1710,"y":1500,"wires":[]},{"id":"3623ccee.714434","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":10,"width":7,"height":1,"name":"","label":"Distribution Name","format":"{{msg.payload}}","layout":"col-center","x":1710,"y":1440,"wires":[]},{"id":"c5a7980a.074098","type":"function","z":"ee291f49.98ee5","name":"Success","func":"msg.payload = \"Success! Distribution Set is created!\"\nreturn msg;","outputs":1,"noerr":0,"x":1420,"y":1620,"wires":[["1626dbcc.2fc6d4"]]},{"id":"1626dbcc.2fc6d4","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":8,"width":7,"height":1,"name":"","label":"Result","format":"{{msg.payload}}","layout":"col-center","x":1630,"y":1660,"wires":[]},{"id":"5095a31d.e94f4c","type":"function","z":"ee291f49.98ee5","name":"Fail","func":"message = msg.payload.message;\nmsg.payload = message;\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":1700,"wires":[["1626dbcc.2fc6d4"]]},{"id":"f82a7df9.9ee12","type":"function","z":"ee291f49.98ee5","name":"DS_ID","func":"id = msg.payload[0].id;\nmsg.payload = id;\nreturn msg;","outputs":1,"noerr":0,"x":1410,"y":1560,"wires":[["dd968aeb.8b6fa8"]]},{"id":"dd968aeb.8b6fa8","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":12,"width":7,"height":1,"name":"","label":"Distribution ID","format":"{{msg.payload}}","layout":"col-center","x":1700,"y":1560,"wires":[]},{"id":"c4a89cb8.fb608","type":"function","z":"ee291f49.98ee5","name":"SW Module","func":"SM_ID = flow.get('sw_module_id_input')\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/softwaremodules/' + SM_ID; \n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":2040,"wires":[["169ac9a8.f15b76"]]},{"id":"169ac9a8.f15b76","type":"http request","z":"ee291f49.98ee5","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1430,"y":2040,"wires":[["3d0b6a31.9771f6"]]},{"id":"3d0b6a31.9771f6","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1630,"y":2040,"wires":[["d011f6e5.8d5fc8","fb1d94e1.a42ff8"],[]]},{"id":"63404b8f.d4a804","type":"function","z":"ee291f49.98ee5","name":"Success","func":"msg.payload = \"Success! The SW Module is assigned!\"\nreturn msg;","outputs":1,"noerr":0,"x":1240,"y":2100,"wires":[["9f834962.2afad8"]]},{"id":"4c262a5a.060194","type":"function","z":"ee291f49.98ee5","name":"Invalid","func":"message = msg.payload.message;\nmsg.payload = message;\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":2160,"wires":[["9f834962.2afad8"]]},{"id":"9f834962.2afad8","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":19,"width":7,"height":1,"name":"","label":"Result","format":"{{msg.payload}}","layout":"col-center","x":1430,"y":2140,"wires":[]},{"id":"426aab6e.75ede4","type":"link in","z":"ee291f49.98ee5","name":"","links":["6a1547d5.e3edb8"],"x":1355,"y":2180,"wires":[["9f834962.2afad8"]]},{"id":"18142332.d653dd","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":20,"width":7,"height":1,"name":"","label":"","format":"Last SW Module Assigned and Distribution","layout":"row-left","x":1010,"y":2200,"wires":[]},{"id":"207502de.403bde","type":"function","z":"ee291f49.98ee5","name":"Distribution","func":"DS_ID = flow.get('Distribution_ID')\n\nmsg.url = 'https://api.eu1.bosch-iot-rollouts.com/rest/v1/distributionsets/' + DS_ID; \n\nreturn msg;","outputs":1,"noerr":0,"x":1230,"y":1980,"wires":[["3346dce2.d54a94"]]},{"id":"3346dce2.d54a94","type":"http request","z":"ee291f49.98ee5","name":"","method":"GET","ret":"obj","paytoqs":false,"url":"","tls":"","persist":false,"proxy":"","authType":"basic","x":1430,"y":1980,"wires":[["ebc9ad02.ad36a"]]},{"id":"4722f362.e8e47c","type":"function","z":"ee291f49.98ee5","name":"SW_Module_Name","func":"DS_Name = msg.payload.name\nmsg.payload = DS_Name;\nreturn msg;","outputs":1,"noerr":0,"x":1870,"y":1920,"wires":[["efaa0cef.49d7a"]]},{"id":"607b19af.2cc198","type":"function","z":"ee291f49.98ee5","name":"SW_Module_Version","func":"DS_Version = msg.payload.version\nmsg.payload = DS_Version;\nreturn msg;","outputs":1,"noerr":0,"x":1880,"y":1980,"wires":[["f84d99be.3073e8"]]},{"id":"f84d99be.3073e8","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":24,"width":7,"height":1,"name":"","label":"Distribution (Version)","format":"{{msg.payload}}","layout":"col-center","x":2140,"y":1980,"wires":[]},{"id":"efaa0cef.49d7a","type":"ui_text","z":"ee291f49.98ee5","group":"f36b8716.4af3b8","order":23,"width":7,"height":1,"name":"","label":"Distribution (Name)","format":"{{msg.payload}}","layout":"col-center","x":2130,"y":1920,"wires":[]},{"id":"eb2f074e.c8d328","type":"comment","z":"ee291f49.98ee5","name":"UPLOAD ARTIFACT","info":"","x":190,"y":1040,"wires":[]},{"id":"1732c30a.a41dbd","type":"function","z":"ee291f49.98ee5","name":"Filter","func":"sw_name = flow.get('sw_name');\nsw_version = flow.get('sw_version');\n\ntamanho_name = sw_name.length;\ntamanho_version = sw_version.length;\n\nif (tamanho_name === 0 || tamanho_version === 0){\n    msg.payload = false\n}\nelse{\n    msg.payload = true;\n}\n\nreturn msg;\n","outputs":1,"noerr":0,"x":370,"y":680,"wires":[["31fdf1a7.cc23be"]]},{"id":"31fdf1a7.cc23be","type":"switch","z":"ee291f49.98ee5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":680,"wires":[["8fa84553.122c18"],["9ad77e19.4d3f3"]]},{"id":"9ad77e19.4d3f3","type":"function","z":"ee291f49.98ee5","name":"Invalid","func":"msg.payload = \"Invalid Fields\";\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":740,"wires":[["58db1695.6f6628"]]},{"id":"c0bfe6c4.258228","type":"function","z":"ee291f49.98ee5","name":"Filter","func":"device_name = flow.get('device_name') \ndevice_id = flow.get('device_id')\n\ntamanho_name = device_name.length;\ntamanho_id = device_id.length;\n\n\nif(tamanho_name === 0 || tamanho_id === 0){\n    msg.payload = false\n}\nelse{\n    msg.payload = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":220,"wires":[["c55fd04b.44006"]]},{"id":"c55fd04b.44006","type":"switch","z":"ee291f49.98ee5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":530,"y":220,"wires":[["f5bbc5ba.12ce88"],["9a738d3f.8cff5"]]},{"id":"9a738d3f.8cff5","type":"function","z":"ee291f49.98ee5","name":"Invalid","func":"msg.payload = \"Invalid Fields\";\nreturn msg;","outputs":1,"noerr":0,"x":670,"y":280,"wires":[["ca8a7b2b.818958"]]},{"id":"ca8a7b2b.818958","type":"link out","z":"ee291f49.98ee5","name":"Invalid_device","links":["89f664ca.045278"],"x":775,"y":280,"wires":[]},{"id":"4ed88b02.9f4ca4","type":"function","z":"ee291f49.98ee5","name":"Filter","func":"ds_name = flow.get('ds_name');\nds_version = flow.get('ds_version');\n\ntamanho_name = ds_name.length;\ntamanho_version = ds_version.length;\n\nif (tamanho_name === 0 || tamanho_version === 0 ){\n    msg.payload = false\n}\nelse{\n    msg.payload = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":410,"y":1580,"wires":[["a507d49d.b2b5c8"]]},{"id":"a507d49d.b2b5c8","type":"switch","z":"ee291f49.98ee5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":570,"y":1580,"wires":[["b0c17204.e95cb"],["e55eca1d.1e61b8"]]},{"id":"e55eca1d.1e61b8","type":"function","z":"ee291f49.98ee5","name":"Invalid","func":"msg.payload = \"Invalid Fields\";\nreturn msg;","outputs":1,"noerr":0,"x":750,"y":1640,"wires":[["512b3c23.92da24"]]},{"id":"512b3c23.92da24","type":"link out","z":"ee291f49.98ee5","name":"Invalid_ds","links":["5a7edcea.196de4"],"x":915,"y":1640,"wires":[]},{"id":"5a7edcea.196de4","type":"link in","z":"ee291f49.98ee5","name":"","links":["512b3c23.92da24"],"x":1555,"y":1700,"wires":[["1626dbcc.2fc6d4"]]},{"id":"ebc9ad02.ad36a","type":"switch","z":"ee291f49.98ee5","name":"","property":"statusCode","propertyType":"msg","rules":[{"t":"eq","v":"200","vt":"num"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":1630,"y":1980,"wires":[["4722f362.e8e47c","607b19af.2cc198"],[]]},{"id":"dce5c428.d83b88","type":"function","z":"ee291f49.98ee5","name":"Filter","func":"DS_ID = flow.get('Distribution_ID')\nSM_ID = flow.get('sw_module_id_input')\n\ntamanho_DS_ID = DS_ID.length;\ntamanho_SM_ID = SM_ID.length;\n\nif (tamanho_DS_ID === 0 || tamanho_SM_ID === 0 ){\n    msg.payload = false\n}\nelse{\n    msg.payload = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":370,"y":2040,"wires":[["3fb8f29f.77b80e"]]},{"id":"3fb8f29f.77b80e","type":"switch","z":"ee291f49.98ee5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":510,"y":2040,"wires":[["92d0dd1f.554ac"],["bf0af4b8.f05c58"]]},{"id":"bf0af4b8.f05c58","type":"function","z":"ee291f49.98ee5","name":"Invalid","func":"msg.payload = \"Invalid Fields\";\nreturn msg;","outputs":1,"noerr":0,"x":710,"y":2100,"wires":[["6a1547d5.e3edb8"]]},{"id":"6a1547d5.e3edb8","type":"link out","z":"ee291f49.98ee5","name":"Invalid_assign","links":["426aab6e.75ede4"],"x":815,"y":2100,"wires":[]},{"id":"8c11104f.58a01","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"Distribution ID","tooltip":"","group":"a075749.8b83888","order":2,"width":5,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":180,"y":2560,"wires":[["a3803c6d.74253"]]},{"id":"a3803c6d.74253","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"Distribution_ID","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":460,"y":2560,"wires":[[]]},{"id":"6cdd8687.2c9cf8","type":"ui_text_input","z":"ee291f49.98ee5","name":"","label":"Device ID","tooltip":"","group":"a075749.8b83888","order":3,"width":5,"height":1,"passthru":true,"mode":"text","delay":300,"topic":"","x":160,"y":2620,"wires":[["d496bb4c.daaed8"]]},{"id":"d496bb4c.daaed8","type":"change","z":"ee291f49.98ee5","name":"","rules":[{"t":"set","p":"Device_ID","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":450,"y":2620,"wires":[[]]},{"id":"754c87e8.483708","type":"function","z":"ee291f49.98ee5","name":"Filter","func":"DS_ID = flow.get('Distribution_ID')\ndevice_id = flow.get('Device_ID')\n\ntamanho_DS_ID = DS_ID.length;\ntamanho_device_id = device_id.length;\n\nif (tamanho_DS_ID === 0 || tamanho_device_id === 0 ){\n    msg.payload = false\n}\nelse{\n    msg.payload = true;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":330,"y":2480,"wires":[["7324989e.192498"]]},{"id":"7324989e.192498","type":"switch","z":"ee291f49.98ee5","name":"","property":"payload","propertyType":"msg","rules":[{"t":"true"},{"t":"else"}],"checkall":"true","repair":false,"outputs":2,"x":510,"y":2480,"wires":[["c3fc94fe.94fc48"],["4235e6b.81c2118"]]},{"id":"4235e6b.81c2118","type":"function","z":"ee291f49.98ee5","name":"Invalid","func":"msg.payload = \"Invalid Fields\";\nreturn msg;","outputs":1,"noerr":0,"x":690,"y":2540,"wires":[["b30c45e0.b83bb8"]]},{"id":"b30c45e0.b83bb8","type":"link out","z":"ee291f49.98ee5","name":"Invalid_final","links":["ad426ce2.89b09"],"x":795,"y":2540,"wires":[]},{"id":"ad426ce2.89b09","type":"link in","z":"ee291f49.98ee5","name":"","links":["b30c45e0.b83bb8"],"x":1355,"y":2540,"wires":[["b6875fc4.7ca4e"]]},{"id":"7952a0da.44952","type":"debug","z":"8b01cf3e.f743f","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":660,"y":820,"wires":[]},{"id":"101d9c45.5a5604","type":"function","z":"8b01cf3e.f743f","name":"Controller ID","func":"device = flow.get('device');\nid = msg.payload.content[device].controllerId;\nmsg.payload = id;\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":320,"wires":[["d2ae686b.822778"]]},{"id":"d2ae686b.822778","type":"ui_text","z":"8b01cf3e.f743f","group":"b4da31d4.3161d","order":2,"width":0,"height":0,"name":"","label":"Controller ID","format":"{{msg.payload}}","layout":"row-spread","x":1170,"y":320,"wires":[]},{"id":"4218db4e.e966b4","type":"change","z":"8b01cf3e.f743f","name":"","rules":[{"t":"set","p":"DS_created_at","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":1170,"y":600,"wires":[[]]},{"id":"90cc2646.4800b8","type":"function","z":"8b01cf3e.f743f","name":"Date","func":"msg.payload = flow.get('DS_created_at');\nreturn msg;","outputs":1,"noerr":0,"x":1430,"y":620,"wires":[["ece5b768.cd40d8"]]}]